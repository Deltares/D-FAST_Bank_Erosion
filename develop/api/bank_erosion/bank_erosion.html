
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A tool to perform a bank erosion analysis based on a number of D-Flow FM simulations.">
      
      
      
        <link rel="canonical" href="https://deltares.github.io/D-FAST_Bank_Erosion/develop/api/bank_erosion/bank_erosion.html">
      
      
        <link rel="prev" href="../bank_lines/data_models.html">
      
      
        <link rel="next" href="../io.html">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Bank Erosion Module - D-FAST Bank Erosion</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bank-erosion-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="D-FAST Bank Erosion" class="md-header__button md-logo" aria-label="D-FAST Bank Erosion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            D-FAST Bank Erosion
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bank Erosion Module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Deltares/D-FAST_Bank_Erosion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Deltares/D-FAST_Bank_Erosion
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/poetry.html" class="md-tabs__link">
          
  
  
    
  
  How-to

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture-design/main-components.html" class="md-tabs__link">
          
  
  
    
  
  Architecture Design

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../bank_lines/bank_lines.html" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../gui/gui.html" class="md-tabs__link">
          
  
  
    
  
  User Interface

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../change-log.html" class="md-tabs__link">
        
  
  
    
  
  Release Notes

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../license.html" class="md-tabs__link">
        
  
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="D-FAST Bank Erosion" class="md-nav__button md-logo" aria-label="D-FAST Bank Erosion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    D-FAST Bank Erosion
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Deltares/D-FAST_Bank_Erosion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Deltares/D-FAST_Bank_Erosion
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-to
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            How-to
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/poetry.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local clone + Poetry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/documentation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/developer-instructions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/pre-commit-hooks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-Commit Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/doctest.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings and Doctest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naming conventions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/teamcity-ci.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teamcity ci
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture-design/main-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    D-FAST Bank Erosion Architecture and Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture-design/class-diagram.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Diagram for Existing D-FAST Bank Erosion Code
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Bank Line Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Bank Line Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bank_lines/bank_lines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Lines Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bank_lines/data_models.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Lines Data Models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Bank Erosion Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bank_erosion.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Main Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion" class="md-nav__link">
    <span class="md-ellipsis">
      bank_erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bank_erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="md-nav__link">
    <span class="md-ellipsis">
      Erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.config_file" class="md-nav__link">
    <span class="md-ellipsis">
      config_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fairway_bank_line_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="md-nav__link">
    <span class="md-ellipsis">
      compute_erosion_per_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.get_ship_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_ship_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor" class="md-nav__link">
    <span class="md-ellipsis">
      mesh_processor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mesh_processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.enlarge" class="md-nav__link">
    <span class="md-ellipsis">
      enlarge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab" class="md-nav__link">
    <span class="md-ellipsis">
      get_slices_ab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.intersect_line_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      intersect_line_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger" class="md-nav__link">
    <span class="md-ellipsis">
      debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="md-nav__link">
    <span class="md-ellipsis">
      last_discharge_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="md-nav__link">
    <span class="md-ellipsis">
      middle_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    I/O Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cmd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utilities Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting Module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/gui.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gui
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../change-log.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Main Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion" class="md-nav__link">
    <span class="md-ellipsis">
      bank_erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bank_erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="md-nav__link">
    <span class="md-ellipsis">
      Erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.config_file" class="md-nav__link">
    <span class="md-ellipsis">
      config_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fairway_bank_line_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="md-nav__link">
    <span class="md-ellipsis">
      compute_erosion_per_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.get_ship_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_ship_parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor" class="md-nav__link">
    <span class="md-ellipsis">
      mesh_processor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="mesh_processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.enlarge" class="md-nav__link">
    <span class="md-ellipsis">
      enlarge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab" class="md-nav__link">
    <span class="md-ellipsis">
      get_slices_ab
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh_processor.intersect_line_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      intersect_line_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger" class="md-nav__link">
    <span class="md-ellipsis">
      debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="md-nav__link">
    <span class="md-ellipsis">
      last_discharge_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="md-nav__link">
    <span class="md-ellipsis">
      middle_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Deltares/D-FAST_Bank_Erosion/edit/master/docs/api/bank_erosion/bank_erosion.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Deltares/D-FAST_Bank_Erosion/raw/master/docs/api/bank_erosion/bank_erosion.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="bank-erosion-module"><a class="toclink" href="#bank-erosion-module">Bank Erosion Module</a><a class="headerlink" href="#bank-erosion-module" title="Permanent link">#</a></h1>
<p>The Bank Erosion module is responsible for calculating bank erosion based on hydrodynamic data and detected bank lines. It is one of the core components of the D-FAST Bank Erosion software.</p>
<h2 id="overview"><a class="toclink" href="#overview">Overview</a><a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>The Bank Erosion module calculates the amount of bank material that will be eroded during the first year and until equilibrium, based on hydrodynamic simulation results and detected bank lines. It takes into account various factors such as river geometry, discharge levels, and shipping parameters.</p>
<h2 id="components"><a class="toclink" href="#components">Components</a><a class="headerlink" href="#components" title="Permanent link">#</a></h2>
<p>The Bank Erosion module consists of the following components:</p>
<h3 id="main-classes"><a class="toclink" href="#main-classes">Main Classes</a><a class="headerlink" href="#main-classes" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.bank_erosion" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion" class="toclink">
            <code>dfastbe.bank_erosion.bank_erosion</code>


</a><a href="#dfastbe.bank_erosion.bank_erosion" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>Copyright (C) 2020 Stichting Deltares.</p>
<p>This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation version 2.1.</p>
<p>This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public
License along with this library; if not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>contact: delft3d.support@deltares.nl
Stichting Deltares
P.O. Box 177
2600 MH Delft, The Netherlands</p>
<p>All indications and logos of, and references to, "Delft3D" and "Deltares"
are registered trademarks of Stichting Deltares, and remain the property of
Stichting Deltares. All rights reserved.</p>
<p>INFORMATION
This file is part of D-FAST Bank Erosion: https://github.com/Deltares/D-FAST_Bank_Erosion</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.bank_erosion.Erosion" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="toclink">
            <code>Erosion</code>


</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to handle the bank erosion calculations.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Erosion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle the bank erosion calculations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Erosion class.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">root_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span> <span class="o">=</span> <span class="n">config_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">ErosionRiverData</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">get_erosion_sim_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bl_processor</span> <span class="o">=</span> <span class="n">BankLinesProcessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debugger</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">config_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfigFile</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration file object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_ship_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ship parameters from the configuration file.&quot;&quot;&quot;</span>
        <span class="n">ship_relative_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;VShip&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">num_ships_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;NShip&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">num_waves_p_ship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NWave&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ship_draught</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;Draught&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">ship_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;ShipType&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">parslope0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Slope&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;slp&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">reed_wave_damping_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Reed&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;rdd&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ship_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;vship0&quot;</span><span class="p">:</span> <span class="n">ship_relative_velocity</span><span class="p">,</span>
            <span class="s2">&quot;Nship0&quot;</span><span class="p">:</span> <span class="n">num_ships_year</span><span class="p">,</span>
            <span class="s2">&quot;nwave0&quot;</span><span class="p">:</span> <span class="n">num_waves_p_ship</span><span class="p">,</span>
            <span class="s2">&quot;Tship0&quot;</span><span class="p">:</span> <span class="n">ship_draught</span><span class="p">,</span>
            <span class="s2">&quot;ship0&quot;</span><span class="p">:</span> <span class="n">ship_type</span><span class="p">,</span>
            <span class="s2">&quot;parslope0&quot;</span><span class="p">:</span> <span class="n">parslope0</span><span class="p">,</span>
            <span class="s2">&quot;parreed0&quot;</span><span class="p">:</span> <span class="n">reed_wave_damping_coeff</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ship_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_river_axis_by_center_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LineGeometry</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the river axis by the center line.</span>

<span class="sd">        Intersect the river center line with the river axis to map the stations from the first to the latter</span>
<span class="sd">        then clip the river axis by the first and last station of the centerline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">river_axis</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="c1"># optional sorting --&gt; see 04_Waal_D3D example</span>
        <span class="c1"># check: sum all distances and determine maximum distance ...</span>
        <span class="c1"># if maximum &gt; alpha * sum then perform sort</span>
        <span class="c1"># Waal OK: 0.0082 ratio max/sum, Waal NotOK: 0.13 - Waal: 2500 points,</span>
        <span class="c1"># so even when OK still some 21 times more than 1/2500 = 0.0004</span>
        <span class="n">dist2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">dist2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">dist2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.03</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The river axis needs sorting!!&quot;</span><span class="p">)</span>

        <span class="c1"># map km to axis points, further using axis</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_axis&quot;</span><span class="p">)</span>
        <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">intersect_with_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">)</span>

        <span class="c1"># clip river axis to reach of interest (get the closest point to the first and last station)</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">i2</span><span class="p">:</span>
            <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># reverse river axis</span>
            <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># river_axis = LineString(river_axis_numpy)</span>
        <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stations&quot;</span><span class="p">:</span> <span class="n">river_axis_km</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">river_axis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_fairway_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">river_axis</span><span class="p">:</span> <span class="n">LineGeometry</span><span class="p">,</span>
        <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># map km to fairway points, further using axis</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_fairway&quot;</span><span class="p">)</span>
        <span class="c1"># intersect fairway and mesh</span>
        <span class="n">fairway_intersection_coords</span><span class="p">,</span> <span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">intersect_line_mesh</span><span class="p">(</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">as_array</span><span class="p">(),</span> <span class="n">mesh_data</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">fairway_intersection_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairway_intersection_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">fairway_face_indices.shp&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;iface&quot;</span><span class="p">:</span> <span class="n">fairway_face_indices</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">FairwayData</span><span class="p">(</span><span class="n">fairway_face_indices</span><span class="p">,</span> <span class="n">fairway_intersection_coords</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_fairway_bank_line_distance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map bank data to fairway data.</span>

<span class="sd">        Args:</span>
<span class="sd">            bank_data (BankData):</span>
<span class="sd">            fairway_data (FairwayData):</span>
<span class="sd">            simulation_data (ErosionSimulationData):</span>

<span class="sd">        Returns:</span>
<span class="sd">            The method updates the following attributes in the `bank_data` instance</span>
<span class="sd">                - fairway_face_indices</span>
<span class="sd">                - fairway_distances</span>
<span class="sd">            and the following attributes in the `fairway_data` instance</span>
<span class="sd">                - fairway_initial_water_levels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># distance fairway-bankline (bank-fairway)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_distance_fairway&quot;</span><span class="p">)</span>

        <span class="n">num_fairway_face_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bank_i</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
            <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
            <span class="n">coords_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank_fairway_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">))</span>
            <span class="n">bp_fw_face_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">coord_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">):</span>
                <span class="c1"># find closest fairway support node</span>
                <span class="n">closest_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">fairway_coord</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_coord</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="c1"># If fairway support node is also the closest projected fairway point, then it likely</span>
                <span class="c1"># that that point is one of the original support points (a corner) of the fairway path</span>
                <span class="c1"># and located inside a grid cell. The segments before and after that point will then</span>
                <span class="c1"># both be located inside that same grid cell, so let&#39;s pick the segment before the point.</span>
                <span class="c1"># If the point happens to coincide with a grid edge and the two segments are located</span>
                <span class="c1"># in different grid cells, then we could either simply choose one or add complexity to</span>
                <span class="c1"># average the values of the two grid cells. Let&#39;s go for the simplest approach ...</span>
                <span class="n">iseg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                        <span class="n">closest_ind</span><span class="p">,</span>
                        <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">coord_i</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span>
                            <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                        <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                            <span class="c1"># projected point located on segment before, which corresponds to initial choice: iseg = ifw - 1</span>
                <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&lt;</span> <span class="n">num_fairway_face_ind</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                        <span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">closest_ind</span><span class="p">,</span>
                        <span class="n">coord_i</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                        <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                            <span class="n">iseg</span> <span class="o">=</span> <span class="n">closest_ind</span>

                <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>
                <span class="n">bank_fairway_dist</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_bank_distance</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bank_</span><span class="si">{</span><span class="n">bank_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">_chainage_and_fairway_face_idx.shp&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">bank_i</span><span class="p">],</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bp_fw_face_idx</span>
            <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span> <span class="o">=</span> <span class="n">bank_fairway_dist</span>

        <span class="c1"># water level at fairway</span>
        <span class="n">water_level_fairway_ref</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="n">bank_data</span><span class="p">:</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span>
            <span class="n">water_level_fairway_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span> <span class="o">=</span> <span class="n">water_level_fairway_ref</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_initial_conditions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErosionInputs</span><span class="p">:</span>
        <span class="c1"># wave reduction s0, s1</span>
        <span class="n">wave_fairway_distance_0</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wave0&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">wave_fairway_distance_1</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wave1&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># save 1_banklines</span>
        <span class="c1"># read vship, nship, nwave, draught (tship), shiptype ... independent of level number</span>
        <span class="n">shipping_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ship_parameters</span><span class="p">(</span><span class="n">num_stations_per_bank</span><span class="p">)</span>

        <span class="c1"># read classes flag (yes: banktype = taucp, no: banktype = tauc) and banktype (taucp: 0-4 ... or ... tauc = critical shear value)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;Classes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">bank_type</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BankType&quot;</span><span class="p">,</span>
                <span class="n">num_stations_per_bank</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.btp&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">tauc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">bank</span> <span class="ow">in</span> <span class="n">bank_type</span><span class="p">:</span>
                <span class="n">tauc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[</span><span class="n">bank</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tauc</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BankType&quot;</span><span class="p">,</span>
                <span class="n">num_stations_per_bank</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.btp&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">thr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank_type</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">thr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">shear_stress</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tauc</span><span class="p">):</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shear_stress</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">thr_i</span> <span class="ow">in</span> <span class="n">thr</span><span class="p">:</span>
                    <span class="n">bt</span><span class="p">[</span><span class="n">shear_stress</span> <span class="o">&lt;</span> <span class="n">thr_i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bank_type</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span>

        <span class="c1"># read bank protection level dike_height</span>
        <span class="n">zss_miss</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
        <span class="n">dike_height</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ProtectionLevel&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">zss_miss</span><span class="p">,</span>
            <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.bpl&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># if dike_height undefined, set dike_height equal to water_level_fairway_ref - 1</span>
        <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">one_zss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dike_height</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">one_zss</span> <span class="o">==</span> <span class="n">zss_miss</span>
            <span class="n">one_zss</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ib</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">wave_fairway_distance_0</span><span class="o">=</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="n">wave_fairway_distance_1</span><span class="o">=</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="n">bank_protection_level</span><span class="o">=</span><span class="n">dike_height</span><span class="p">,</span>
            <span class="n">tauc</span><span class="o">=</span><span class="n">tauc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ErosionInputs</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">shipping_data</span><span class="o">=</span><span class="n">shipping_data</span><span class="p">,</span> <span class="n">bank_type</span><span class="o">=</span><span class="n">bank_type</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_discharge_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WaterLevelData</span><span class="p">,</span> <span class="n">ErosionResults</span><span class="p">]:</span>

        <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="n">num_km</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">)</span>

        <span class="c1"># initialize arrays for erosion loop over all discharges</span>
        <span class="n">discharge_levels</span><span class="p">,</span> <span class="n">bank_height</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;total_time&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">level_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_levels</span><span class="p">):</span>
            <span class="n">log_text</span><span class="p">(</span>
                <span class="s2">&quot;discharge_header&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">level_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
                    <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;read_q_params&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="c1"># 1) read level-specific parameters</span>
            <span class="c1"># read ship_velocity, num_ship, nwave, draught, ship_type, slope, reed, fairway_depth, ... (level specific values)</span>
            <span class="n">discharge_level_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_discharge_parameters</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">shipping_data</span><span class="p">,</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span>
            <span class="p">)</span>

            <span class="c1"># 2) load FM result</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span>
                <span class="s2">&quot;read_simdata&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">[</span><span class="n">level_i</span><span class="p">]},</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span>
            <span class="p">)</span>
            <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">ErosionSimulationData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span>
            <span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_erosion&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>

            <span class="n">level_calculation</span><span class="p">,</span> <span class="n">dvol_bank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_erosion_per_level</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">discharge_level_pars</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="p">,</span>
                <span class="n">km_bin</span><span class="p">,</span>
                <span class="n">num_km</span><span class="p">,</span>
                <span class="n">bank_height</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">discharge_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_calculation</span><span class="p">)</span>

            <span class="n">error_vol_file</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;EroVol</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;erovolQ</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.evo&quot;</span>
            <span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_error_vol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">error_vol_file</span><span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span> <span class="n">dvol_bank</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">error_vol_file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># shape is (num_levels, 2, (num_stations_per_bank))</span>
        <span class="c1"># if num_levels = 13 and the num_stations_per_bank = [10, 15]</span>
        <span class="c1"># then shape = (13, 2, (10, 15)) list of 13 elements, each element is a list of 2 elements</span>
        <span class="c1"># first an array of 10 elements, and the second is array of 15 elements</span>
        <span class="n">discharge_levels</span> <span class="o">=</span> <span class="n">DischargeLevels</span><span class="p">(</span><span class="n">discharge_levels</span><span class="p">)</span>
        <span class="n">flow_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">)</span>
        <span class="n">ship_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">)</span>
        <span class="n">total_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_tot&quot;</span><span class="p">)</span>
        <span class="n">total_eroded_vol</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_volume_tot&quot;</span><span class="p">)</span>

        <span class="n">erosion_results</span> <span class="o">=</span> <span class="n">ErosionResults</span><span class="p">(</span>
            <span class="n">erosion_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">,</span>
            <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="n">flow_erosion_dist</span><span class="p">,</span>
            <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="n">ship_erosion_dist</span><span class="p">,</span>
            <span class="n">total_erosion_dist</span><span class="o">=</span><span class="n">total_erosion_dist</span><span class="p">,</span>
            <span class="n">total_eroded_vol</span><span class="o">=</span><span class="n">total_eroded_vol</span><span class="p">,</span>
            <span class="n">eq_erosion_dist</span><span class="o">=</span><span class="n">discharge_levels</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span>
                <span class="s2">&quot;erosion_distance_eq&quot;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">),</span>
            <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="n">discharge_levels</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span>
                <span class="s2">&quot;erosion_volume_eq&quot;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">water_level_data</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">get_water_level_data</span><span class="p">(</span><span class="n">bank_height</span><span class="p">)</span>

        <span class="n">bank_data</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">bank_line_size</span><span class="p">,</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">bank_line_size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_postprocess_erosion_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">erosion_results</span><span class="p">:</span> <span class="n">ErosionResults</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Postprocess the erosion results to get the new bank lines and volumes.&quot;&quot;&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="n">avg_erosion_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">dn_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_ship</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">dn_max_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">eq_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">),</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">))</span>
        <span class="n">total_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">),</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">))</span>
        <span class="n">xy_line_new_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bankline_new_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bankline_eq_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
            <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
            <span class="n">avg_erosion_rate</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">dn_max</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">d_nav_flow</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">flow_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">d_nav_ship</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">ship_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">d_nav_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">dn_max_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnav&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">avg_erosion_rate</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnavflow&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_flow</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnavship&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_ship</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnmax&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">dn_max</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnaveq&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnmaxeq&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">dn_max_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>

            <span class="n">xy_line_new</span> <span class="o">=</span> <span class="n">move_line</span><span class="p">(</span>
                <span class="n">bank_coords</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">xy_line_new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_line_new</span><span class="p">)</span>
            <span class="n">bankline_new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">xy_line_new</span><span class="p">))</span>

            <span class="n">xy_line_eq</span> <span class="o">=</span> <span class="n">move_line</span><span class="p">(</span>
                <span class="n">bank_coords</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">xy_line_eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_line_eq</span><span class="p">)</span>
            <span class="n">bankline_eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">xy_line_eq</span><span class="p">))</span>

            <span class="n">dvol_eq</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">km_bin</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">eq_eroded_vol_per_km</span><span class="p">[:,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvol_eq</span>
            <span class="n">dvol_tot</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">km_bin</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">total_eroded_vol_per_km</span><span class="p">[:,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvol_tot</span>
            <span class="k">if</span> <span class="n">ib</span> <span class="o">&lt;</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">erosion_results</span><span class="o">.</span><span class="n">avg_erosion_rate</span> <span class="o">=</span> <span class="n">avg_erosion_rate</span>
        <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">eq_eroded_vol_per_km</span>
        <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">total_eroded_vol_per_km</span>

        <span class="k">return</span> <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_param</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default_val</span><span class="p">,</span> <span class="n">iq_str</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">iq_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">default_val</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_discharge_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">shipping_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
        <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LevelParameters</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read Discharge level parameters.</span>

<span class="sd">        Read all discharge-specific input arrays for level *iq*.</span>
<span class="sd">        Returns a dict with keys: vship, num_ship, n_wave, t_ship, ship_type,</span>
<span class="sd">        mu_slope, mu_reed, par_slope, par_reed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iq_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">ship_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;VShip&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;vship0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">num_ship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;NShip&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;Nship0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">num_waves_per_ship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;NWave&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;nwave0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ship_draught</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;Draught&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;Tship0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ship_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;ShipType&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;ship0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">valid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">par_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;Slope&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;parslope0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;slp&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">par_reed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_param</span><span class="p">(</span>
            <span class="s2">&quot;Reed&quot;</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="p">[</span><span class="s2">&quot;parreed0&quot;</span><span class="p">],</span>
            <span class="n">iq_str</span><span class="p">,</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;rdd&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">mu_slope</span><span class="p">,</span> <span class="n">mu_reed</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">par_slope</span><span class="p">,</span> <span class="n">par_reed</span><span class="p">):</span>
            <span class="n">mus</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mus</span><span class="p">[</span><span class="n">mus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">mus</span><span class="p">[</span><span class="n">mus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># 1/slope for non-zero values</span>
            <span class="n">mu_slope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mus</span><span class="p">)</span>
            <span class="n">mu_reed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">8.5e-4</span> <span class="o">*</span> <span class="n">pr</span><span class="o">**</span><span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># empirical damping coefficient</span>

        <span class="k">return</span> <span class="n">LevelParameters</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">level_i</span><span class="p">,</span>
                <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">ship_velocity</span><span class="p">,</span>
                <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">num_ship</span><span class="p">,</span>
                <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">num_waves_per_ship</span><span class="p">,</span>
                <span class="s2">&quot;ship_draught&quot;</span><span class="p">:</span> <span class="n">ship_draught</span><span class="p">,</span>
                <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">ship_type</span><span class="p">,</span>
                <span class="s2">&quot;par_slope&quot;</span><span class="p">:</span> <span class="n">par_slope</span><span class="p">,</span>
                <span class="s2">&quot;par_reed&quot;</span><span class="p">:</span> <span class="n">par_reed</span><span class="p">,</span>
                <span class="s2">&quot;mu_slope&quot;</span><span class="p">:</span> <span class="n">mu_slope</span><span class="p">,</span>
                <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">mu_reed</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_erosion_per_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">,</span>
        <span class="n">discharge_level_pars</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">,</span>
        <span class="n">num_km</span><span class="p">,</span>
        <span class="n">bank_height</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the bank erosion for a given level.&quot;&quot;&quot;</span>
        <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="n">dvol_bank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_km</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">par_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">bank_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">SingleCalculation</span><span class="p">()</span>
            <span class="c1"># bank_i = 0: left bank, bank_i = 1: right bank</span>
            <span class="c1"># calculate velocity along banks ...</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">bank_velocity</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_velocity</span><span class="p">(</span>
                <span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">vel_dx</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># determine velocity and bank height along banks ...</span>
                <span class="c1"># bank height = maximum bed elevation per cell</span>
                <span class="n">bank_height</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_height</span><span class="p">(</span><span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">zb_dx</span><span class="p">))</span>

            <span class="c1"># get water depth along the fair-way</span>
            <span class="n">ii_face</span> <span class="o">=</span> <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_face_indices</span>
            <span class="n">water_depth_fairway</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">water_depth_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
            <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hfw_max_level</span><span class="p">,</span> <span class="n">water_depth_fairway</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="n">parameter</span><span class="o">.</span><span class="n">water_level</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
            <span class="n">chez_face</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">chezy_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">chezy</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">chez_face</span> <span class="o">+</span> <span class="n">chez_face</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="c1"># last discharge level</span>
            <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">erosion_distance_eq</span><span class="p">,</span> <span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">comp_erosion_eq</span><span class="p">(</span>
                    <span class="n">bank_height</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                    <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                    <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                    <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                    <span class="n">water_depth_fairway</span><span class="p">,</span>
                    <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_eq</span> <span class="o">=</span> <span class="n">erosion_distance_eq</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">erosion_volume_eq</span>

            <span class="n">parameter</span> <span class="o">=</span> <span class="n">compute_bank_erosion_dynamics</span><span class="p">(</span>
                <span class="n">parameter</span><span class="p">,</span>
                <span class="n">bank_height</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
                <span class="n">water_depth_fairway</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># accumulate eroded volumes per km</span>
            <span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span> <span class="n">km_bin</span>
            <span class="p">)</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">volume_per_discharge</span>
            <span class="n">par_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>

            <span class="n">dvol_bank</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">volume_per_discharge</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_output</span><span class="p">(</span>
                    <span class="n">level_i</span><span class="p">,</span>
                    <span class="n">ind</span><span class="p">,</span>
                    <span class="n">bank_data</span><span class="p">,</span>
                    <span class="n">fairway_data</span><span class="p">,</span>
                    <span class="n">erosion_inputs</span><span class="p">,</span>
                    <span class="n">discharge_level_pars</span><span class="p">,</span>
                    <span class="n">water_depth_fairway</span><span class="p">,</span>
                    <span class="n">bank_height</span><span class="p">,</span>
                    <span class="n">num_levels</span><span class="p">,</span>
                    <span class="n">parameter</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">level_calculation</span> <span class="o">=</span> <span class="n">CalculationLevel</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hfw_max</span><span class="o">=</span><span class="n">hfw_max_level</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">level_calculation</span><span class="p">,</span> <span class="n">dvol_bank</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_debug_output</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">,</span>
        <span class="n">ind</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="n">discharge_level_pars</span><span class="p">,</span>
        <span class="n">water_depth_fairway</span><span class="p">,</span>
        <span class="n">bank_height</span><span class="p">,</span>
        <span class="n">num_levels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parameter</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># EQ debug</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">last_discharge_level</span><span class="p">(</span>
                <span class="n">ind</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">water_depth_fairway</span><span class="p">,</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_eq</span><span class="p">,</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_eq</span><span class="p">,</span>
                <span class="n">bank_height</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Q-specific debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">middle_levels</span><span class="p">(</span>
            <span class="n">ind</span><span class="p">,</span>
            <span class="n">level_i</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">fairway_data</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">water_depth_fairway</span><span class="p">,</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">bank_velocity</span><span class="p">,</span>
            <span class="n">bank_height</span><span class="p">,</span>
            <span class="n">parameter</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the bank erosion analysis for a specified configuration.&quot;&quot;&quot;</span>
        <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- start analysis --&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span>
            <span class="s2">&quot;header_bankerosion&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/Deltares/D-FAST_Bank_Erosion&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span>

        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;derive_topology&quot;</span><span class="p">)</span>

        <span class="n">mesh_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">compute_mesh_topology</span><span class="p">()</span>
        <span class="n">river_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_river_axis_by_center_line</span><span class="p">()</span>

        <span class="c1"># map to the output interval</span>
        <span class="n">km_bin</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">km_mid</span> <span class="o">=</span> <span class="n">get_km_bins</span><span class="p">(</span><span class="n">km_bin</span><span class="p">,</span> <span class="n">station_type</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">)</span>  <span class="c1"># get mid-points</span>

        <span class="n">fairway_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fairway_data</span><span class="p">(</span><span class="n">river_axis</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">)</span>

        <span class="c1"># map bank lines to mesh cells</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;intersect_bank_mesh&quot;</span><span class="p">)</span>
        <span class="n">bank_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bl_processor</span><span class="o">.</span><span class="n">intersect_with_mesh</span><span class="p">(</span><span class="n">mesh_data</span><span class="p">)</span>
        <span class="c1"># map the bank data to the fairway data (the bank_data and fairway_data will be updated inside the `_map_bank_to_fairway` function)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span>
            <span class="n">bank_data</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span>
        <span class="p">)</span>

        <span class="n">num_stations_per_bank</span> <span class="o">=</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span>
        <span class="n">erosion_inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_initial_conditions</span><span class="p">(</span>
            <span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">fairway_data</span>
        <span class="p">)</span>

        <span class="c1"># initialize arrays for erosion loop over all discharges</span>
        <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_discharge_levels</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">km_bin</span><span class="p">,</span>
            <span class="n">config_file</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="p">,</span>
            <span class="n">fairway_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_erosion_results</span><span class="p">(</span>
                <span class="n">km_bin</span><span class="p">,</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_bankline_shapefiles</span><span class="p">(</span>
            <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">config_file</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_volume_outputs</span><span class="p">(</span><span class="n">erosion_results</span><span class="p">,</span> <span class="n">km_mid</span><span class="p">)</span>

        <span class="c1"># create various plots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_plots</span><span class="p">(</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">,</span>
            <span class="n">xy_line_eq_list</span><span class="p">,</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="p">,</span>
            <span class="n">water_level_data</span><span class="p">,</span>
            <span class="n">mesh_data</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;end_bankerosion&quot;</span><span class="p">)</span>
        <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- end analysis --&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_bankline_shapefiles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span>
    <span class="p">):</span>
        <span class="n">bankline_new_series</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">bank_lines_new</span> <span class="o">=</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">bankline_new_series</span><span class="p">)</span>
        <span class="n">bank_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;BankFile&quot;</span><span class="p">,</span> <span class="s2">&quot;bankfile&quot;</span><span class="p">)</span>

        <span class="n">bank_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bank_name</span><span class="si">}</span><span class="s2">_new.shp&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_banklines&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)})</span>
        <span class="n">bank_lines_new</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)</span>

        <span class="n">bankline_eq_series</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">banklines_eq</span> <span class="o">=</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">bankline_eq_series</span><span class="p">)</span>

        <span class="n">bank_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bank_name</span><span class="si">}</span><span class="s2">_eq.shp&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_banklines&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)})</span>
        <span class="n">banklines_eq</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_volume_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">erosion_results</span><span class="p">:</span> <span class="n">ErosionResults</span><span class="p">,</span> <span class="n">km_mid</span><span class="p">):</span>
        <span class="n">erosion_vol_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;EroVol&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;erovol.evo&quot;</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_tot_erovol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">erosion_vol_file</span><span class="p">})</span>
        <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol_per_km</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">erosion_vol_file</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># write eroded volumes per km (equilibrium)</span>
        <span class="n">erosion_vol_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;EroVolEqui&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;erovol_eq.evo&quot;</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_eq_erovol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">erosion_vol_file</span><span class="p">})</span>
        <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol_per_km</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">erosion_vol_file</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_plots</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">river_axis_km</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
        <span class="n">xy_line_eq_list</span><span class="p">,</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">km_step</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
        <span class="n">water_level_data</span><span class="p">:</span> <span class="n">WaterLevelData</span><span class="p">,</span>
        <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">erosion_results</span><span class="p">:</span> <span class="n">ErosionResults</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># create various plots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_data&quot;</span><span class="p">]:</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;create_figures&quot;</span><span class="p">)</span>
            <span class="n">fig_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                <span class="n">bank_coords_mid</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">):</span>
                    <span class="n">bank_coords_mid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span>
                            <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">[</span><span class="n">ib</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                            <span class="o">+</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">[</span><span class="n">ib</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span>
                        <span class="p">)</span>
                        <span class="o">/</span> <span class="mi">2</span>
                    <span class="p">)</span>
                <span class="n">km_zoom</span><span class="p">,</span> <span class="n">xy_zoom</span> <span class="o">=</span> <span class="n">get_zoom_extends</span><span class="p">(</span>
                    <span class="n">river_axis_km</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                    <span class="n">river_axis_km</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;zoom_km_step&quot;</span><span class="p">],</span>
                    <span class="n">bank_coords_mid</span><span class="p">,</span>
                    <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot1_waterdepth_and_banklines</span><span class="p">(</span>
                <span class="n">bbox</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="o">.</span><span class="n">face_node</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="o">.</span><span class="n">x_node</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="o">.</span><span class="n">y_node</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="o">.</span><span class="n">water_depth_face</span><span class="p">,</span>
                <span class="mf">1.1</span> <span class="o">*</span> <span class="n">water_level_data</span><span class="o">.</span><span class="n">hfw_max</span><span class="p">,</span>
                <span class="n">X_AXIS_TITLE</span><span class="p">,</span>
                <span class="n">Y_AXIS_TITLE</span><span class="p">,</span>
                <span class="s2">&quot;water depth and initial bank lines&quot;</span><span class="p">,</span>
                <span class="s2">&quot;water depth [m]&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;fig_dir&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}{</span><span class="n">fig_i</span><span class="si">}</span><span class="s2">_banklines&quot;</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_xy_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">xy_zoom</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot2_eroded_distance_and_equilibrium</span><span class="p">(</span>
                <span class="n">bbox</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">avg_erosion_rate</span><span class="p">,</span>
                <span class="n">xy_line_eq_list</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">,</span>
                <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">,</span>
                <span class="n">X_AXIS_TITLE</span><span class="p">,</span>
                <span class="n">Y_AXIS_TITLE</span><span class="p">,</span>
                <span class="s2">&quot;eroded distance and equilibrium bank location&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;eroded during </span><span class="si">{</span><span class="n">erosion_results</span><span class="o">.</span><span class="n">erosion_time</span><span class="si">}</span><span class="s2"> year&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eroded distance [m]&quot;</span><span class="p">,</span>
                <span class="s2">&quot;equilibrium location&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;fig_dir&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}{</span><span class="n">fig_i</span><span class="si">}</span><span class="s2">_erosion_sensitivity&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_xy_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">xy_zoom</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot3_eroded_volume</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">km_step</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">vol_per_discharge</span><span class="p">,</span>
                <span class="s2">&quot;eroded volume [m^3]&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;eroded volume per </span><span class="si">{</span><span class="n">km_step</span><span class="si">}</span><span class="s2"> chainage km (</span><span class="si">{</span><span class="n">erosion_results</span><span class="o">.</span><span class="n">erosion_time</span><span class="si">}</span><span class="s2"> years)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Q</span><span class="si">{iq}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Bank </span><span class="si">{ib}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;fig_dir&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}{</span><span class="n">fig_i</span><span class="si">}</span><span class="s2">_eroded_volume&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">km_zoom</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot3_eroded_volume_subdivided_1</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">km_step</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">vol_per_discharge</span><span class="p">,</span>
                <span class="s2">&quot;eroded volume [m^3]&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;eroded volume per </span><span class="si">{</span><span class="n">km_step</span><span class="si">}</span><span class="s2"> chainage km (</span><span class="si">{</span><span class="n">erosion_results</span><span class="o">.</span><span class="n">erosion_time</span><span class="si">}</span><span class="s2"> years)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Q</span><span class="si">{iq}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;fig_dir&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;_eroded_volume_per_discharge&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">km_zoom</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot3_eroded_volume_subdivided_2</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">km_step</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">vol_per_discharge</span><span class="p">,</span>
                <span class="s2">&quot;eroded volume [m^3]&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;eroded volume per </span><span class="si">{</span><span class="n">km_step</span><span class="si">}</span><span class="s2"> chainage km (</span><span class="si">{</span><span class="n">erosion_results</span><span class="o">.</span><span class="n">erosion_time</span><span class="si">}</span><span class="s2"> years)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Bank </span><span class="si">{ib}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;fig_dir&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;_eroded_volume_per_bank&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">km_zoom</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot4_eroded_volume_eq</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">km_step</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol_per_km</span><span class="p">,</span>
                <span class="s2">&quot;eroded volume [m^3]&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;eroded volume per </span><span class="si">{</span><span class="n">km_step</span><span class="si">}</span><span class="s2"> chainage km (equilibrium)&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;fig_dir&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;_eroded_volume_eq&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">km_zoom</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">fig_path</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_path</span><span class="p">)</span>

            <span class="n">figlist</span><span class="p">,</span> <span class="n">axlist</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot5series_waterlevels_per_bank</span><span class="p">(</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">water_level</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">ship_wave_max</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">ship_wave_min</span><span class="p">,</span>
                <span class="s2">&quot;water level at Q</span><span class="si">{iq}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;average water level&quot;</span><span class="p">,</span>
                <span class="s2">&quot;wave influenced range&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">bank_height</span><span class="p">,</span>
                <span class="s2">&quot;level of bank&quot;</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
                <span class="s2">&quot;bank protection level&quot;</span><span class="p">,</span>
                <span class="s2">&quot;elevation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;(water)levels along bank line </span><span class="si">{ib}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;[m NAP]&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figlist</span><span class="p">):</span>
                    <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">fig_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;fig_dir&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fig_i</span><span class="si">}</span><span class="s2">_levels_bank_</span><span class="si">{</span><span class="n">ib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                        <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                            <span class="n">fig</span><span class="p">,</span>
                            <span class="n">axlist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                            <span class="n">fig_base</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                            <span class="n">km_zoom</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">fig_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fig_base</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;plot_ext&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_file</span><span class="p">)</span>

            <span class="n">figlist</span><span class="p">,</span> <span class="n">axlist</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot6series_velocity_per_bank</span><span class="p">(</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span>
                <span class="s2">&quot;velocity at Q</span><span class="si">{iq}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span>
                <span class="n">water_level_data</span><span class="o">.</span><span class="n">chezy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;critical velocity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;velocity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;velocity along bank line </span><span class="si">{ib}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;[m/s]&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">fig</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">figlist</span><span class="p">):</span>
                    <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">fig_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s1">&#39;fig_dir&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}{</span><span class="n">fig_i</span><span class="si">}</span><span class="s2">_velocity_bank_</span><span class="si">{</span><span class="n">ib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                        <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                            <span class="n">fig</span><span class="p">,</span>
                            <span class="n">axlist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                            <span class="n">fig_base</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                            <span class="n">km_zoom</span><span class="p">,</span>
                        <span class="p">)</span>

                    <span class="n">fig_file</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_file</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot7_banktype</span><span class="p">(</span>
                <span class="n">bbox</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_type</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">taucls_str</span><span class="p">,</span>
                <span class="n">X_AXIS_TITLE</span><span class="p">,</span>
                <span class="n">Y_AXIS_TITLE</span><span class="p">,</span>
                <span class="s2">&quot;bank type&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;fig_dir&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;_banktype&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_xy_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">xy_zoom</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">fig_file</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_file</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df_plt</span><span class="o">.</span><span class="n">plot8_eroded_distance</span><span class="p">(</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="s2">&quot;river chainage [km]&quot;</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">,</span>
                <span class="s2">&quot;Bank </span><span class="si">{ib}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">,</span>
                <span class="s2">&quot;Bank </span><span class="si">{ib}</span><span class="s2"> (eq)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eroded distance&quot;</span><span class="p">,</span>
                <span class="s2">&quot;[m]&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot&quot;</span><span class="p">]:</span>
                <span class="n">fig_i</span> <span class="o">=</span> <span class="n">fig_i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">fig_base</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;fig_dir&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fig_i</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;_erodis&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;save_plot_zoomed&quot;</span><span class="p">]:</span>
                    <span class="n">df_plt</span><span class="o">.</span><span class="n">zoom_x_and_save</span><span class="p">(</span>
                        <span class="n">fig</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">,</span>
                        <span class="n">fig_base</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">],</span>
                        <span class="n">km_zoom</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="n">fig_file</span> <span class="o">=</span> <span class="n">fig_base</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;plot_ext&quot;</span><span class="p">]</span>
                <span class="n">df_plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">fig_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">[</span><span class="s2">&quot;close_plot&quot;</span><span class="p">]:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.config_file" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.config_file" class="toclink">
            <code class="highlight language-python"><span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.config_file" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Configuration file object.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize the Erosion class.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Erosion class.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">root_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config_file</span> <span class="o">=</span> <span class="n">config_file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="n">gui</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">ErosionRiverData</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">get_erosion_sim_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bl_processor</span> <span class="o">=</span> <span class="n">BankLinesProcessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debugger</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="toclink">
            <code class="highlight language-python"><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span><span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Map bank data to fairway data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bank_data</code>
            </td>
            <td>
                  <code><span title="dfastbe.bank_erosion.data_models.calculation.BankData">BankData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fairway_data</code>
            </td>
            <td>
                  <code><span title="dfastbe.bank_erosion.data_models.calculation.FairwayData">FairwayData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simulation_data</code>
            </td>
            <td>
                  <code><span title="dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData">ErosionSimulationData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method updates the following attributes in the <code>bank_data</code> instance
- fairway_face_indices
- fairway_distances</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and the following attributes in the <code>fairway_data</code> instance
- fairway_initial_water_levels</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_fairway_bank_line_distance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map bank data to fairway data.</span>

<span class="sd">    Args:</span>
<span class="sd">        bank_data (BankData):</span>
<span class="sd">        fairway_data (FairwayData):</span>
<span class="sd">        simulation_data (ErosionSimulationData):</span>

<span class="sd">    Returns:</span>
<span class="sd">        The method updates the following attributes in the `bank_data` instance</span>
<span class="sd">            - fairway_face_indices</span>
<span class="sd">            - fairway_distances</span>
<span class="sd">        and the following attributes in the `fairway_data` instance</span>
<span class="sd">            - fairway_initial_water_levels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># distance fairway-bankline (bank-fairway)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_distance_fairway&quot;</span><span class="p">)</span>

    <span class="n">num_fairway_face_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">bank_i</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
        <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
        <span class="n">coords_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">bank_fairway_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">))</span>
        <span class="n">bp_fw_face_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">coord_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">):</span>
            <span class="c1"># find closest fairway support node</span>
            <span class="n">closest_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fairway_coord</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_coord</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="c1"># If fairway support node is also the closest projected fairway point, then it likely</span>
            <span class="c1"># that that point is one of the original support points (a corner) of the fairway path</span>
            <span class="c1"># and located inside a grid cell. The segments before and after that point will then</span>
            <span class="c1"># both be located inside that same grid cell, so let&#39;s pick the segment before the point.</span>
            <span class="c1"># If the point happens to coincide with a grid edge and the two segments are located</span>
            <span class="c1"># in different grid cells, then we could either simply choose one or add complexity to</span>
            <span class="c1"># average the values of the two grid cells. Let&#39;s go for the simplest approach ...</span>
            <span class="n">iseg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                    <span class="n">closest_ind</span><span class="p">,</span>
                    <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">coord_i</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span>
                        <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                    <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                        <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                        <span class="c1"># projected point located on segment before, which corresponds to initial choice: iseg = ifw - 1</span>
            <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&lt;</span> <span class="n">num_fairway_face_ind</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                    <span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">closest_ind</span><span class="p">,</span>
                    <span class="n">coord_i</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                    <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                        <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                        <span class="n">iseg</span> <span class="o">=</span> <span class="n">closest_ind</span>

            <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>
            <span class="n">bank_fairway_dist</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_bank_distance</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bank_</span><span class="si">{</span><span class="n">bank_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">_chainage_and_fairway_face_idx.shp&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                    <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">bank_i</span><span class="p">],</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bp_fw_face_idx</span>
        <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span> <span class="o">=</span> <span class="n">bank_fairway_dist</span>

    <span class="c1"># water level at fairway</span>
    <span class="n">water_level_fairway_ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="n">bank_data</span><span class="p">:</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span>
        <span class="n">water_level_fairway_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span> <span class="o">=</span> <span class="n">water_level_fairway_ref</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="toclink">
            <code class="highlight language-python"><span class="n">compute_erosion_per_level</span><span class="p">(</span><span class="n">level_i</span><span class="p">,</span> <span class="n">bank_data</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">,</span> <span class="n">discharge_level_pars</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">,</span> <span class="n">km_bin</span><span class="p">,</span> <span class="n">num_km</span><span class="p">,</span> <span class="n">bank_height</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Compute the bank erosion for a given level.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_erosion_per_level</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">level_i</span><span class="p">,</span>
    <span class="n">bank_data</span><span class="p">,</span>
    <span class="n">simulation_data</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">,</span>
    <span class="n">discharge_level_pars</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">,</span>
    <span class="n">km_bin</span><span class="p">,</span>
    <span class="n">num_km</span><span class="p">,</span>
    <span class="n">bank_height</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the bank erosion for a given level.&quot;&quot;&quot;</span>
    <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
    <span class="n">dvol_bank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_km</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">par_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">bank_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
        <span class="n">parameter</span> <span class="o">=</span> <span class="n">SingleCalculation</span><span class="p">()</span>
        <span class="c1"># bank_i = 0: left bank, bank_i = 1: right bank</span>
        <span class="c1"># calculate velocity along banks ...</span>
        <span class="n">parameter</span><span class="o">.</span><span class="n">bank_velocity</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_velocity</span><span class="p">(</span>
            <span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">vel_dx</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># determine velocity and bank height along banks ...</span>
            <span class="c1"># bank height = maximum bed elevation per cell</span>
            <span class="n">bank_height</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_height</span><span class="p">(</span><span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">zb_dx</span><span class="p">))</span>

        <span class="c1"># get water depth along the fair-way</span>
        <span class="n">ii_face</span> <span class="o">=</span> <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_face_indices</span>
        <span class="n">water_depth_fairway</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">water_depth_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
        <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hfw_max_level</span><span class="p">,</span> <span class="n">water_depth_fairway</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="n">parameter</span><span class="o">.</span><span class="n">water_level</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
        <span class="n">chez_face</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">chezy_face</span><span class="p">[</span><span class="n">ii_face</span><span class="p">]</span>
        <span class="n">parameter</span><span class="o">.</span><span class="n">chezy</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">chez_face</span> <span class="o">+</span> <span class="n">chez_face</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># last discharge level</span>
        <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">erosion_distance_eq</span><span class="p">,</span> <span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">comp_erosion_eq</span><span class="p">(</span>
                <span class="n">bank_height</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                <span class="n">water_depth_fairway</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_eq</span> <span class="o">=</span> <span class="n">erosion_distance_eq</span>
            <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">erosion_volume_eq</span>

        <span class="n">parameter</span> <span class="o">=</span> <span class="n">compute_bank_erosion_dynamics</span><span class="p">(</span>
            <span class="n">parameter</span><span class="p">,</span>
            <span class="n">bank_height</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
            <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
            <span class="n">water_depth_fairway</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># accumulate eroded volumes per km</span>
        <span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span> <span class="n">km_bin</span>
        <span class="p">)</span>
        <span class="n">parameter</span><span class="o">.</span><span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">volume_per_discharge</span>
        <span class="n">par_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>

        <span class="n">dvol_bank</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">volume_per_discharge</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_debug_output</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span>
                <span class="n">ind</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="p">,</span>
                <span class="n">discharge_level_pars</span><span class="p">,</span>
                <span class="n">water_depth_fairway</span><span class="p">,</span>
                <span class="n">bank_height</span><span class="p">,</span>
                <span class="n">num_levels</span><span class="p">,</span>
                <span class="n">parameter</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">level_calculation</span> <span class="o">=</span> <span class="n">CalculationLevel</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hfw_max</span><span class="o">=</span><span class="n">hfw_max_level</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">level_calculation</span><span class="p">,</span> <span class="n">dvol_bank</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.get_ship_parameters" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.get_ship_parameters" class="toclink">
            <code class="highlight language-python"><span class="n">get_ship_parameters</span><span class="p">(</span><span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.get_ship_parameters" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get ship parameters from the configuration file.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_ship_parameters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get ship parameters from the configuration file.&quot;&quot;&quot;</span>
    <span class="n">ship_relative_velocity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;VShip&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">num_ships_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;NShip&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">num_waves_p_ship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NWave&quot;</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ship_draught</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;Draught&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">ship_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;ShipType&quot;</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">parslope0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Slope&quot;</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
        <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;slp&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reed_wave_damping_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
        <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Reed&quot;</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;rdd&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ship_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;vship0&quot;</span><span class="p">:</span> <span class="n">ship_relative_velocity</span><span class="p">,</span>
        <span class="s2">&quot;Nship0&quot;</span><span class="p">:</span> <span class="n">num_ships_year</span><span class="p">,</span>
        <span class="s2">&quot;nwave0&quot;</span><span class="p">:</span> <span class="n">num_waves_p_ship</span><span class="p">,</span>
        <span class="s2">&quot;Tship0&quot;</span><span class="p">:</span> <span class="n">ship_draught</span><span class="p">,</span>
        <span class="s2">&quot;ship0&quot;</span><span class="p">:</span> <span class="n">ship_type</span><span class="p">,</span>
        <span class="s2">&quot;parslope0&quot;</span><span class="p">:</span> <span class="n">parslope0</span><span class="p">,</span>
        <span class="s2">&quot;parreed0&quot;</span><span class="p">:</span> <span class="n">reed_wave_damping_coeff</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ship_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.run" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="toclink">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Run the bank erosion analysis for a specified configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the bank erosion analysis for a specified configuration.&quot;&quot;&quot;</span>
    <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- start analysis --&quot;</span><span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span>
        <span class="s2">&quot;header_bankerosion&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/Deltares/D-FAST_Bank_Erosion&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">config_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span>

    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;derive_topology&quot;</span><span class="p">)</span>

    <span class="n">mesh_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">compute_mesh_topology</span><span class="p">()</span>
    <span class="n">river_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_river_axis_by_center_line</span><span class="p">()</span>

    <span class="c1"># map to the output interval</span>
    <span class="n">km_bin</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">km_mid</span> <span class="o">=</span> <span class="n">get_km_bins</span><span class="p">(</span><span class="n">km_bin</span><span class="p">,</span> <span class="n">station_type</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">)</span>  <span class="c1"># get mid-points</span>

    <span class="n">fairway_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_fairway_data</span><span class="p">(</span><span class="n">river_axis</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">)</span>

    <span class="c1"># map bank lines to mesh cells</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;intersect_bank_mesh&quot;</span><span class="p">)</span>
    <span class="n">bank_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bl_processor</span><span class="o">.</span><span class="n">intersect_with_mesh</span><span class="p">(</span><span class="n">mesh_data</span><span class="p">)</span>
    <span class="c1"># map the bank data to the fairway data (the bank_data and fairway_data will be updated inside the `_map_bank_to_fairway` function)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span>
        <span class="n">bank_data</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span>
    <span class="p">)</span>

    <span class="n">num_stations_per_bank</span> <span class="o">=</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span>
    <span class="n">erosion_inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_initial_conditions</span><span class="p">(</span>
        <span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">fairway_data</span>
    <span class="p">)</span>

    <span class="c1"># initialize arrays for erosion loop over all discharges</span>
    <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_discharge_levels</span><span class="p">(</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_erosion_results</span><span class="p">(</span>
            <span class="n">km_bin</span><span class="p">,</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_write_bankline_shapefiles</span><span class="p">(</span>
        <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">config_file</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_volume_outputs</span><span class="p">(</span><span class="n">erosion_results</span><span class="p">,</span> <span class="n">km_mid</span><span class="p">)</span>

    <span class="c1"># create various plots</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_generate_plots</span><span class="p">(</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">,</span>
        <span class="n">xy_line_eq_list</span><span class="p">,</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="n">water_level_data</span><span class="p">,</span>
        <span class="n">mesh_data</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">,</span>
        <span class="n">erosion_results</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;end_bankerosion&quot;</span><span class="p">)</span>
    <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- end analysis --&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="mesh-processing"><a class="toclink" href="#mesh-processing">Mesh Processing</a><a class="headerlink" href="#mesh-processing" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.mesh_processor" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh_processor" class="toclink">
            <code>dfastbe.bank_erosion.mesh_processor</code>


</a><a href="#dfastbe.bank_erosion.mesh_processor" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>module for processing mesh-related operations.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="dfastbe.bank_erosion.mesh_processor.enlarge" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh_processor.enlarge" class="toclink">
            <code class="highlight language-python"><span class="n">enlarge</span><span class="p">(</span><span class="n">old_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh_processor.enlarge" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">

        <p>Copy the values of the old array to a new, larger array of specified shape.</p>
<h5 id="dfastbe.bank_erosion.mesh_processor.enlarge--arguments"><a class="toclink" href="#dfastbe.bank_erosion.mesh_processor.enlarge--arguments">Arguments</a><a class="headerlink" href="#dfastbe.bank_erosion.mesh_processor.enlarge--arguments" title="Permanent link">#</a></h5>
<p>old_array : numpy.ndarray
    Array containing the values.
new_shape : Tuple
    New shape of the array.</p>
<h5 id="dfastbe.bank_erosion.mesh_processor.enlarge--returns"><a class="toclink" href="#dfastbe.bank_erosion.mesh_processor.enlarge--returns">Returns</a><a class="headerlink" href="#dfastbe.bank_erosion.mesh_processor.enlarge--returns" title="Permanent link">#</a></h5>
<p>new_array : numpy.ndarray
    Array of shape "new_shape" with the 'first entries filled by the same
    values as contained in "old_array". The data type of the new array is
    equal to that of the old array.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh_processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">enlarge</span><span class="p">(</span>
    <span class="n">old_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">new_shape</span><span class="p">:</span> <span class="n">Tuple</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Copy the values of the old array to a new, larger array of specified shape.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    old_array : numpy.ndarray</span>
<span class="sd">        Array containing the values.</span>
<span class="sd">    new_shape : Tuple</span>
<span class="sd">        New shape of the array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_array : numpy.ndarray</span>
<span class="sd">        Array of shape &quot;new_shape&quot; with the &#39;first entries filled by the same</span>
<span class="sd">        values as contained in &quot;old_array&quot;. The data type of the new array is</span>
<span class="sd">        equal to that of the old array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_shape</span> <span class="o">=</span> <span class="n">old_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;old: &quot;</span><span class="p">,</span> <span class="n">old_shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new: &quot;</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">)</span>
    <span class="n">new_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">old_array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">new_array</span><span class="p">[:</span><span class="n">old_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">old_array</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">new_array</span><span class="p">[:</span><span class="n">old_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">old_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">old_array</span>
    <span class="k">return</span> <span class="n">new_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dfastbe.bank_erosion.mesh_processor.get_slices_ab" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab" class="toclink">
            <code class="highlight language-python"><span class="n">get_slices_ab</span><span class="p">(</span><span class="n">X0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Y0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">X1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Y1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xi0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">yi0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">yi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">bmax1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">

        <p>Get the relative locations a and b at which a segment intersects/slices a number of edges.</p>
<h5 id="dfastbe.bank_erosion.mesh_processor.get_slices_ab--arguments"><a class="toclink" href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab--arguments">Arguments</a><a class="headerlink" href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab--arguments" title="Permanent link">#</a></h5>
<p>X0 : np.ndarray
    Array containing the x-coordinates of the start point of each edge.
X1 : np.ndarray
    Array containing the x-coordinates of the end point of each edge.
Y0 : np.ndarray
    Array containing the y-coordinates of the start point of each edge.
Y1 : np.ndarray
    Array containing the y-coordinates of the end point of each edge.
xi0 : float
    x-coordinate of start point of the segment.
xi1 : float
    x-coordinate of end point of the segment.
yi0 : float
    y-coordinate of start point of the segment.
yi1 : float
    y-coordinate of end point of the segment.
bmin : float
    Minimum relative distance from bpj1 at which slice should occur.
bmax1 : bool
    Flag indicating whether the the relative distance along the segment bpj1-bpj should be limited to 1.</p>
<h5 id="dfastbe.bank_erosion.mesh_processor.get_slices_ab--returns"><a class="toclink" href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab--returns">Returns</a><a class="headerlink" href="#dfastbe.bank_erosion.mesh_processor.get_slices_ab--returns" title="Permanent link">#</a></h5>
<p>a : np.ndarray
    Array containing relative distance along each edge.
b : np.ndarray
    Array containing relative distance along the segment for each edge.
slices : np.ndarray
    Array containing a flag indicating whether the edge is sliced at a valid location.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh_processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_slices_ab</span><span class="p">(</span>
    <span class="n">X0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Y0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">X1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">Y1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">xi0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">yi0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">xi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">yi1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">bmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">bmax1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the relative locations a and b at which a segment intersects/slices a number of edges.</span>

<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    X0 : np.ndarray</span>
<span class="sd">        Array containing the x-coordinates of the start point of each edge.</span>
<span class="sd">    X1 : np.ndarray</span>
<span class="sd">        Array containing the x-coordinates of the end point of each edge.</span>
<span class="sd">    Y0 : np.ndarray</span>
<span class="sd">        Array containing the y-coordinates of the start point of each edge.</span>
<span class="sd">    Y1 : np.ndarray</span>
<span class="sd">        Array containing the y-coordinates of the end point of each edge.</span>
<span class="sd">    xi0 : float</span>
<span class="sd">        x-coordinate of start point of the segment.</span>
<span class="sd">    xi1 : float</span>
<span class="sd">        x-coordinate of end point of the segment.</span>
<span class="sd">    yi0 : float</span>
<span class="sd">        y-coordinate of start point of the segment.</span>
<span class="sd">    yi1 : float</span>
<span class="sd">        y-coordinate of end point of the segment.</span>
<span class="sd">    bmin : float</span>
<span class="sd">        Minimum relative distance from bpj1 at which slice should occur.</span>
<span class="sd">    bmax1 : bool</span>
<span class="sd">        Flag indicating whether the the relative distance along the segment bpj1-bpj should be limited to 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : np.ndarray</span>
<span class="sd">        Array containing relative distance along each edge.</span>
<span class="sd">    b : np.ndarray</span>
<span class="sd">        Array containing relative distance along the segment for each edge.</span>
<span class="sd">    slices : np.ndarray</span>
<span class="sd">        Array containing a flag indicating whether the edge is sliced at a valid location.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dX</span> <span class="o">=</span> <span class="n">X1</span> <span class="o">-</span> <span class="n">X0</span>
    <span class="n">dY</span> <span class="o">=</span> <span class="n">Y1</span> <span class="o">-</span> <span class="n">Y0</span>
    <span class="n">dxi</span> <span class="o">=</span> <span class="n">xi1</span> <span class="o">-</span> <span class="n">xi0</span>
    <span class="n">dyi</span> <span class="o">=</span> <span class="n">yi1</span> <span class="o">-</span> <span class="n">yi0</span>
    <span class="n">det</span> <span class="o">=</span> <span class="n">dX</span> <span class="o">*</span> <span class="n">dyi</span> <span class="o">-</span> <span class="n">dY</span> <span class="o">*</span> <span class="n">dxi</span>
    <span class="n">det</span><span class="p">[</span><span class="n">det</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-10</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">dyi</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi0</span> <span class="o">-</span> <span class="n">X0</span><span class="p">)</span> <span class="o">-</span> <span class="n">dxi</span> <span class="o">*</span> <span class="p">(</span><span class="n">yi0</span> <span class="o">-</span> <span class="n">Y0</span><span class="p">))</span> <span class="o">/</span> <span class="n">det</span>  <span class="c1"># along mesh edge</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">dY</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi0</span> <span class="o">-</span> <span class="n">X0</span><span class="p">)</span> <span class="o">-</span> <span class="n">dX</span> <span class="o">*</span> <span class="p">(</span><span class="n">yi0</span> <span class="o">-</span> <span class="n">Y0</span><span class="p">))</span> <span class="o">/</span> <span class="n">det</span>  <span class="c1"># along bank line</span>
    <span class="k">if</span> <span class="n">bmax1</span><span class="p">:</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">bmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">bmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">slices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dfastbe.bank_erosion.mesh_processor.intersect_line_mesh" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh_processor.intersect_line_mesh" class="toclink">
            <code class="highlight language-python"><span class="n">intersect_line_mesh</span><span class="p">(</span><span class="n">bp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span> <span class="n">d_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh_processor.intersect_line_mesh" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">

        <p>Intersects a line with an unstructured mesh and returns the intersection coordinates and mesh face indices.</p>
<p>This function determines where a given line (e.g., a bank line) intersects the faces of an unstructured mesh.
It calculates the intersection points and identifies the mesh faces corresponding to each segment of the line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bp</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2D array of shape (N, 2) containing the x, y coordinates of the line to be intersected with the mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_data</code>
            </td>
            <td>
                  <code><span title="dfastbe.bank_erosion.data_models.calculation.MeshData">MeshData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the <code>MeshData</code> class containing mesh-related data, such as face coordinates, edge coordinates,
and connectivity information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_thresh</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A distance threshold for filtering out very small segments. Segments shorter than this threshold will be removed.
Defaults to 0.001.</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray]:
A tuple containing:
- <code>crds</code> (np.ndarray): A 2D array of shape (M, 2) containing the x, y coordinates of the intersection points.
- <code>idx</code> (np.ndarray): A 1D array of shape (M-1,) containing the indices of the mesh faces corresponding to
  each segment of the intersected line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the line starts outside the mesh and cannot be associated with any mesh face, or if the line crosses
ambiguous regions (e.g., edges shared by multiple faces).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function uses Shapely geometry operations to determine whether points are inside polygons or on edges.</li>
<li>The function handles cases where the line starts outside the mesh, crosses multiple edges, or ends on a node.</li>
<li>Tiny segments shorter than <code>d_thresh</code> are removed from the output.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh_processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">intersect_line_mesh</span><span class="p">(</span>
    <span class="n">bp</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span>
    <span class="n">d_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Intersects a line with an unstructured mesh and returns the intersection coordinates and mesh face indices.</span>

<span class="sd">    This function determines where a given line (e.g., a bank line) intersects the faces of an unstructured mesh.</span>
<span class="sd">    It calculates the intersection points and identifies the mesh faces corresponding to each segment of the line.</span>

<span class="sd">    Args:</span>
<span class="sd">        bp (np.ndarray):</span>
<span class="sd">            A 2D array of shape (N, 2) containing the x, y coordinates of the line to be intersected with the mesh.</span>
<span class="sd">        mesh_data (MeshData):</span>
<span class="sd">            An instance of the `MeshData` class containing mesh-related data, such as face coordinates, edge coordinates,</span>
<span class="sd">            and connectivity information.</span>
<span class="sd">        d_thresh (float, optional):</span>
<span class="sd">            A distance threshold for filtering out very small segments. Segments shorter than this threshold will be removed.</span>
<span class="sd">            Defaults to 0.001.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - `crds` (np.ndarray): A 2D array of shape (M, 2) containing the x, y coordinates of the intersection points.</span>
<span class="sd">            - `idx` (np.ndarray): A 1D array of shape (M-1,) containing the indices of the mesh faces corresponding to</span>
<span class="sd">              each segment of the intersected line.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception:</span>
<span class="sd">            If the line starts outside the mesh and cannot be associated with any mesh face, or if the line crosses</span>
<span class="sd">            ambiguous regions (e.g., edges shared by multiple faces).</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function uses Shapely geometry operations to determine whether points are inside polygons or on edges.</span>
<span class="sd">        - The function handles cases where the line starts outside the mesh, crosses multiple edges, or ends on a node.</span>
<span class="sd">        - Tiny segments shorter than `d_thresh` are removed from the output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">vindex</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bpj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current location: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bpj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># first bp inside or outside?</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_face_coords</span> <span class="o">-</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_face_coords</span> <span class="o">-</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">possible_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
                <span class="o">~</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="o">|</span> <span class="p">(</span><span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="o">|</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="o">|</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_cells</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># no cells found ... it must be outside</span>
                <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting outside mesh&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># one or more possible cells, check whether it&#39;s really inside one of them</span>
                <span class="c1"># using np math might be faster, but since it&#39;s should only be for a few points let&#39;s use Shapely</span>
                <span class="c1"># a point on the edge of a polygon is not contained in the polygon.</span>
                <span class="c1"># a point on the edge of two polygons will thus be considered outside the mesh whereas it actually isn&#39;t.</span>
                <span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">possible_cells</span><span class="p">:</span>
                    <span class="n">polygon_k</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_face_coords</span><span class="p">[</span>
                                <span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">],</span>
                                <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_face_coords</span><span class="p">[</span>
                                <span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">],</span>
                            <span class="p">),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">polygon_k</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pnt</span><span class="p">):</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">k</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">on_edge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">possible_cells</span><span class="p">:</span>
                        <span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_face_coords</span><span class="p">[</span>
                                <span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">],</span>
                                <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_face_coords</span><span class="p">[</span>
                                <span class="n">k</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">],</span>
                            <span class="p">),</span>
                            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                        <span class="n">line_k</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nd</span><span class="p">,</span> <span class="n">nd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">line_k</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pnt</span><span class="p">):</span>
                            <span class="n">on_edge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">on_edge</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting outside mesh&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">on_edge</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">on_edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
                            <span class="n">vindex</span> <span class="o">=</span> <span class="n">on_edge</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting on edge of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">on_edge</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;determine direction!&quot;</span><span class="p">)</span>
            <span class="n">crds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bpj</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">vindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
            <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># second or later point</span>
            <span class="n">bpj1</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">prev_b</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                    <span class="n">index_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vindex</span><span class="p">:</span>
                        <span class="n">b1</span><span class="p">,</span> <span class="n">edges1</span><span class="p">,</span> <span class="n">nodes1</span> <span class="o">=</span> <span class="n">_get_slices</span><span class="p">(</span>
                            <span class="n">i</span><span class="p">,</span>
                            <span class="n">prev_b</span><span class="p">,</span>
                            <span class="n">bpj</span><span class="p">,</span>
                            <span class="n">bpj1</span><span class="p">,</span>
                            <span class="n">mesh_data</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edges</span><span class="p">,</span> <span class="n">edges1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">index_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">index_src</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">edges1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">edges</span><span class="p">,</span> <span class="n">id_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>
                    <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>
                    <span class="n">index_src</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_src</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">vindex</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">bpj</span> <span class="o">==</span> <span class="n">bpj1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="c1"># this is a segment of length 0, skip it since it takes us nowhere</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">b</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">_get_slices</span><span class="p">(</span>
                        <span class="n">index</span><span class="p">,</span>
                        <span class="n">prev_b</span><span class="p">,</span>
                        <span class="n">bpj</span><span class="p">,</span>
                        <span class="n">bpj1</span><span class="p">,</span>
                        <span class="n">mesh_data</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># rest of segment associated with same face</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">prev_b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: -- no further slices along this segment --&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: -- no slices along this segment --&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">bpj</span><span class="p">)</span>
                            <span class="n">polygon_k</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                                    <span class="p">(</span>
                                        <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_face_coords</span><span class="p">[</span>
                                        <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                                        <span class="p">],</span>
                                        <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_face_coords</span><span class="p">[</span>
                                        <span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="p">:</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                                        <span class="p">],</span>
                                    <span class="p">),</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon_k</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pnt</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: ERROR: point actually not contained within </span><span class="si">{}</span><span class="s2">!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">index</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="n">crds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">crds</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">crds</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ind</span><span class="p">,))</span>
                    <span class="n">crds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bpj</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">index0</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># line segment crosses the edge list multiple times</span>
                        <span class="c1"># - moving out of a cell at a corner node</span>
                        <span class="c1"># - moving into and out of the mesh from outside</span>
                        <span class="c1"># select first crossing ...</span>
                        <span class="n">bmin</span> <span class="o">=</span> <span class="n">b</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">bmin</span><span class="p">]</span>
                        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">bmin</span><span class="p">]</span>
                        <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">bmin</span><span class="p">]</span>

                    <span class="c1"># slice location identified ...</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">faces</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
                    <span class="n">prev_b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">node</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># if we slice at a node ...</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving via node </span><span class="si">{}</span><span class="s2"> on edges </span><span class="si">{}</span><span class="s2"> at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="c1"># figure out where we will be heading afterwards ...</span>
                        <span class="n">all_node_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_node</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="c1"># segment passes through node and enter non-neighbouring cell ...</span>
                            <span class="c1"># direction of current segment from bpj1 to bpj</span>
                            <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">bpj</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bpj1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bpj1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="c1"># catch case of last segment</span>
                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: last point ends in a node&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                                <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="n">crds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                    <span class="n">crds</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">crds</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                                    <span class="n">idx</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,))</span>
                                <span class="n">crds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bpj</span>
                                <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                                    <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">vindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># this segment ends in the node, so check next segment ...</span>
                                <span class="c1"># direction of next segment from bpj to bp[j+1]</span>
                                <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                                    <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving in direction theta = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">theta</span><span class="p">))</span>
                        <span class="n">twopi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                        <span class="n">left_edge</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">left_dtheta</span> <span class="o">=</span> <span class="n">twopi</span>
                        <span class="n">right_edge</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="n">right_dtheta</span> <span class="o">=</span> <span class="n">twopi</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: the edges connected to node </span><span class="si">{}</span><span class="s2"> are </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">all_node_edges</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="n">all_node_edges</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node</span><span class="p">:</span>
                                <span class="n">theta_edge</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                                    <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                                    <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                    <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                                    <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                    <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">theta_edge</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                                    <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                                    <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                                    <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="p">)</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: edge </span><span class="si">{}</span><span class="s2"> connects </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="p">:]</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: edge </span><span class="si">{}</span><span class="s2"> theta is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ie</span><span class="p">,</span> <span class="n">theta_edge</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_edge</span> <span class="o">-</span> <span class="n">theta</span>
                            <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="n">left_dtheta</span><span class="p">:</span>
                                    <span class="n">left_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                    <span class="n">left_dtheta</span> <span class="o">=</span> <span class="n">dtheta</span>
                                <span class="k">if</span> <span class="n">twopi</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="n">right_dtheta</span><span class="p">:</span>
                                    <span class="n">right_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                    <span class="n">right_dtheta</span> <span class="o">=</span> <span class="n">twopi</span> <span class="o">-</span> <span class="n">dtheta</span>
                            <span class="k">elif</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">dtheta</span> <span class="o">=</span> <span class="o">-</span><span class="n">dtheta</span>
                                <span class="k">if</span> <span class="n">twopi</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="n">left_dtheta</span><span class="p">:</span>
                                    <span class="n">left_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                    <span class="n">left_dtheta</span> <span class="o">=</span> <span class="n">twopi</span> <span class="o">-</span> <span class="n">dtheta</span>
                                <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="n">right_dtheta</span><span class="p">:</span>
                                    <span class="n">right_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                    <span class="n">right_dtheta</span> <span class="o">=</span> <span class="n">dtheta</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># aligned with edge</span>
                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span>
                                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: line is aligned with edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ie</span><span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="n">left_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                <span class="n">right_edge</span> <span class="o">=</span> <span class="n">ie</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: the edge to the left is edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">left_edge</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: the edge to the right is edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">left_edge</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="n">left_edge</span> <span class="o">==</span> <span class="n">right_edge</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: continue along edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">left_edge</span><span class="p">))</span>
                            <span class="n">index0</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">left_edge</span><span class="p">,</span> <span class="p">:]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: continue between edges </span><span class="si">{}</span><span class="s2"> on the left and </span><span class="si">{}</span><span class="s2"> on the right&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">left_edge</span><span class="p">,</span> <span class="n">right_edge</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="n">left_faces</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">left_edge</span><span class="p">,</span> <span class="p">:]</span>
                            <span class="n">right_faces</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span>
                                          <span class="n">right_edge</span><span class="p">,</span> <span class="p">:</span>
                                          <span class="p">]</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span>
                                    <span class="ow">and</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span>
                            <span class="p">):</span>
                                <span class="c1"># the two edges are shared by two faces ... check first face</span>
                                <span class="n">fn1</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                <span class="n">fe1</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                    <span class="nb">print</span><span class="p">(</span>
                                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: those edges are shared by two faces: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">j</span><span class="p">,</span> <span class="n">left_faces</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span>
                                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: face </span><span class="si">{}</span><span class="s2"> has nodes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">j</span><span class="p">,</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fn1</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span>
                                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: face </span><span class="si">{}</span><span class="s2"> has edges: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">j</span><span class="p">,</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fe1</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="c1"># here we need that the nodes of the face are listed in clockwise order</span>
                                <span class="c1"># and that edges[i] is the edge connecting node[i-1] with node[i]</span>
                                <span class="c1"># the latter is guaranteed by batch.derive_topology_arrays</span>
                                <span class="k">if</span> <span class="n">fe1</span><span class="p">[</span><span class="n">fn1</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">right_edge</span><span class="p">:</span>
                                    <span class="n">index0</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">index0</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
                                <span class="n">index0</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
                                <span class="n">index0</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                                    <span class="s2">&quot;Shouldn&#39;t come here .... left edge </span><span class="si">{}</span><span class="s2"> and right edge </span><span class="si">{}</span><span class="s2"> don&#39;t share any face&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">left_edge</span><span class="p">,</span> <span class="n">right_edge</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># ending at slice point, so ending on an edge ...</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: ending on edge </span><span class="si">{}</span><span class="s2"> at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="c1"># figure out where we will be heading afterwards ...</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># catch case of last segment</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: last point ends on an edge&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="n">crds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                                <span class="n">crds</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">crds</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                                <span class="n">idx</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,))</span>
                            <span class="n">crds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bpj</span>
                            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                                <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">vindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                            <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># this segment ends on the edge, so check next segment ...</span>
                            <span class="c1"># direction of next segment from bpj to bp[j+1]</span>
                            <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                                <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bpj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving in direction theta = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">theta</span><span class="p">))</span>
                        <span class="n">theta_edge</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                            <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="n">theta</span> <span class="o">==</span> <span class="n">theta_edge</span> <span class="ow">or</span> <span class="n">theta</span> <span class="o">==</span> <span class="o">-</span><span class="n">theta_edge</span><span class="p">:</span>
                            <span class="c1"># aligned with edge</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: continue along edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">edge</span><span class="p">))</span>
                            <span class="n">index0</span> <span class="o">=</span> <span class="n">faces</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># check whether the (extended) segment slices any edge of faces[0]</span>
                            <span class="n">fe1</span> <span class="o">=</span> <span class="n">mesh_data</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="n">_get_slices_core</span><span class="p">(</span>
                                <span class="n">fe1</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">,</span> <span class="n">bpj</span><span class="p">,</span> <span class="n">bp</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">False</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="c1"># yes, a slice (typically 1, but could be 2 if it slices at a node</span>
                                <span class="c1"># but that doesn&#39;t matter) ... so, we continue towards faces[0]</span>
                                <span class="n">index0</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># no slice for faces[0], so we must be going in the other direction</span>
                                <span class="n">index0</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">index0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving from outside via node </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> at b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">prev_b</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving from edge between </span><span class="si">{}</span><span class="s2"> via node </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> at b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">vindex</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">prev_b</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving from </span><span class="si">{}</span><span class="s2"> via node </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> at b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                        <span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">prev_b</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>

                        <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">isinstance</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                                <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                        <span class="p">):</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">index0</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">index0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
                            <span class="n">vindex</span> <span class="o">=</span> <span class="n">index0</span>

                    <span class="k">elif</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving from </span><span class="si">{}</span><span class="s2"> via edge </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> at b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prev_b</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">: moving from </span><span class="si">{}</span><span class="s2"> via edge </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2"> at b = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                    <span class="n">j</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prev_b</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s2">&quot;Shouldn&#39;t come here .... index </span><span class="si">{}</span><span class="s2"> differs from both faces </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> associated with slicing edge </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">index</span><span class="p">,</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edge</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="n">crds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">crds</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">crds</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ind</span><span class="p">,))</span>
                    <span class="n">crds</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bpj1</span> <span class="o">+</span> <span class="n">prev_b</span> <span class="o">*</span> <span class="p">(</span><span class="n">bpj</span> <span class="o">-</span> <span class="n">bpj1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">vindex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">prev_b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">break</span>

    <span class="c1"># clip to actual length (idx refers to segments, so we can ignore the last value)</span>
    <span class="n">crds</span> <span class="o">=</span> <span class="n">crds</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[:</span> <span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># remove tiny segments</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">crds</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">),</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">d_thresh</span><span class="p">))</span>
    <span class="n">crds</span> <span class="o">=</span> <span class="n">crds</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

    <span class="c1"># since index refers to segments, don&#39;t return the first one</span>
    <span class="k">return</span> <span class="n">crds</span><span class="p">,</span> <span class="n">idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="debugging-utilities"><a class="toclink" href="#debugging-utilities">Debugging Utilities</a><a class="headerlink" href="#debugging-utilities" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.debugger" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger" class="toclink">
            <code>dfastbe.bank_erosion.debugger</code>


</a><a href="#dfastbe.bank_erosion.debugger" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>Bank Erosion Debugger.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.debugger.Debugger" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger" class="toclink">
            <code>Debugger</code>


</a><a href="#dfastbe.bank_erosion.debugger.Debugger" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to handle debugging and output of bank erosion calculations.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Debugger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle debugging and output of bank erosion calculations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Debugger constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">last_discharge_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
        <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="n">water_depth_fairway</span><span class="p">,</span>
        <span class="n">dn_eq1</span><span class="p">,</span>
        <span class="n">dv_eq1</span><span class="p">,</span>
        <span class="n">bank_height</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the last discharge level to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">bank_height</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
            <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
            <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
            <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
            <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
            <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
            <span class="s2">&quot;bank_fairway_dist&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">water_depth_fairway</span><span class="p">,</span>
            <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">dn_eq1</span><span class="p">,</span>
            <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">dv_eq1</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.EQ.B</span><span class="si">{</span><span class="n">bank_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">middle_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
        <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="n">water_depth_fairway</span><span class="p">,</span>
        <span class="n">velocity</span><span class="p">,</span>
        <span class="n">bank_height</span><span class="p">,</span>
        <span class="n">parameter</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the middle levels to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">velocity</span><span class="p">,</span>
            <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">bank_height</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
            <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="s2">&quot;zw&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">water_level</span><span class="p">,</span>
            <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
            <span class="s2">&quot;tauc&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span>
            <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">num_ship</span><span class="p">,</span>
            <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
            <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">num_waves_per_ship</span><span class="p">,</span>
            <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
            <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
            <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
            <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_reed</span><span class="p">,</span>
            <span class="s2">&quot;dist_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">water_depth_fairway</span><span class="p">,</span>
            <span class="s2">&quot;chez&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">chezy</span><span class="p">,</span>
            <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_tot</span><span class="p">,</span>
            <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_shipping</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_flow</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.Q</span><span class="si">{</span><span class="n">q_level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.B</span><span class="si">{</span><span class="n">bank_ind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_write_data</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">GeoSeries</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the data to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">csv_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="n">shp_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.shp&quot;</span>
        <span class="n">_write_shp</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">shp_path</span><span class="p">)</span>
        <span class="n">_write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Debugger constructor.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debugger constructor.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="toclink">
            <code class="highlight language-python"><span class="n">last_discharge_level</span><span class="p">(</span><span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span> <span class="n">water_depth_fairway</span><span class="p">,</span> <span class="n">dn_eq1</span><span class="p">,</span> <span class="n">dv_eq1</span><span class="p">,</span> <span class="n">bank_height</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Write the last discharge level to a shapefile and CSV file.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">last_discharge_level</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
    <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
    <span class="n">water_depth_fairway</span><span class="p">,</span>
    <span class="n">dn_eq1</span><span class="p">,</span>
    <span class="n">dv_eq1</span><span class="p">,</span>
    <span class="n">bank_height</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the last discharge level to a shapefile and CSV file.&quot;&quot;&quot;</span>
    <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">bank_height</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
        <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
        <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
        <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
        <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
        <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
        <span class="s2">&quot;bank_fairway_dist&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
        <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">water_depth_fairway</span><span class="p">,</span>
        <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">dn_eq1</span><span class="p">,</span>
        <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">dv_eq1</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.EQ.B</span><span class="si">{</span><span class="n">bank_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="toclink">
            <code class="highlight language-python"><span class="n">middle_levels</span><span class="p">(</span><span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span> <span class="n">water_depth_fairway</span><span class="p">,</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">bank_height</span><span class="p">,</span> <span class="n">parameter</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Write the middle levels to a shapefile and CSV file.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">middle_levels</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
    <span class="n">discharge_level_pars</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
    <span class="n">water_depth_fairway</span><span class="p">,</span>
    <span class="n">velocity</span><span class="p">,</span>
    <span class="n">bank_height</span><span class="p">,</span>
    <span class="n">parameter</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the middle levels to a shapefile and CSV file.&quot;&quot;&quot;</span>
    <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">velocity</span><span class="p">,</span>
        <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">bank_height</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
        <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="s2">&quot;zw&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">water_level</span><span class="p">,</span>
        <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
        <span class="s2">&quot;tauc&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span>
        <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">num_ship</span><span class="p">,</span>
        <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
        <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">num_waves_per_ship</span><span class="p">,</span>
        <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
        <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
        <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
        <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">discharge_level_pars</span><span class="o">.</span><span class="n">mu_reed</span><span class="p">,</span>
        <span class="s2">&quot;dist_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
        <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">water_depth_fairway</span><span class="p">,</span>
        <span class="s2">&quot;chez&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">chezy</span><span class="p">,</span>
        <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_tot</span><span class="p">,</span>
        <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_shipping</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">:</span> <span class="n">parameter</span><span class="o">.</span><span class="n">erosion_distance_flow</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.Q</span><span class="si">{</span><span class="n">q_level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.B</span><span class="si">{</span><span class="n">bank_ind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="data-models"><a class="toclink" href="#data-models">Data Models</a><a class="headerlink" href="#data-models" title="Permanent link">#</a></h3>
<p>The Bank Erosion module uses several data models to represent inputs, calculation parameters, and results:</p>
<ul>
<li><strong>ErosionRiverData</strong>: Represents river data for erosion calculations</li>
<li><strong>ErosionSimulationData</strong>: Represents simulation data for erosion calculations</li>
<li><strong>BankData</strong>: Represents bank data for erosion calculations</li>
<li><strong>SingleCalculation</strong>: Represents parameters for discharge calculations</li>
<li><strong>LevelParameters</strong>: Represents parameters for discharge levels</li>
<li><strong>DischargeLevels</strong>: Represents discharge levels for erosion calculations</li>
<li><strong>ErosionInputs</strong>: Represents inputs for erosion calculations</li>
<li><strong>ErosionResults</strong>: Represents results of erosion calculations</li>
<li><strong>FairwayData</strong>: Represents fairway data for erosion calculations</li>
<li><strong>CalculationLevel</strong>: Represents a calculation level for erosion calculations</li>
<li><strong>MeshData</strong>: Represents mesh data for erosion calculations</li>
<li><strong>SingleParameters</strong>: Represents parameters for each bank</li>
<li><strong>SingleErosion</strong>: Represents a single erosion calculation</li>
<li><strong>WaterLevelData</strong>: Represents water level data for erosion calculations</li>
</ul>
<h2 id="workflow"><a class="toclink" href="#workflow">Workflow</a><a class="headerlink" href="#workflow" title="Permanent link">#</a></h2>
<p>The typical workflow for bank erosion calculation is:</p>
<ol>
<li>Initialize the Erosion object with a configuration file</li>
<li>Call the <code>run</code> method to start the erosion calculation process</li>
<li>The <code>run</code> method orchestrates the entire process:</li>
<li>Processes the river axis</li>
<li>Gets fairway data</li>
<li>Calculates bank-fairway distance</li>
<li>Prepares initial conditions</li>
<li>Processes discharge levels</li>
<li>Computes erosion per level</li>
<li>Post-processes results</li>
<li>Writes output files</li>
<li>Generates plots</li>
</ol>
<h2 id="usage-example"><a class="toclink" href="#usage-example">Usage Example</a><a class="headerlink" href="#usage-example" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.io.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.bank_erosion</span><span class="w"> </span><span class="kn">import</span> <span class="n">Erosion</span>

<span class="c1"># Load configuration file</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;config.cfg&quot;</span><span class="p">)</span>

<span class="c1"># Initialize Erosion object</span>
<span class="n">erosion</span> <span class="o">=</span> <span class="n">Erosion</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

<span class="c1"># Run erosion calculation</span>
<span class="n">erosion</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<p>For more details on the specific methods and classes, refer to the API reference below.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../bank_lines/data_models.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Bank Lines Data Models">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Bank Lines Data Models
              </div>
            </div>
          </a>
        
        
          
          <a href="../io.html" class="md-footer__link md-footer__link--next" aria-label="Next: I/O Module">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                I/O Module
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A tool to perform a bank erosion analysis based on a number of D-Flow FM simulations.">
      
      
      
        <link rel="canonical" href="https://deltares.github.io/D-FAST_Bank_Erosion/3.0.0/api/bank_erosion/bank_erosion.html">
      
      
        <link rel="prev" href="../bank_lines/data_models.html">
      
      
        <link rel="next" href="erosion_calculation.html">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Bank Erosion Module - D-FAST Bank Erosion</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bank-erosion-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="D-FAST Bank Erosion" class="md-header__button md-logo" aria-label="D-FAST Bank Erosion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            D-FAST Bank Erosion
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bank Erosion Module
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Deltares/D-FAST_Bank_Erosion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Deltares/D-FAST_Bank_Erosion
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guides/poetry.html" class="md-tabs__link">
          
  
  
    
  
  How-to

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture-design/main-components.html" class="md-tabs__link">
          
  
  
    
  
  Architecture Design

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../bank_lines/bank_lines.html" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../gui/gui.html" class="md-tabs__link">
          
  
  
    
  
  User Interface

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../change-log.html" class="md-tabs__link">
        
  
  
    
  
  Release Notes

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../license.html" class="md-tabs__link">
        
  
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="D-FAST Bank Erosion" class="md-nav__button md-logo" aria-label="D-FAST Bank Erosion" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    D-FAST Bank Erosion
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Deltares/D-FAST_Bank_Erosion" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Deltares/D-FAST_Bank_Erosion
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-to
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            How-to
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/poetry.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local clone + Poetry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/contributing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/documentation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/developer-instructions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Instructions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/pre-commit-hooks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-Commit Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/doctest.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docstrings and Doctest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/testing.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naming conventions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/teamcity-ci.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Teamcity ci
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture-design/main-components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    D-FAST Bank Erosion Architecture and Design
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture-design/class-diagram.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Class Diagram for Existing D-FAST Bank Erosion Code
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Bank Line Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Bank Line Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bank_lines/bank_lines.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Lines Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bank_lines/data_models.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Lines Data Models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Bank Erosion Module
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="bank_erosion.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Module
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Main Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion" class="md-nav__link">
    <span class="md-ellipsis">
      bank_erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bank_erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="md-nav__link">
    <span class="md-ellipsis">
      Erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fairway_bank_line_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="md-nav__link">
    <span class="md-ellipsis">
      compute_erosion_per_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.calculate_alpha" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh data models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models" class="md-nav__link">
    <span class="md-ellipsis">
      data_models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.Edges" class="md-nav__link">
    <span class="md-ellipsis">
      Edges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.Edges.update_edges_by_angle" class="md-nav__link">
    <span class="md-ellipsis">
      update_edges_by_angle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData" class="md-nav__link">
    <span class="md-ellipsis">
      MeshData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_angle" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_edge_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_edge_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_edges" class="md-nav__link">
    <span class="md-ellipsis">
      find_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_segment_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      find_segment_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.get_face_by_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_face_by_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.locate_point" class="md-nav__link">
    <span class="md-ellipsis">
      locate_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.resolve_next_face_from_edges" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_next_face_from_edges
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment" class="md-nav__link">
    <span class="md-ellipsis">
      RiverSegment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RiverSegment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.theta" class="md-nav__link">
    <span class="md-ellipsis">
      theta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.is_length_zero" class="md-nav__link">
    <span class="md-ellipsis">
      is_length_zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.select_first_intersection" class="md-nav__link">
    <span class="md-ellipsis">
      select_first_intersection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState" class="md-nav__link">
    <span class="md-ellipsis">
      IntersectionState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntersectionState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update_index_and_log" class="md-nav__link">
    <span class="md-ellipsis">
      update_index_and_log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      MeshProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.get_bank_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_bank_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      MeshWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.determine_next_face_on_edge" class="md-nav__link">
    <span class="md-ellipsis">
      determine_next_face_on_edge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.intersect_with_coords" class="md-nav__link">
    <span class="md-ellipsis">
      intersect_with_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.resolve_next_face_by_direction" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_next_face_by_direction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger" class="md-nav__link">
    <span class="md-ellipsis">
      debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="md-nav__link">
    <span class="md-ellipsis">
      last_discharge_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="md-nav__link">
    <span class="md-ellipsis">
      middle_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Data Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calculation-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Calculation Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation" class="md-nav__link">
    <span class="md-ellipsis">
      calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData" class="md-nav__link">
    <span class="md-ellipsis">
      BankData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BankData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_chainage_midpoints" class="md-nav__link">
    <span class="md-ellipsis">
      bank_chainage_midpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_line_coords" class="md-nav__link">
    <span class="md-ellipsis">
      bank_line_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.height" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.is_right_bank" class="md-nav__link">
    <span class="md-ellipsis">
      is_right_bank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.num_stations_per_bank" class="md-nav__link">
    <span class="md-ellipsis">
      num_stations_per_bank
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank" class="md-nav__link">
    <span class="md-ellipsis">
      BaseBank
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseBank">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels" class="md-nav__link">
    <span class="md-ellipsis">
      DischargeLevels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DischargeLevels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels.get_attr_level" class="md-nav__link">
    <span class="md-ellipsis">
      get_attr_level
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionInputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionInputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.bank_protection_level" class="md-nav__link">
    <span class="md-ellipsis">
      bank_protection_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.tauc" class="md-nav__link">
    <span class="md-ellipsis">
      tauc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionResults" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionResults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.FairwayData" class="md-nav__link">
    <span class="md-ellipsis">
      FairwayData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank" class="md-nav__link">
    <span class="md-ellipsis">
      SingleBank
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SingleBank">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.get_mid_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_mid_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.WaterLevelData" class="md-nav__link">
    <span class="md-ellipsis">
      WaterLevelData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WaterLevelData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Input Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs" class="md-nav__link">
    <span class="md-ellipsis">
      inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.BankLinesResultsError" class="md-nav__link">
    <span class="md-ellipsis">
      BankLinesResultsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionRiverData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionRiverData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.process_river_axis_by_center_line" class="md-nav__link">
    <span class="md-ellipsis">
      process_river_axis_by_center_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.simulation_data" class="md-nav__link">
    <span class="md-ellipsis">
      simulation_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionSimulationData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionSimulationData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.apply_masked_indexing" class="md-nav__link">
    <span class="md-ellipsis">
      apply_masked_indexing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.compute_mesh_topology" class="md-nav__link">
    <span class="md-ellipsis">
      compute_mesh_topology
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters" class="md-nav__link">
    <span class="md-ellipsis">
      ShipsParameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShipsParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.get_ship_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_ship_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.read_discharge_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      read_discharge_parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="erosion_calculation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Erosion Calculation Process
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="erosion_calculator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Calculator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mesh_processor.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Mesh Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="debugger.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Debugger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            Data Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="data_models/calculation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Calculation Data Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="data_models/inputs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bank Erosion Input Data Models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    I/O Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cmd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utilities Module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotting.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting Module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Interface
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gui/gui.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gui
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../change-log.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Main Classes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion" class="md-nav__link">
    <span class="md-ellipsis">
      bank_erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bank_erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="md-nav__link">
    <span class="md-ellipsis">
      Erosion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Erosion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_fairway_bank_line_distance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="md-nav__link">
    <span class="md-ellipsis">
      compute_erosion_per_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="md-nav__link">
    <span class="md-ellipsis">
      run
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.bank_erosion.calculate_alpha" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh data models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models" class="md-nav__link">
    <span class="md-ellipsis">
      data_models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.Edges" class="md-nav__link">
    <span class="md-ellipsis">
      Edges
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Edges">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.Edges.update_edges_by_angle" class="md-nav__link">
    <span class="md-ellipsis">
      update_edges_by_angle
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData" class="md-nav__link">
    <span class="md-ellipsis">
      MeshData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_angle" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_edge_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_edge_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_edges" class="md-nav__link">
    <span class="md-ellipsis">
      find_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_segment_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      find_segment_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.get_face_by_index" class="md-nav__link">
    <span class="md-ellipsis">
      get_face_by_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.locate_point" class="md-nav__link">
    <span class="md-ellipsis">
      locate_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.resolve_next_face_from_edges" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_next_face_from_edges
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment" class="md-nav__link">
    <span class="md-ellipsis">
      RiverSegment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RiverSegment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.theta" class="md-nav__link">
    <span class="md-ellipsis">
      theta
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.is_length_zero" class="md-nav__link">
    <span class="md-ellipsis">
      is_length_zero
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.select_first_intersection" class="md-nav__link">
    <span class="md-ellipsis">
      select_first_intersection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mesh-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Mesh Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor" class="md-nav__link">
    <span class="md-ellipsis">
      processor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState" class="md-nav__link">
    <span class="md-ellipsis">
      IntersectionState
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IntersectionState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update_index_and_log" class="md-nav__link">
    <span class="md-ellipsis">
      update_index_and_log
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      MeshProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.get_bank_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_bank_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      MeshWrapper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MeshWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.determine_next_face_on_edge" class="md-nav__link">
    <span class="md-ellipsis">
      determine_next_face_on_edge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.intersect_with_coords" class="md-nav__link">
    <span class="md-ellipsis">
      intersect_with_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.resolve_next_face_by_direction" class="md-nav__link">
    <span class="md-ellipsis">
      resolve_next_face_by_direction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging Utilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger" class="md-nav__link">
    <span class="md-ellipsis">
      debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger" class="md-nav__link">
    <span class="md-ellipsis">
      Debugger
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="md-nav__link">
    <span class="md-ellipsis">
      last_discharge_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="md-nav__link">
    <span class="md-ellipsis">
      middle_levels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Data Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#calculation-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Calculation Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation" class="md-nav__link">
    <span class="md-ellipsis">
      calculation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="calculation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData" class="md-nav__link">
    <span class="md-ellipsis">
      BankData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BankData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_chainage_midpoints" class="md-nav__link">
    <span class="md-ellipsis">
      bank_chainage_midpoints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_line_coords" class="md-nav__link">
    <span class="md-ellipsis">
      bank_line_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.height" class="md-nav__link">
    <span class="md-ellipsis">
      height
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.is_right_bank" class="md-nav__link">
    <span class="md-ellipsis">
      is_right_bank
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BankData.num_stations_per_bank" class="md-nav__link">
    <span class="md-ellipsis">
      num_stations_per_bank
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank" class="md-nav__link">
    <span class="md-ellipsis">
      BaseBank
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseBank">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels" class="md-nav__link">
    <span class="md-ellipsis">
      DischargeLevels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DischargeLevels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels.get_attr_level" class="md-nav__link">
    <span class="md-ellipsis">
      get_attr_level
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionInputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionInputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.bank_protection_level" class="md-nav__link">
    <span class="md-ellipsis">
      bank_protection_level
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.tauc" class="md-nav__link">
    <span class="md-ellipsis">
      tauc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.ErosionResults" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionResults
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.FairwayData" class="md-nav__link">
    <span class="md-ellipsis">
      FairwayData
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank" class="md-nav__link">
    <span class="md-ellipsis">
      SingleBank
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SingleBank">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.get_mid_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_mid_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.calculation.WaterLevelData" class="md-nav__link">
    <span class="md-ellipsis">
      WaterLevelData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WaterLevelData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-data-models" class="md-nav__link">
    <span class="md-ellipsis">
      Input Data Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs" class="md-nav__link">
    <span class="md-ellipsis">
      inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.BankLinesResultsError" class="md-nav__link">
    <span class="md-ellipsis">
      BankLinesResultsError
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionRiverData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionRiverData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.process_river_axis_by_center_line" class="md-nav__link">
    <span class="md-ellipsis">
      process_river_axis_by_center_line
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.simulation_data" class="md-nav__link">
    <span class="md-ellipsis">
      simulation_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData" class="md-nav__link">
    <span class="md-ellipsis">
      ErosionSimulationData
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ErosionSimulationData">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.apply_masked_indexing" class="md-nav__link">
    <span class="md-ellipsis">
      apply_masked_indexing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.compute_mesh_topology" class="md-nav__link">
    <span class="md-ellipsis">
      compute_mesh_topology
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters" class="md-nav__link">
    <span class="md-ellipsis">
      ShipsParameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ShipsParameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.get_ship_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_ship_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.read_discharge_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      read_discharge_parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-example" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Example
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Deltares/D-FAST_Bank_Erosion/edit/master/docs/api/bank_erosion/bank_erosion.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Deltares/D-FAST_Bank_Erosion/raw/master/docs/api/bank_erosion/bank_erosion.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="bank-erosion-module"><a class="toclink" href="#bank-erosion-module">Bank Erosion Module</a><a class="headerlink" href="#bank-erosion-module" title="Permanent link">#</a></h1>
<p>The Bank Erosion module is responsible for calculating bank erosion based on hydrodynamic data and detected bank lines. It is one of the core components of the D-FAST Bank Erosion software.</p>
<h2 id="overview"><a class="toclink" href="#overview">Overview</a><a class="headerlink" href="#overview" title="Permanent link">#</a></h2>
<p>The Bank Erosion module calculates the amount of bank material that will be eroded during the first year and until equilibrium, based on hydrodynamic simulation results and detected bank lines. It takes into account various factors such as river geometry, discharge levels, and shipping parameters.</p>
<pre class="mermaid"><code>classDiagram
    %% Main Classes

    %% Generic Base Class
    class BaseBank~T~ {
        +T left
        +T right
        +Optional[int] id
        +get_bank(int)
        +from_column_arrays(Dict, Type, Tuple)
        +__iter__()
    }
    class Erosion {
        -ConfigFile config_file
        -bool gui
        -Path bank_dir
        -Path output_dir
        -bool debug
        -dict plot_flags
        -ErosionCalculator erosion_calculator
        +__init__(ConfigFile, bool)
        +run()
        -_process_river_axis_by_center_line()
        -_get_fairway_data(LineGeometry, MeshData)
        +calculate_fairway_bank_line_distance(BankData, FairwayData, ErosionSimulationData)
        -_prepare_initial_conditions(ConfigFile, List, FairwayData)
        -_process_discharge_levels(array, tuple, ConfigFile, ErosionInputs, BankData, FairwayData)
        -_postprocess_erosion_results(tuple, array, BankData, ErosionResults)
        +compute_erosion_per_level(int, BankData, ErosionSimulationData, FairwayData, SingleLevelParameters, ErosionInputs, tuple, int, array)
        -_write_bankline_shapefiles(list, list, ConfigFile)
        -_write_volume_outputs(ErosionResults, array)
        -_generate_plots(array, ErosionSimulationData, list, array, float, ErosionInputs, WaterLevelData, MeshData, BankData, ErosionResults)
    }

    class ErosionCalculator {
        +comp_erosion_eq(array, array, array, SingleParameters, array, array, SingleErosion)
        +compute_bank_erosion_dynamics(SingleCalculation, array, array, array, array, SingleParameters, float, array, SingleErosion)
        +comp_hw_ship_at_bank(array, array, array, array, array, array, array)
    }

    class ConfigFile {
        -ConfigParser config
        -str path
        +__init__(ConfigParser, Path)
        +read(Path)
        +write(str)
        +make_paths_absolute()
        +get_str(str, str, str)
        +get_bool(str, str, bool)
        +get_float(str, str, float, bool)
        +get_int(str, str, int, bool)
        +get_sim_file(str, str)
        +get_start_end_stations()
        +get_search_lines()
        +read_bank_lines(str)
        +get_parameter(str, str, List, Any, str, bool, List, bool)
        +get_bank_search_distances(int)
        +get_range(str, str)
        +get_river_center_line()
        +resolve(str)
        +relative_to(str)
        +get_plotting_flags(Path)
        +get_output_dir(str)
    }

    %% Data Models - Bank Erosion
    class ErosionRiverData {
        -ConfigFile config_file
        -LineString river_center_line
        -Tuple station_bounds
        +__init__(ConfigFile)
        +simulation_data()
        -_get_bank_output_dir()
        -_get_bank_line_dir()
        -_read_river_axis()
    }

    class ErosionSimulationData {
        +compute_mesh_topology()
        +apply_masked_indexing(array, array)
        +calculate_bank_velocity(SingleBank, array)
        +calculate_bank_height(SingleBank, array)
    }

    class BankData {
        +List banks
        +from_column_arrays(dict, Type, GeoDataFrame, int, Tuple)
        +bank_line_coords()
        +is_right_bank()
        +bank_chainage_midpoints()
        +num_stations_per_bank()
    }

    class SingleBank {
        +LineString bank_line
        +array face_indices
        +array chainage
        +bool is_right
        +__post_init__()
        -_segment_length()
        -_dx()
        -_dy()
        +get_mid_points(bool, str)
    }

    class FairwayData {
        +LineString fairway_axis
        +Polygon fairway_polygon
        +array fairway_initial_water_levels
        +array fairway_velocities
        +array fairway_chezy_coefficients
    }

    class ErosionInputs {
        +List banks
        +dict shipping_data
        +from_column_arrays(dict, Type, Dict, array, Tuple)
        +bank_protection_level()
        +tauc()
    }

    class SingleErosion {
        +array wave_fairway_distance_0
        +array wave_fairway_distance_1
        +array bank_protection_level
        +array tauc
        +array bank_type
    }

    class ErosionResults {
        +int erosion_time
        +List velocity
        +List bank_height
        +List water_level
        +List chezy
        +List vol_per_discharge
        +List ship_wave_max
        +List ship_wave_min
        +List line_size
        +List flow_erosion_dist
        +List ship_erosion_dist
        +List total_erosion_dist
        +List total_eroded_vol
        +List eq_erosion_dist
        +List eq_eroded_vol
        +array avg_erosion_rate
        +array eq_eroded_vol_per_km
        +array total_eroded_vol_per_km
    }

    class WaterLevelData {
        +List water_levels
        +array hfw_max
    }

    class MeshData {
        +array x_node
        +array y_node
        +array n_nodes
        +array face_node
        +array face_x
        +array face_y
        +array face_area
        +array face_nodes_count
        +array face_nodes_indices
    }

    class DischargeLevels {
        +List levels
        +__init__(List)
        +__getitem__(int)
        +__len__()
        +append(SingleDischargeLevel)
        +get_max_hfw_level()
        +total_erosion_volume()
        +__iter__()
        +accumulate(str, str)
        -_accumulate_attribute_side(str, str)
        -_get_attr_both_sides_level(str, object)
        +get_attr_level(str)
        +get_water_level_data(array)
    }

    class SingleDischargeLevel {
        +List banks
        +from_column_arrays(dict, Type, float, Tuple)
    }

    class SingleCalculation {
        +array water_level
        +array velocity
        +array chezy
        +array flow_erosion_dist
        +array ship_erosion_dist
        +array total_erosion_dist
        +array total_eroded_vol
        +array eq_erosion_dist
        +array eq_eroded_vol
    }

    class SingleLevelParameters {
        +List banks
    }

    class SingleParameters {
        +float discharge
        +float probability
        +dict ship_parameters
    }

    %% Data Models - IO
    class LineGeometry {
        +LineString line
        +dict data
        +__init__(LineString, Tuple, str)
        +as_array()
        +add_data(Dict)
        +to_file(str, Dict)
        +mask(LineString, Tuple)
        -_find_mask_index(float, array)
        -_handle_bound(int, float, bool, array)
        -_interpolate_point(int, float, array)
        +intersect_with_line(array)
    }

    class BaseSimulationData {
        +array x_node
        +array y_node
        +array n_nodes
        +array face_node
        +array bed_elevation_location
        +array bed_elevation_values
        +array water_level_face
        +array water_depth_face
        +array velocity_x_face
        +array velocity_y_face
        +array chezy_face
        +float dry_wet_threshold
        +__init__(array, array, array, array, array, array, array, array, array, array, array, float)
        +read(str, str)
        +clip(LineString, float)
    }

    class BaseRiverData {
        -ConfigFile config_file
        -LineString river_center_line
        -Tuple station_bounds
        +__init__(ConfigFile)
        +get_bbox(array, float)
        +get_erosion_sim_data(int)
    }

    %% Relationships
    Erosion --&gt; ConfigFile : uses
    Erosion --&gt; ErosionRiverData : uses
    Erosion --&gt; ErosionSimulationData : uses
    Erosion --&gt; BankData : uses
    Erosion --&gt; FairwayData : uses
    Erosion --&gt; ErosionInputs : uses
    Erosion --&gt; ErosionResults : uses
    Erosion --&gt; DischargeLevels : uses
    Erosion --&gt; WaterLevelData : uses
    Erosion --&gt; MeshData : uses
    Erosion --&gt; SingleCalculation : uses
    Erosion --&gt; SingleLevelParameters : uses
    Erosion --&gt; SingleDischargeLevel : uses
    Erosion --&gt; SingleParameters : uses
    Erosion --&gt; SingleErosion : uses
    Erosion --&gt; Debugger : uses
    Erosion --&gt; BankLinesProcessor : uses
    Erosion --&gt; LineGeometry : uses
    Erosion --&gt; ErosionCalculator : uses

    ErosionRiverData --|&gt; BaseRiverData : inherits
    ErosionRiverData --&gt; ConfigFile : uses

    ErosionSimulationData --|&gt; BaseSimulationData : inherits
    ErosionSimulationData --&gt; MeshData : uses
    ErosionSimulationData --&gt; SingleBank : uses

    %% Inheritance relationships
    BankData --|&gt; BaseBank : inherits
    BankData --|&gt; BaseBank : inherits
    ErosionInputs --|&gt; BaseBank : inherits
    SingleDischargeLevel --|&gt; BaseBank : inherits
    SingleLevelParameters --|&gt; BaseBank : inherits

    %% Containment relationships
    BankData --&gt; SingleBank : contains
    ErosionInputs --&gt; SingleErosion : contains
    SingleDischargeLevel --&gt; SingleCalculation : contains
    SingleLevelParameters --&gt; SingleParameters : contains
    DischargeLevels --&gt; SingleDischargeLevel : contains

    BaseRiverData --&gt; ConfigFile : uses
    BaseRiverData --&gt; LineGeometry : uses</code></pre>
<h2 id="components"><a class="toclink" href="#components">Components</a><a class="headerlink" href="#components" title="Permanent link">#</a></h2>
<p>The Bank Erosion module consists of the following components:</p>
<h3 id="main-classes"><a class="toclink" href="#main-classes">Main Classes</a><a class="headerlink" href="#main-classes" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.bank_erosion" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion" class="toclink">
            <code>dfastbe.bank_erosion.bank_erosion</code>


</a><a href="#dfastbe.bank_erosion.bank_erosion" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>Copyright (C) 2020 Stichting Deltares.</p>
<p>This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation version 2.1.</p>
<p>This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.</p>
<p>You should have received a copy of the GNU Lesser General Public
License along with this library; if not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
<p>contact: delft3d.support@deltares.nl
Stichting Deltares
P.O. Box 177
2600 MH Delft, The Netherlands</p>
<p>All indications and logos of, and references to, "Delft3D" and "Deltares"
are registered trademarks of Stichting Deltares, and remain the property of
Stichting Deltares. All rights reserved.</p>
<p>INFORMATION
This file is part of D-FAST Bank Erosion: https://github.com/Deltares/D-FAST_Bank_Erosion</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.bank_erosion.Erosion" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="toclink">
            <code>Erosion</code>


</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="dfastbe.base_calculator.BaseCalculator">BaseCalculator</span></code></p>


        <p>Class to handle the bank erosion calculations.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Erosion</span><span class="p">(</span><span class="n">BaseCalculator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle the bank erosion calculations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Erosion class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">gui</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">ErosionRiverData</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">get_erosion_sim_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debugger</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span> <span class="o">=</span> <span class="n">ErosionCalculator</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_fairway_bank_line_distance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map bank data to fairway data.</span>

<span class="sd">        Args:</span>
<span class="sd">            bank_data (BankData):</span>
<span class="sd">            fairway_data (FairwayData):</span>
<span class="sd">            simulation_data (ErosionSimulationData):</span>

<span class="sd">        Returns:</span>
<span class="sd">            FairwayData:</span>
<span class="sd">                The method updates the following attributes in the `bank_data` instance</span>
<span class="sd">                    - fairway_face_indices</span>
<span class="sd">                    - fairway_distances</span>
<span class="sd">            BankData:</span>
<span class="sd">                the following attributes in the `fairway_data` instance</span>
<span class="sd">                    - fairway_initial_water_levels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># distance fairway-bankline (bank-fairway)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_distance_fairway&quot;</span><span class="p">)</span>

        <span class="n">num_fairway_face_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">bank_i</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
            <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
            <span class="n">coords_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank_fairway_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">))</span>
            <span class="n">bp_fw_face_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">coord_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">):</span>
                <span class="c1"># find closest fairway support node</span>
                <span class="n">closest_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">fairway_coord</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_coord</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                <span class="c1"># If fairway support node is also the closest projected fairway point, then it likely</span>
                <span class="c1"># that that point is one of the original support points (a corner) of the fairway path</span>
                <span class="c1"># and located inside a grid cell. The segments before and after that point will then</span>
                <span class="c1"># both be located inside that same grid cell, so let&#39;s pick the segment before the point.</span>
                <span class="c1"># If the point happens to coincide with a grid edge and the two segments are located</span>
                <span class="c1"># in different grid cells, then we could either simply choose one or add complexity to</span>
                <span class="c1"># average the values of the two grid cells. Let&#39;s go for the simplest approach ...</span>
                <span class="n">iseg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                        <span class="n">closest_ind</span><span class="p">,</span>
                        <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">coord_i</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span>
                            <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                        <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                            <span class="c1"># projected point located on segment before, which corresponds to initial choice: iseg = ifw - 1</span>
                <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&lt;</span> <span class="n">num_fairway_face_ind</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                        <span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">closest_ind</span><span class="p">,</span>
                        <span class="n">coord_i</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                            <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                        <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                            <span class="n">iseg</span> <span class="o">=</span> <span class="n">closest_ind</span>

                <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>
                <span class="n">bank_fairway_dist</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_bank_distance</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
                <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bank_</span><span class="si">{</span><span class="n">bank_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">_chainage_and_fairway_face_idx.shp&quot;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">bank_i</span><span class="p">],</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bp_fw_face_idx</span>
            <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span> <span class="o">=</span> <span class="n">bank_fairway_dist</span>

        <span class="c1"># water level at fairway</span>
        <span class="n">water_level_fairway_ref</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="n">bank_data</span><span class="p">:</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span>
            <span class="n">water_level_fairway_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span> <span class="o">=</span> <span class="n">water_level_fairway_ref</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_initial_conditions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErosionInputs</span><span class="p">:</span>
        <span class="c1"># wave reduction s0, s1</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parameters</span><span class="p">(</span><span class="n">num_stations_per_bank</span><span class="p">)</span>
        <span class="n">wave_fairway_distance_0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Wave0&quot;</span><span class="p">]</span>
        <span class="n">wave_fairway_distance_1</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;Wave1&quot;</span><span class="p">]</span>

        <span class="c1"># save 1_banklines</span>
        <span class="c1"># read vship, nship, nwave, draught (tship), shiptype ... independent of level number</span>
        <span class="n">ships_parameters</span> <span class="o">=</span> <span class="n">ShipsParameters</span><span class="o">.</span><span class="n">get_ship_data</span><span class="p">(</span>
            <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span>
        <span class="p">)</span>

        <span class="c1"># read classes flag (yes: banktype = taucp, no: banktype = tauc) and banktype (taucp: 0-4 ... or ... tauc = critical shear value)</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_bool</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;Classes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">bank_type</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;BankType&quot;</span><span class="p">]</span>
            <span class="n">tauc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">bank</span> <span class="ow">in</span> <span class="n">bank_type</span><span class="p">:</span>
                <span class="n">tauc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[</span><span class="n">bank</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tauc</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;BankType&quot;</span><span class="p">]</span>
            <span class="n">thr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ErosionInputs</span><span class="o">.</span><span class="n">taucls</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">bank_type</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">thr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">shear_stress</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tauc</span><span class="p">):</span>
                <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shear_stress</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">thr_i</span> <span class="ow">in</span> <span class="n">thr</span><span class="p">:</span>
                    <span class="n">bt</span><span class="p">[</span><span class="n">shear_stress</span> <span class="o">&lt;</span> <span class="n">thr_i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">bank_type</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span>

        <span class="n">dike_height_default</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
        <span class="n">dike_height</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ProtectionLevel&quot;</span><span class="p">]</span>
        <span class="c1"># if dike_height undefined, set dike_height equal to water_level_fairway_ref - 1</span>
        <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">one_zss</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dike_height</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">one_zss</span> <span class="o">==</span> <span class="n">dike_height_default</span>
            <span class="n">one_zss</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ib</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;wave_fairway_distance_0&#39;</span><span class="p">:</span> <span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="s1">&#39;wave_fairway_distance_1&#39;</span><span class="p">:</span> <span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="s1">&#39;bank_protection_level&#39;</span><span class="p">:</span> <span class="n">dike_height</span><span class="p">,</span>
            <span class="s1">&#39;tauc&#39;</span><span class="p">:</span> <span class="n">tauc</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ErosionInputs</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">shipping_data</span><span class="o">=</span><span class="n">ships_parameters</span><span class="p">,</span> <span class="n">bank_type</span><span class="o">=</span><span class="n">bank_type</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_erosion_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameters</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Wave0&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Wave1&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;BankType&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.btp&quot;</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ProtectionLevel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1000</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">onefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;.bpl&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a parameter from the configuration file.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_erosion_input_parameters</span><span class="p">():</span>
            <span class="n">data</span><span class="p">[</span><span class="n">parameter</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
                <span class="n">parameter</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">num_stations_per_bank</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                <span class="n">positive</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">positive</span><span class="p">,</span>
                <span class="n">onefile</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">onefile</span><span class="p">,</span>
                <span class="n">ext</span><span class="o">=</span><span class="n">parameter</span><span class="o">.</span><span class="n">ext</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_bank_height</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BankData</span><span class="p">:</span>
        <span class="c1"># bank height = maximum bed elevation per cell</span>
        <span class="k">for</span> <span class="n">bank_i</span> <span class="ow">in</span> <span class="n">bank_data</span><span class="p">:</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_height</span><span class="p">(</span>
                <span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">zb_dx</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">bank_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_discharge_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">WaterLevelData</span><span class="p">,</span> <span class="n">ErosionResults</span><span class="p">]:</span>

        <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="n">num_km</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">)</span>

        <span class="c1"># initialize arrays for erosion loop over all discharges</span>
        <span class="n">discharge_levels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;total_time&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">level_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_levels</span><span class="p">):</span>
            <span class="n">log_text</span><span class="p">(</span>
                <span class="s2">&quot;discharge_header&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="n">level_i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
                    <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;read_q_params&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="c1"># 1) read level-specific parameters</span>
            <span class="c1"># read ship_velocity, num_ship, nwave, draught, ship_type, slope, reed, fairway_depth, ... (level specific values)</span>
            <span class="n">level_parameters</span> <span class="o">=</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">shipping_data</span><span class="o">.</span><span class="n">read_discharge_parameters</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span>
            <span class="p">)</span>

            <span class="c1"># 2) load FM result</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span>
                <span class="s2">&quot;read_simdata&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">[</span><span class="n">level_i</span><span class="p">]},</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span>
            <span class="p">)</span>
            <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">ErosionSimulationData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span>
            <span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_erosion&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bank_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_bank_height</span><span class="p">(</span><span class="n">bank_data</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">)</span>

            <span class="n">single_level</span><span class="p">,</span> <span class="n">dvol_bank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_erosion_per_level</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">simulation_data</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">level_parameters</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="p">,</span>
                <span class="n">km_bin</span><span class="p">,</span>
                <span class="n">num_km</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">discharge_levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_level</span><span class="p">)</span>

            <span class="n">error_vol_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;EroVol</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;erovolQ</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.evo&quot;</span>
            <span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_error_vol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">error_vol_file</span><span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
                <span class="n">km_mid</span><span class="p">,</span> <span class="n">dvol_bank</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">error_vol_file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># shape is (num_levels, 2, (num_stations_per_bank))</span>
        <span class="c1"># if num_levels = 13 and the num_stations_per_bank = [10, 15]</span>
        <span class="c1"># then shape = (13, 2, (10, 15)) list of 13 elements, each element is a list of 2 elements</span>
        <span class="c1"># first an array of 10 elements, and the second is array of 15 elements</span>
        <span class="n">discharge_levels</span> <span class="o">=</span> <span class="n">DischargeLevels</span><span class="p">(</span><span class="n">discharge_levels</span><span class="p">)</span>
        <span class="n">flow_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">)</span>
        <span class="n">ship_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">)</span>
        <span class="n">total_erosion_dist</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_distance_tot&quot;</span><span class="p">)</span>
        <span class="n">total_eroded_vol</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="s2">&quot;erosion_volume_tot&quot;</span><span class="p">)</span>

        <span class="n">erosion_results</span> <span class="o">=</span> <span class="n">ErosionResults</span><span class="p">(</span>
            <span class="n">erosion_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span><span class="p">,</span>
            <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="n">flow_erosion_dist</span><span class="p">,</span>
            <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="n">ship_erosion_dist</span><span class="p">,</span>
            <span class="n">total_erosion_dist</span><span class="o">=</span><span class="n">total_erosion_dist</span><span class="p">,</span>
            <span class="n">total_eroded_vol</span><span class="o">=</span><span class="n">total_eroded_vol</span><span class="p">,</span>
            <span class="n">eq_erosion_dist</span><span class="o">=</span><span class="n">discharge_levels</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span>
                <span class="s2">&quot;erosion_distance_eq&quot;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">),</span>
            <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="n">discharge_levels</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span>
                <span class="s2">&quot;erosion_volume_eq&quot;</span><span class="p">,</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">water_level_data</span> <span class="o">=</span> <span class="n">discharge_levels</span><span class="o">.</span><span class="n">get_water_level_data</span><span class="p">()</span>

        <span class="n">bank_data</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">bank_line_size</span><span class="p">,</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">bank_line_size</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_postprocess_erosion_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">erosion_results</span><span class="p">:</span> <span class="n">ErosionResults</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">LineString</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Postprocess the erosion results to get the new bank lines and volumes.&quot;&quot;&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="n">avg_erosion_rate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">dn_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_ship</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">d_nav_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">dn_max_eq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">)</span>
        <span class="n">eq_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">),</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">))</span>
        <span class="n">total_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">km_mid</span><span class="p">),</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span><span class="p">))</span>
        <span class="n">xy_line_new_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bankline_new_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bankline_eq_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ib</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
            <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
            <span class="n">avg_erosion_rate</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">dn_max</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">d_nav_flow</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">flow_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">d_nav_ship</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">ship_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">d_nav_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span>
            <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_size</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">dn_max_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnav&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">ib</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">avg_erosion_rate</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnavflow&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_flow</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnavship&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_ship</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnmax&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">dn_max</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnaveq&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">d_nav_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dnmaxeq&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">dn_max_eq</span><span class="p">[</span><span class="n">ib</span><span class="p">]})</span>

            <span class="n">xy_line_new</span> <span class="o">=</span> <span class="n">move_line</span><span class="p">(</span>
                <span class="n">bank_coords</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">xy_line_new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_line_new</span><span class="p">)</span>
            <span class="n">bankline_new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">xy_line_new</span><span class="p">))</span>

            <span class="n">xy_line_eq</span> <span class="o">=</span> <span class="n">move_line</span><span class="p">(</span>
                <span class="n">bank_coords</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_erosion_dist</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">xy_line_eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xy_line_eq</span><span class="p">)</span>
            <span class="n">bankline_eq_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">xy_line_eq</span><span class="p">))</span>

            <span class="n">dvol_eq</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">km_bin</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">eq_eroded_vol_per_km</span><span class="p">[:,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvol_eq</span>
            <span class="n">dvol_tot</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol</span><span class="p">[</span><span class="n">ib</span><span class="p">],</span>
                <span class="n">km_bin</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">total_eroded_vol_per_km</span><span class="p">[:,</span> <span class="n">ib</span><span class="p">]</span> <span class="o">=</span> <span class="n">dvol_tot</span>
            <span class="k">if</span> <span class="n">ib</span> <span class="o">&lt;</span> <span class="n">bank_data</span><span class="o">.</span><span class="n">n_bank_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">erosion_results</span><span class="o">.</span><span class="n">avg_erosion_rate</span> <span class="o">=</span> <span class="n">avg_erosion_rate</span>
        <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">eq_eroded_vol_per_km</span>
        <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol_per_km</span> <span class="o">=</span> <span class="n">total_eroded_vol_per_km</span>

        <span class="k">return</span> <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_erosion_per_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleLevelParameters</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">num_km</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SingleDischargeLevel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the bank erosion for a given level.&quot;&quot;&quot;</span>
        <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
        <span class="n">dvol_bank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_km</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">par_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">bank_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>

            <span class="n">single_calculation</span> <span class="o">=</span> <span class="n">SingleCalculation</span><span class="p">()</span>
            <span class="c1"># bank_i = 0: left bank, bank_i = 1: right bank</span>
            <span class="c1"># calculate velocity along banks ...</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">bank_velocity</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_velocity</span><span class="p">(</span>
                <span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">vel_dx</span>
            <span class="p">)</span>

            <span class="c1"># get fairway face indices</span>
            <span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_face_indices</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">get_fairway_data</span><span class="p">(</span><span class="n">fairway_face_indices</span><span class="p">)</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_level</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;water_level&quot;</span><span class="p">]</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">chezy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;chezy&quot;</span><span class="p">]</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;water_depth&quot;</span><span class="p">]</span>

            <span class="c1"># get water depth along the fair-way</span>
            <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hfw_max_level</span><span class="p">,</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

            <span class="c1"># last discharge level</span>
            <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">erosion_distance_eq</span><span class="p">,</span> <span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span><span class="o">.</span><span class="n">comp_erosion_eq</span><span class="p">(</span>
                        <span class="n">bank_i</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                        <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                        <span class="n">single_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                        <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                        <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
                        <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_eq</span> <span class="o">=</span> <span class="n">erosion_distance_eq</span>
                <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">erosion_volume_eq</span>

            <span class="n">single_calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span><span class="o">.</span><span class="n">compute_bank_erosion_dynamics</span><span class="p">(</span>
                <span class="n">single_calculation</span><span class="p">,</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                <span class="n">single_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># accumulate eroded volumes per km</span>
            <span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
                <span class="n">bank_i</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
                <span class="n">km_bin</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">volume_per_discharge</span>
            <span class="n">par_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_calculation</span><span class="p">)</span>

            <span class="n">dvol_bank</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">volume_per_discharge</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_output</span><span class="p">(</span>
                    <span class="n">level_i</span><span class="p">,</span>
                    <span class="n">ind</span><span class="p">,</span>
                    <span class="n">bank_data</span><span class="p">,</span>
                    <span class="n">fairway_data</span><span class="p">,</span>
                    <span class="n">erosion_inputs</span><span class="p">,</span>
                    <span class="n">single_parameters</span><span class="p">,</span>
                    <span class="n">num_levels</span><span class="p">,</span>
                    <span class="n">single_calculation</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">level_calculation</span> <span class="o">=</span> <span class="n">SingleDischargeLevel</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hfw_max</span><span class="o">=</span><span class="n">hfw_max_level</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">level_calculation</span><span class="p">,</span> <span class="n">dvol_bank</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_debug_output</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">,</span>
        <span class="n">ind</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
        <span class="n">single_level_parameters</span><span class="p">:</span> <span class="n">SingleLevelParameters</span><span class="p">,</span>
        <span class="n">num_levels</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># EQ debug</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">last_discharge_level</span><span class="p">(</span>
                <span class="n">ind</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">single_level_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="n">single_calculation</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="c1"># Q-specific debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">middle_levels</span><span class="p">(</span>
            <span class="n">ind</span><span class="p">,</span>
            <span class="n">level_i</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">fairway_data</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">single_level_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="n">single_calculation</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;derive_topology&quot;</span><span class="p">)</span>
        <span class="n">mesh_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">compute_mesh_topology</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">MeshProcessor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the bank erosion analysis for a specified configuration.&quot;&quot;&quot;</span>
        <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- start analysis --&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span>
            <span class="s2">&quot;header_bankerosion&quot;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/Deltares/D-FAST_Bank_Erosion&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

        <span class="n">mesh_processor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_processor</span><span class="p">()</span>

        <span class="n">river_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">process_river_axis_by_center_line</span><span class="p">()</span>
        <span class="n">fairway_data</span> <span class="o">=</span> <span class="n">mesh_processor</span><span class="o">.</span><span class="n">get_fairway_data</span><span class="p">(</span><span class="n">river_axis</span><span class="p">)</span>

        <span class="c1"># map to the output interval</span>
        <span class="n">km_bin</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">km_mid</span> <span class="o">=</span> <span class="n">get_km_bins</span><span class="p">(</span><span class="n">km_bin</span><span class="p">,</span> <span class="n">station_type</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">)</span>  <span class="c1"># get mid-points</span>

        <span class="c1"># map bank lines to mesh cells</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;intersect_bank_mesh&quot;</span><span class="p">)</span>
        <span class="n">bank_data</span> <span class="o">=</span> <span class="n">mesh_processor</span><span class="o">.</span><span class="n">get_bank_data</span><span class="p">()</span>
        <span class="c1"># map the bank data to the fairway data (the bank_data and fairway_data will be updated inside the `_map_bank_to_fairway` function)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span>
            <span class="n">bank_data</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span>
        <span class="p">)</span>

        <span class="n">erosion_inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_initial_conditions</span><span class="p">(</span>
            <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">fairway_data</span>
        <span class="p">)</span>

        <span class="c1"># initialize arrays for erosion loop over all discharges</span>
        <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_discharge_levels</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">km_bin</span><span class="p">,</span>
            <span class="n">erosion_inputs</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="p">,</span>
            <span class="n">fairway_data</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_erosion_results</span><span class="p">(</span>
                <span class="n">km_bin</span><span class="p">,</span>
                <span class="n">km_mid</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">erosion_results</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;river_axis&quot;</span><span class="p">:</span> <span class="n">river_axis</span><span class="p">,</span>
            <span class="s2">&quot;bank_data&quot;</span><span class="p">:</span> <span class="n">bank_data</span><span class="p">,</span>
            <span class="s2">&quot;water_level_data&quot;</span><span class="p">:</span> <span class="n">water_level_data</span><span class="p">,</span>
            <span class="s2">&quot;erosion_results&quot;</span><span class="p">:</span> <span class="n">erosion_results</span><span class="p">,</span>
            <span class="s2">&quot;erosion_inputs&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="p">,</span>
            <span class="s2">&quot;bankline_new_list&quot;</span><span class="p">:</span> <span class="n">bankline_new_list</span><span class="p">,</span>
            <span class="s2">&quot;bankline_eq_list&quot;</span><span class="p">:</span> <span class="n">bankline_eq_list</span><span class="p">,</span>
            <span class="s2">&quot;xy_line_eq_list&quot;</span><span class="p">:</span> <span class="n">xy_line_eq_list</span><span class="p">,</span>
            <span class="s2">&quot;km_mid&quot;</span><span class="p">:</span> <span class="n">km_mid</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create various plots</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="o">.</span><span class="n">plot_data</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">ErosionPlotter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">plot_flags</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;erosion_results&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;bank_data&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;water_level_data&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;erosion_inputs&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">plot_all</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;river_axis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;xy_line_eq_list&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;km_mid&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_bankline_shapefiles</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;bankline_new_list&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;bankline_eq_list&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_volume_outputs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;erosion_results&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;km_mid&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_bankline_shapefiles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span>
    <span class="p">):</span>
        <span class="n">bankline_new_series</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">bank_lines_new</span> <span class="o">=</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">bankline_new_series</span><span class="p">)</span>
        <span class="n">bank_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;BankFile&quot;</span><span class="p">,</span> <span class="s2">&quot;bankfile&quot;</span><span class="p">)</span>

        <span class="n">bank_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bank_name</span><span class="si">}</span><span class="s2">_new.shp&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_banklines&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)})</span>
        <span class="n">bank_lines_new</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)</span>

        <span class="n">bankline_eq_series</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">banklines_eq</span> <span class="o">=</span> <span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">bankline_eq_series</span><span class="p">)</span>

        <span class="n">bank_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bank_name</span><span class="si">}</span><span class="s2">_eq.shp&quot;</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_banklines&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)})</span>
        <span class="n">banklines_eq</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">bank_file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_volume_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">erosion_results</span><span class="p">:</span> <span class="n">ErosionResults</span><span class="p">,</span> <span class="n">km_mid</span><span class="p">):</span>
        <span class="n">erosion_vol_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;EroVol&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;erovol.evo&quot;</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_tot_erovol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">erosion_vol_file</span><span class="p">})</span>
        <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="o">.</span><span class="n">total_eroded_vol_per_km</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">erosion_vol_file</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># write eroded volumes per km (equilibrium)</span>
        <span class="n">erosion_vol_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;EroVolEqui&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;erovol_eq.evo&quot;</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;save_eq_erovol&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">erosion_vol_file</span><span class="p">})</span>
        <span class="n">write_km_eroded_volumes</span><span class="p">(</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="o">.</span><span class="n">eq_eroded_vol_per_km</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">erosion_vol_file</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize the Erosion class.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span> <span class="n">gui</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Erosion class.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">gui</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">ErosionRiverData</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">simulation_data</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sim_files</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">get_erosion_sim_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debugger</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span> <span class="o">=</span> <span class="n">ErosionCalculator</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="toclink">
            <code class="highlight language-python"><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span><span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.calculate_fairway_bank_line_distance" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Map bank data to fairway data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bank_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BankData (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.BankData&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.BankData">BankData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fairway_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FairwayData (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.FairwayData&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.FairwayData">FairwayData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simulation_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ErosionSimulationData (&lt;code&gt;dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData">ErosionSimulationData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>FairwayData</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method updates the following attributes in the <code>bank_data</code> instance
    - fairway_face_indices
    - fairway_distances</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>BankData</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the following attributes in the <code>fairway_data</code> instance
    - fairway_initial_water_levels</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_fairway_bank_line_distance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map bank data to fairway data.</span>

<span class="sd">    Args:</span>
<span class="sd">        bank_data (BankData):</span>
<span class="sd">        fairway_data (FairwayData):</span>
<span class="sd">        simulation_data (ErosionSimulationData):</span>

<span class="sd">    Returns:</span>
<span class="sd">        FairwayData:</span>
<span class="sd">            The method updates the following attributes in the `bank_data` instance</span>
<span class="sd">                - fairway_face_indices</span>
<span class="sd">                - fairway_distances</span>
<span class="sd">        BankData:</span>
<span class="sd">            the following attributes in the `fairway_data` instance</span>
<span class="sd">                - fairway_initial_water_levels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># distance fairway-bankline (bank-fairway)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_distance_fairway&quot;</span><span class="p">)</span>

    <span class="n">num_fairway_face_ind</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">bank_i</span><span class="p">,</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>
        <span class="n">bank_coords</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_line_coords</span>
        <span class="n">coords_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">bank_fairway_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">))</span>
        <span class="n">bp_fw_face_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">coord_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">):</span>
            <span class="c1"># find closest fairway support node</span>
            <span class="n">closest_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
                <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fairway_coord</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
            <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fairway_coord</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
            <span class="c1"># If fairway support node is also the closest projected fairway point, then it likely</span>
            <span class="c1"># that that point is one of the original support points (a corner) of the fairway path</span>
            <span class="c1"># and located inside a grid cell. The segments before and after that point will then</span>
            <span class="c1"># both be located inside that same grid cell, so let&#39;s pick the segment before the point.</span>
            <span class="c1"># If the point happens to coincide with a grid edge and the two segments are located</span>
            <span class="c1"># in different grid cells, then we could either simply choose one or add complexity to</span>
            <span class="c1"># average the values of the two grid cells. Let&#39;s go for the simplest approach ...</span>
            <span class="n">iseg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                    <span class="n">closest_ind</span><span class="p">,</span>
                    <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">coord_i</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span>
                        <span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                    <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                        <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                        <span class="c1"># projected point located on segment before, which corresponds to initial choice: iseg = ifw - 1</span>
            <span class="k">if</span> <span class="n">closest_ind</span> <span class="o">&lt;</span> <span class="n">num_fairway_face_ind</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">calculate_alpha</span><span class="p">(</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">,</span>
                    <span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">closest_ind</span><span class="p">,</span>
                    <span class="n">coord_i</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">alpha</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">fwp1</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="o">-</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">intersection_coords</span><span class="p">[</span><span class="n">closest_ind</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="p">((</span><span class="n">coord_i</span> <span class="o">-</span> <span class="n">fwp1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mf">0.5</span>
                    <span class="k">if</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">fairway_bank_distance</span><span class="p">:</span>
                        <span class="n">fairway_bank_distance</span> <span class="o">=</span> <span class="n">d1</span>
                        <span class="n">iseg</span> <span class="o">=</span> <span class="n">closest_ind</span>

            <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>
            <span class="n">bank_fairway_dist</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">fairway_bank_distance</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">coords_mid</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bank_</span><span class="si">{</span><span class="n">bank_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">_chainage_and_fairway_face_idx.shp&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                    <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">bp_fw_face_idx</span><span class="p">[</span><span class="n">bank_i</span><span class="p">],</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bp_fw_face_idx</span>
        <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span> <span class="o">=</span> <span class="n">bank_fairway_dist</span>

    <span class="c1"># water level at fairway</span>
    <span class="n">water_level_fairway_ref</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">single_bank</span> <span class="ow">in</span> <span class="n">bank_data</span><span class="p">:</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span>
        <span class="n">water_level_fairway_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulation_data</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
    <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span> <span class="o">=</span> <span class="n">water_level_fairway_ref</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="toclink">
            <code class="highlight language-python"><span class="n">compute_erosion_per_level</span><span class="p">(</span><span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span> <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleLevelParameters</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span> <span class="n">km_bin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">num_km</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SingleDischargeLevel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.compute_erosion_per_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Compute the bank erosion for a given level.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_erosion_per_level</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">bank_data</span><span class="p">:</span> <span class="n">BankData</span><span class="p">,</span>
    <span class="n">simulation_data</span><span class="p">:</span> <span class="n">ErosionSimulationData</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleLevelParameters</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">ErosionInputs</span><span class="p">,</span>
    <span class="n">km_bin</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">num_km</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SingleDischargeLevel</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the bank erosion for a given level.&quot;&quot;&quot;</span>
    <span class="n">num_levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">num_discharge_levels</span>
    <span class="n">dvol_bank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_km</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">par_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">bank_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_data</span><span class="p">):</span>

        <span class="n">single_calculation</span> <span class="o">=</span> <span class="n">SingleCalculation</span><span class="p">()</span>
        <span class="c1"># bank_i = 0: left bank, bank_i = 1: right bank</span>
        <span class="c1"># calculate velocity along banks ...</span>
        <span class="n">single_calculation</span><span class="o">.</span><span class="n">bank_velocity</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">calculate_bank_velocity</span><span class="p">(</span>
            <span class="n">bank_i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">vel_dx</span>
        <span class="p">)</span>

        <span class="c1"># get fairway face indices</span>
        <span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_face_indices</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">simulation_data</span><span class="o">.</span><span class="n">get_fairway_data</span><span class="p">(</span><span class="n">fairway_face_indices</span><span class="p">)</span>
        <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_level</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;water_level&quot;</span><span class="p">]</span>
        <span class="n">single_calculation</span><span class="o">.</span><span class="n">chezy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;chezy&quot;</span><span class="p">]</span>
        <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;water_depth&quot;</span><span class="p">]</span>

        <span class="c1"># get water depth along the fair-way</span>
        <span class="n">hfw_max_level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hfw_max_level</span><span class="p">,</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="c1"># last discharge level</span>
        <span class="k">if</span> <span class="n">level_i</span> <span class="o">==</span> <span class="n">num_levels</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">erosion_distance_eq</span><span class="p">,</span> <span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span><span class="o">.</span><span class="n">comp_erosion_eq</span><span class="p">(</span>
                    <span class="n">bank_i</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
                    <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                    <span class="n">single_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                    <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
                    <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
                    <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_eq</span> <span class="o">=</span> <span class="n">erosion_distance_eq</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_eq</span> <span class="o">=</span> <span class="n">erosion_volume_eq</span>

        <span class="n">single_calculation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">erosion_calculator</span><span class="o">.</span><span class="n">compute_bank_erosion_dynamics</span><span class="p">(</span>
            <span class="n">single_calculation</span><span class="p">,</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
            <span class="n">single_parameters</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">erosion_time</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_discharge</span><span class="p">[</span><span class="n">level_i</span><span class="p">],</span>
            <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">get_bank</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># accumulate eroded volumes per km</span>
        <span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">get_km_eroded_volume</span><span class="p">(</span>
            <span class="n">bank_i</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
            <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
            <span class="n">km_bin</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">single_calculation</span><span class="o">.</span><span class="n">volume_per_discharge</span> <span class="o">=</span> <span class="n">volume_per_discharge</span>
        <span class="n">par_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single_calculation</span><span class="p">)</span>

        <span class="n">dvol_bank</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">volume_per_discharge</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_debug_output</span><span class="p">(</span>
                <span class="n">level_i</span><span class="p">,</span>
                <span class="n">ind</span><span class="p">,</span>
                <span class="n">bank_data</span><span class="p">,</span>
                <span class="n">fairway_data</span><span class="p">,</span>
                <span class="n">erosion_inputs</span><span class="p">,</span>
                <span class="n">single_parameters</span><span class="p">,</span>
                <span class="n">num_levels</span><span class="p">,</span>
                <span class="n">single_calculation</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">level_calculation</span> <span class="o">=</span> <span class="n">SingleDischargeLevel</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">par_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hfw_max</span><span class="o">=</span><span class="n">hfw_max_level</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">level_calculation</span><span class="p">,</span> <span class="n">dvol_bank</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.bank_erosion.Erosion.run" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="toclink">
            <code class="highlight language-python"><span class="n">run</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.Erosion.run" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Run the bank erosion analysis for a specified configuration.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the bank erosion analysis for a specified configuration.&quot;&quot;&quot;</span>
    <span class="n">timed_logger</span><span class="p">(</span><span class="s2">&quot;-- start analysis --&quot;</span><span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span>
        <span class="s2">&quot;header_bankerosion&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">__version__</span><span class="p">,</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/Deltares/D-FAST_Bank_Erosion&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

    <span class="n">mesh_processor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_processor</span><span class="p">()</span>

    <span class="n">river_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">process_river_axis_by_center_line</span><span class="p">()</span>
    <span class="n">fairway_data</span> <span class="o">=</span> <span class="n">mesh_processor</span><span class="o">.</span><span class="n">get_fairway_data</span><span class="p">(</span><span class="n">river_axis</span><span class="p">)</span>

    <span class="c1"># map to the output interval</span>
    <span class="n">km_bin</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_intervals</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">km_mid</span> <span class="o">=</span> <span class="n">get_km_bins</span><span class="p">(</span><span class="n">km_bin</span><span class="p">,</span> <span class="n">station_type</span><span class="o">=</span><span class="s2">&quot;mid&quot;</span><span class="p">)</span>  <span class="c1"># get mid-points</span>

    <span class="c1"># map bank lines to mesh cells</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;intersect_bank_mesh&quot;</span><span class="p">)</span>
    <span class="n">bank_data</span> <span class="o">=</span> <span class="n">mesh_processor</span><span class="o">.</span><span class="n">get_bank_data</span><span class="p">()</span>
    <span class="c1"># map the bank data to the fairway data (the bank_data and fairway_data will be updated inside the `_map_bank_to_fairway` function)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fairway_bank_line_distance</span><span class="p">(</span>
        <span class="n">bank_data</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulation_data</span>
    <span class="p">)</span>

    <span class="n">erosion_inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_initial_conditions</span><span class="p">(</span>
        <span class="n">bank_data</span><span class="o">.</span><span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">fairway_data</span>
    <span class="p">)</span>

    <span class="c1"># initialize arrays for erosion loop over all discharges</span>
    <span class="n">water_level_data</span><span class="p">,</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_discharge_levels</span><span class="p">(</span>
        <span class="n">km_mid</span><span class="p">,</span>
        <span class="n">km_bin</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="n">bank_data</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">bankline_new_list</span><span class="p">,</span> <span class="n">bankline_eq_list</span><span class="p">,</span> <span class="n">xy_line_eq_list</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_erosion_results</span><span class="p">(</span>
            <span class="n">km_bin</span><span class="p">,</span>
            <span class="n">km_mid</span><span class="p">,</span>
            <span class="n">bank_data</span><span class="p">,</span>
            <span class="n">erosion_results</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;river_axis&quot;</span><span class="p">:</span> <span class="n">river_axis</span><span class="p">,</span>
        <span class="s2">&quot;bank_data&quot;</span><span class="p">:</span> <span class="n">bank_data</span><span class="p">,</span>
        <span class="s2">&quot;water_level_data&quot;</span><span class="p">:</span> <span class="n">water_level_data</span><span class="p">,</span>
        <span class="s2">&quot;erosion_results&quot;</span><span class="p">:</span> <span class="n">erosion_results</span><span class="p">,</span>
        <span class="s2">&quot;erosion_inputs&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="p">,</span>
        <span class="s2">&quot;bankline_new_list&quot;</span><span class="p">:</span> <span class="n">bankline_new_list</span><span class="p">,</span>
        <span class="s2">&quot;bankline_eq_list&quot;</span><span class="p">:</span> <span class="n">bankline_eq_list</span><span class="p">,</span>
        <span class="s2">&quot;xy_line_eq_list&quot;</span><span class="p">:</span> <span class="n">xy_line_eq_list</span><span class="p">,</span>
        <span class="s2">&quot;km_mid&quot;</span><span class="p">:</span> <span class="n">km_mid</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="dfastbe.bank_erosion.bank_erosion.calculate_alpha" class="doc doc-heading"><a href="#dfastbe.bank_erosion.bank_erosion.calculate_alpha" class="toclink">
            <code class="highlight language-python"><span class="n">calculate_alpha</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span></code>

</a><a href="#dfastbe.bank_erosion.bank_erosion.calculate_alpha" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the alpha value for the bank erosion model.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/bank_erosion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_alpha</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ind_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ind_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the alpha value for the bank erosion model.&quot;&quot;&quot;</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ind_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ind_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ind_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">ind_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">alpha</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="mesh-data-models"><a class="toclink" href="#mesh-data-models">Mesh data models</a><a class="headerlink" href="#mesh-data-models" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.mesh.data_models" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models" class="toclink">
            <code>dfastbe.bank_erosion.mesh.data_models</code>


</a><a href="#dfastbe.bank_erosion.mesh.data_models" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>This module defines data structures and methods for handling mesh data and river segments.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.data_models.Edges" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.Edges" class="toclink">
            <code>Edges</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.Edges" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Dataclass to hold edge candidates for left and right edges.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>left</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the left edge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left_theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angle of the left edge in radians.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>right</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the right edge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>right_theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angle of the right edge in radians.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>found</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether a valid edge pair was found.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Edges</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold edge candidates for left and right edges.</span>

<span class="sd">    Args:</span>
<span class="sd">        left (int):</span>
<span class="sd">            Index of the left edge.</span>
<span class="sd">        left_theta (float):</span>
<span class="sd">            Angle of the left edge in radians.</span>
<span class="sd">        right (int):</span>
<span class="sd">            Index of the right edge.</span>
<span class="sd">        right_theta (float):</span>
<span class="sd">            Angle of the right edge in radians.</span>
<span class="sd">        found (bool):</span>
<span class="sd">            Flag indicating whether a valid edge pair was found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">left</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">left_theta</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">right_theta</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">found</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_edges_by_angle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the left and right edges based on the angle difference.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span> <span class="o">=</span> <span class="n">dtheta</span>
            <span class="k">if</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span> <span class="o">=</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span>
        <span class="k">elif</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dtheta</span> <span class="o">=</span> <span class="o">-</span><span class="n">dtheta</span>
            <span class="k">if</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span> <span class="o">=</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span>
            <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span> <span class="o">=</span> <span class="n">dtheta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># aligned with edge</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: line is aligned with edge </span><span class="si">{</span><span class="n">edge_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.Edges.update_edges_by_angle" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.Edges.update_edges_by_angle" class="toclink">
            <code class="highlight language-python"><span class="n">update_edges_by_angle</span><span class="p">(</span><span class="n">edge_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.Edges.update_edges_by_angle" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Update the left and right edges based on the angle difference.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_edges_by_angle</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the left and right edges based on the angle difference.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span> <span class="o">=</span> <span class="n">dtheta</span>
        <span class="k">if</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span> <span class="o">=</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span>
    <span class="k">elif</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="o">-</span><span class="n">dtheta</span>
        <span class="k">if</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">left_theta</span> <span class="o">=</span> <span class="n">TWO_PI</span> <span class="o">-</span> <span class="n">dtheta</span>
        <span class="k">if</span> <span class="n">dtheta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">right_theta</span> <span class="o">=</span> <span class="n">dtheta</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># aligned with edge</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: line is aligned with edge </span><span class="si">{</span><span class="n">edge_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">edge_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">edge_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.data_models.MeshData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData" class="toclink">
            <code>MeshData</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to hold mesh-related data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x_face_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X-coordinates of the mesh faces.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_face_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-coordinates of the mesh faces.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_edge_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>X-coordinates of the mesh edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_edge_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Y-coordinates of the mesh edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>face_node</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node connectivity for each face.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_nodes</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes in the mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edge_node</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node connectivity for each edge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edge_face_connectivity</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per edge a list of the indices of the faces on the left and right side of that edge.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>face_edge_connectivity</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Per face a list of indices of the edges that together form the boundary of that face.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boundary_edge_nrs</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of edge indices that together form the boundary of the whole mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MeshData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold mesh-related data.</span>

<span class="sd">    args:</span>
<span class="sd">        x_face_coords (np.ndarray):</span>
<span class="sd">            X-coordinates of the mesh faces.</span>
<span class="sd">        y_face_coords (np.ndarray):</span>
<span class="sd">            Y-coordinates of the mesh faces.</span>
<span class="sd">        x_edge_coords (np.ndarray):</span>
<span class="sd">            X-coordinates of the mesh edges.</span>
<span class="sd">        y_edge_coords (np.ndarray):</span>
<span class="sd">            Y-coordinates of the mesh edges.</span>
<span class="sd">        face_node (np.ndarray):</span>
<span class="sd">            Node connectivity for each face.</span>
<span class="sd">        n_nodes (np.ndarray):</span>
<span class="sd">            Number of nodes in the mesh.</span>
<span class="sd">        edge_node (np.ndarray):</span>
<span class="sd">            Node connectivity for each edge.</span>
<span class="sd">        edge_face_connectivity (np.ndarray):</span>
<span class="sd">            Per edge a list of the indices of the faces on the left and right side of that edge.</span>
<span class="sd">        face_edge_connectivity (np.ndarray):</span>
<span class="sd">            Per face a list of indices of the edges that together form the boundary of that face.</span>
<span class="sd">        boundary_edge_nrs (np.ndarray):</span>
<span class="sd">            List of edge indices that together form the boundary of the whole mesh.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x_face_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">y_face_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">x_edge_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">y_edge_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">face_node</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">n_nodes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">edge_node</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">edge_face_connectivity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">face_edge_connectivity</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">boundary_edge_nrs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_face_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">as_polygon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Polygon</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the coordinates of the index-th mesh face as an (N, 2) array.</span>

<span class="sd">        Args:</span>
<span class="sd">            index:</span>
<span class="sd">                The face index.</span>
<span class="sd">            as_polygon:</span>
<span class="sd">                whither to return the face as a shapely polygon or not. Default is False</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray:</span>
<span class="sd">                Array of shape (n_nodes, 2) with x, y coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_face_coords</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_face_coords</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="k">if</span> <span class="n">as_polygon</span><span class="p">:</span>
            <span class="n">face</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">face</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">locate_point</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">face_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Locate a point in the mesh faces.</span>

<span class="sd">        Args:</span>
<span class="sd">            point:</span>
<span class="sd">                The point to check.</span>
<span class="sd">            face_index:</span>
<span class="sd">                The index of the mesh face.</span>

<span class="sd">        Returns:</span>
<span class="sd">            indexes (int|list[int]):</span>
<span class="sd">                index if the face that the point is located in, or a list of indexes if the point is on the edge of</span>
<span class="sd">                multiple faces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Point</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">point</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;point must be a Point object, a list, a tuple, or an np.ndarray of coordinates&quot;</span>
            <span class="p">)</span>

        <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">face_index</span><span class="p">:</span>
            <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_by_index</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="n">face_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">face_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ind</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create a closed line string from the face coordinates</span>
                <span class="n">closed_line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">face</span><span class="p">,</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
                <span class="k">if</span> <span class="n">closed_line</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
                    <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index_list</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_segment_intersections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the intersection of a line segment with the edges of a mesh face.</span>

<span class="sd">        This function determines where a line segment (defined by two points) intersects the edges of a mesh face.</span>
<span class="sd">        It returns the relative distances along the segment and the edges where the intersections occur, as well as</span>
<span class="sd">        flags indicating whether the intersections occur at nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int):</span>
<span class="sd">                Index of the current mesh face. If `index` is negative, the function assumes the segment intersects</span>
<span class="sd">                the boundary edges of the mesh.</span>
<span class="sd">            segment (RiverSegment):</span>
<span class="sd">                A `RiverSegment` object containing the previous and current points of the segment, as well as the</span>
<span class="sd">                minimum relative distance along the segment where the last intersection occurred.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray, np.ndarray, np.ndarray]:</span>
<span class="sd">                - b (np.ndarray):</span>
<span class="sd">                    Relative distances along the segment `bpj1-bpj` where the intersections occur.</span>
<span class="sd">                - edges (np.ndarray):</span>
<span class="sd">                    Indices of the edges that are intersected by the segment.</span>
<span class="sd">                - nodes (np.ndarray):</span>
<span class="sd">                    Flags indicating whether the intersections occur at nodes. A value of `-1` indicates no</span>
<span class="sd">                    intersection at a node, while other values correspond to node indices.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If the input data is invalid or inconsistent.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - If `index` is negative, the function assumes the segment intersects the boundary edges of the mesh.</span>
<span class="sd">            - The function uses the `get_slices_core` helper function to calculate the intersections.</span>
<span class="sd">            - Intersections at nodes are flagged in the `nodes` array, with the corresponding node indices.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_edge_nrs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_edge_intersections</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">is_intersected_at_node</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">edge_relative_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">is_intersected_at_node</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span>
            <span class="n">edges</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span>
        <span class="p">]</span>
        <span class="n">is_intersected_at_node</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span>
            <span class="n">edges</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">is_intersected_at_node</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_edge_intersections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span>
        <span class="n">limit_relative_distance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the intersection of a line segment with multiple mesh edges.</span>

<span class="sd">        This function determines where a line segment intersects a set of mesh edges.</span>
<span class="sd">        It calculates the relative distances along the segment and the edges where</span>
<span class="sd">        the intersections occur, and returns the indices of the intersected edges.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges (np.ndarray):</span>
<span class="sd">                Array containing the indices of the edges to check for intersections.</span>
<span class="sd">            segment (RiverSegment):</span>
<span class="sd">                A `RiverSegment` object containing the previous and current points of the segment, as well as the</span>
<span class="sd">                minimum relative distance along the segment where the last intersection occurred.</span>
<span class="sd">            limit_relative_distance (bool, optional):</span>
<span class="sd">                If True, limits the relative distance along the segment `bpj1-bpj`</span>
<span class="sd">                to a maximum of 1. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray, np.ndarray, np.ndarray]:</span>
<span class="sd">                - a (np.ndarray): Relative distances along the edges where the</span>
<span class="sd">                  intersections occur.</span>
<span class="sd">                - b (np.ndarray): Relative distances along the segment `bpj1-bpj`</span>
<span class="sd">                  where the intersections occur.</span>
<span class="sd">                - edges (np.ndarray): Indices of the edges that are intersected</span>
<span class="sd">                  by the segment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If the input data is invalid or inconsistent.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The function uses the `get_slices_ab` helper function to calculate the</span>
<span class="sd">              relative distances `a` and `b` for each edge.</span>
<span class="sd">            - The `bmin` parameter is used to filter out intersections that occur</span>
<span class="sd">              too close to the starting point of the segment.</span>
<span class="sd">            - If `limit_relative_distance` is True, intersections beyond the endpoint of the segment</span>
<span class="sd">              are ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_segment_edge_intersections</span>

        <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">valid_intersections</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">calculate_segment_edge_intersections</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span><span class="p">,</span>
                <span class="n">limit_relative_distance</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">valid_intersections</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_edge_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the angle of a mesh edge in radians.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge (int):</span>
<span class="sd">                The edge index.</span>
<span class="sd">            reverse (bool):</span>
<span class="sd">                If True, computes the angle from end to start.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The angle of the edge in radians.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">start</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">start</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Edges</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to find the left and right edges at a node based on the direction theta.</span>

<span class="sd">        Args:</span>
<span class="sd">            theta (float):</span>
<span class="sd">                Direction angle of the segment.</span>
<span class="sd">            node (int):</span>
<span class="sd">                The node index.</span>
<span class="sd">            verbose_index (int, optional):</span>
<span class="sd">                Step index for verbose output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Edges:</span>
<span class="sd">                A dataclass containing the left and right edge indices, their angle differences, and a found flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_node_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edges connected to node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> are </span><span class="si">{</span><span class="n">all_node_edges</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="n">Edges</span><span class="p">(</span><span class="n">left</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">left_theta</span><span class="o">=</span><span class="n">TWO_PI</span><span class="p">,</span> <span class="n">right</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">right_theta</span><span class="o">=</span><span class="n">TWO_PI</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="n">all_node_edges</span><span class="p">:</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">node</span>
            <span class="n">theta_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_edge_angle</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: edge </span><span class="si">{</span><span class="n">ie</span><span class="si">}</span><span class="s2"> connects </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="w"> </span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: edge </span><span class="si">{</span><span class="n">ie</span><span class="si">}</span><span class="s2"> theta is </span><span class="si">{</span><span class="n">theta_edge</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_edge</span> <span class="o">-</span> <span class="n">theta</span>

            <span class="n">edges</span><span class="o">.</span><span class="n">update_edges_by_angle</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">edges</span><span class="o">.</span><span class="n">found</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the left is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the right is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_next_face_from_edges</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">Edges</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to resolve the next face index when traversing between two edges at a node.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (int): The node index.</span>
<span class="sd">            edges (Edges):</span>
<span class="sd">                The edges connecting the node, containing left and right edge indices.</span>
<span class="sd">            verbose_index (int, optional):</span>
<span class="sd">                Step index for verbose output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            next_face_index (int):</span>
<span class="sd">                The next face index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">right_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span> <span class="ow">and</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
            <span class="n">fn1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">fe1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: those edges are shared by two faces: </span><span class="si">{</span><span class="n">left_faces</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: face </span><span class="si">{</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> has nodes: </span><span class="si">{</span><span class="n">fn1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: face </span><span class="si">{</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> has edges: </span><span class="si">{</span><span class="n">fe1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># nodes of the face should be listed in clockwise order</span>
            <span class="c1"># edges[i] is the edge connecting node[i-1] with node[i]</span>
            <span class="c1"># the latter is guaranteed by batch.derive_topology_arrays</span>
            <span class="k">if</span> <span class="n">fe1</span><span class="p">[</span><span class="n">fn1</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
                <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Shouldn&#39;t come here .... left edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; and right edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2"> don&#39;t share any face&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">next_face_index</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_angle" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_angle" class="toclink">
            <code class="highlight language-python"><span class="n">calculate_edge_angle</span><span class="p">(</span><span class="n">edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_angle" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate the angle of a mesh edge in radians.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edge</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edge index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reverse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, computes the angle from end to start.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The angle of the edge in radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_edge_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the angle of a mesh edge in radians.</span>

<span class="sd">    Args:</span>
<span class="sd">        edge (int):</span>
<span class="sd">            The edge index.</span>
<span class="sd">        reverse (bool):</span>
<span class="sd">            If True, computes the angle from end to start.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The angle of the edge in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">start</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edge</span><span class="p">,</span> <span class="n">start</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_intersections" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_intersections" class="toclink">
            <code class="highlight language-python"><span class="n">calculate_edge_intersections</span><span class="p">(</span><span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">limit_relative_distance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.calculate_edge_intersections" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate the intersection of a line segment with multiple mesh edges.</p>
<p>This function determines where a line segment intersects a set of mesh edges.
It calculates the relative distances along the segment and the edges where
the intersections occur, and returns the indices of the intersected edges.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array containing the indices of the edges to check for intersections.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RiverSegment (&lt;code&gt;dfastbe.bank_erosion.mesh.data_models.RiverSegment&lt;/code&gt;)" href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment">RiverSegment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>RiverSegment</code> object containing the previous and current points of the segment, as well as the
minimum relative distance along the segment where the last intersection occurred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_relative_distance</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, limits the relative distance along the segment <code>bpj1-bpj</code>
to a maximum of 1. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray, np.ndarray]:
- a (np.ndarray): Relative distances along the edges where the
  intersections occur.
- b (np.ndarray): Relative distances along the segment <code>bpj1-bpj</code>
  where the intersections occur.
- edges (np.ndarray): Indices of the edges that are intersected
  by the segment.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input data is invalid or inconsistent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function uses the <code>get_slices_ab</code> helper function to calculate the
  relative distances <code>a</code> and <code>b</code> for each edge.</li>
<li>The <code>bmin</code> parameter is used to filter out intersections that occur
  too close to the starting point of the segment.</li>
<li>If <code>limit_relative_distance</code> is True, intersections beyond the endpoint of the segment
  are ignored.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_edge_intersections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span>
    <span class="n">limit_relative_distance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the intersection of a line segment with multiple mesh edges.</span>

<span class="sd">    This function determines where a line segment intersects a set of mesh edges.</span>
<span class="sd">    It calculates the relative distances along the segment and the edges where</span>
<span class="sd">    the intersections occur, and returns the indices of the intersected edges.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges (np.ndarray):</span>
<span class="sd">            Array containing the indices of the edges to check for intersections.</span>
<span class="sd">        segment (RiverSegment):</span>
<span class="sd">            A `RiverSegment` object containing the previous and current points of the segment, as well as the</span>
<span class="sd">            minimum relative distance along the segment where the last intersection occurred.</span>
<span class="sd">        limit_relative_distance (bool, optional):</span>
<span class="sd">            If True, limits the relative distance along the segment `bpj1-bpj`</span>
<span class="sd">            to a maximum of 1. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray, np.ndarray]:</span>
<span class="sd">            - a (np.ndarray): Relative distances along the edges where the</span>
<span class="sd">              intersections occur.</span>
<span class="sd">            - b (np.ndarray): Relative distances along the segment `bpj1-bpj`</span>
<span class="sd">              where the intersections occur.</span>
<span class="sd">            - edges (np.ndarray): Indices of the edges that are intersected</span>
<span class="sd">              by the segment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:</span>
<span class="sd">            If the input data is invalid or inconsistent.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function uses the `get_slices_ab` helper function to calculate the</span>
<span class="sd">          relative distances `a` and `b` for each edge.</span>
<span class="sd">        - The `bmin` parameter is used to filter out intersections that occur</span>
<span class="sd">          too close to the starting point of the segment.</span>
<span class="sd">        - If `limit_relative_distance` is True, intersections beyond the endpoint of the segment</span>
<span class="sd">          are ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_segment_edge_intersections</span>

    <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">valid_intersections</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">calculate_segment_edge_intersections</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_edge_coords</span><span class="p">[</span><span class="n">edges</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span><span class="p">,</span>
            <span class="n">limit_relative_distance</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="n">valid_intersections</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.find_edges" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_edges" class="toclink">
            <code class="highlight language-python"><span class="n">find_edges</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Edges</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_edges" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Helper to find the left and right edges at a node based on the direction theta.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Direction angle of the segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The node index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step index for verbose output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Edges</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Edges (&lt;code&gt;dfastbe.bank_erosion.mesh.data_models.Edges&lt;/code&gt;)" href="#dfastbe.bank_erosion.mesh.data_models.Edges">Edges</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dataclass containing the left and right edge indices, their angle differences, and a found flag.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Edges</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to find the left and right edges at a node based on the direction theta.</span>

<span class="sd">    Args:</span>
<span class="sd">        theta (float):</span>
<span class="sd">            Direction angle of the segment.</span>
<span class="sd">        node (int):</span>
<span class="sd">            The node index.</span>
<span class="sd">        verbose_index (int, optional):</span>
<span class="sd">            Step index for verbose output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Edges:</span>
<span class="sd">            A dataclass containing the left and right edge indices, their angle differences, and a found flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_node_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span> <span class="o">==</span> <span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edges connected to node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> are </span><span class="si">{</span><span class="n">all_node_edges</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="n">Edges</span><span class="p">(</span><span class="n">left</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">left_theta</span><span class="o">=</span><span class="n">TWO_PI</span><span class="p">,</span> <span class="n">right</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">right_theta</span><span class="o">=</span><span class="n">TWO_PI</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ie</span> <span class="ow">in</span> <span class="n">all_node_edges</span><span class="p">:</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">node</span>
        <span class="n">theta_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_edge_angle</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: edge </span><span class="si">{</span><span class="n">ie</span><span class="si">}</span><span class="s2"> connects </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span><span class="n">ie</span><span class="p">,</span><span class="w"> </span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: edge </span><span class="si">{</span><span class="n">ie</span><span class="si">}</span><span class="s2"> theta is </span><span class="si">{</span><span class="n">theta_edge</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">dtheta</span> <span class="o">=</span> <span class="n">theta_edge</span> <span class="o">-</span> <span class="n">theta</span>

        <span class="n">edges</span><span class="o">.</span><span class="n">update_edges_by_angle</span><span class="p">(</span><span class="n">ie</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edges</span><span class="o">.</span><span class="n">found</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the left is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the right is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.find_segment_intersections" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_segment_intersections" class="toclink">
            <code class="highlight language-python"><span class="n">find_segment_intersections</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.find_segment_intersections" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate the intersection of a line segment with the edges of a mesh face.</p>
<p>This function determines where a line segment (defined by two points) intersects the edges of a mesh face.
It returns the relative distances along the segment and the edges where the intersections occur, as well as
flags indicating whether the intersections occur at nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the current mesh face. If <code>index</code> is negative, the function assumes the segment intersects
the boundary edges of the mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segment</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RiverSegment (&lt;code&gt;dfastbe.bank_erosion.mesh.data_models.RiverSegment&lt;/code&gt;)" href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment">RiverSegment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>RiverSegment</code> object containing the previous and current points of the segment, as well as the
minimum relative distance along the segment where the last intersection occurred.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray, np.ndarray]:
- b (np.ndarray):
    Relative distances along the segment <code>bpj1-bpj</code> where the intersections occur.
- edges (np.ndarray):
    Indices of the edges that are intersected by the segment.
- nodes (np.ndarray):
    Flags indicating whether the intersections occur at nodes. A value of <code>-1</code> indicates no
    intersection at a node, while other values correspond to node indices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the input data is invalid or inconsistent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>If <code>index</code> is negative, the function assumes the segment intersects the boundary edges of the mesh.</li>
<li>The function uses the <code>get_slices_core</code> helper function to calculate the intersections.</li>
<li>Intersections at nodes are flagged in the <code>nodes</code> array, with the corresponding node indices.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_segment_intersections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the intersection of a line segment with the edges of a mesh face.</span>

<span class="sd">    This function determines where a line segment (defined by two points) intersects the edges of a mesh face.</span>
<span class="sd">    It returns the relative distances along the segment and the edges where the intersections occur, as well as</span>
<span class="sd">    flags indicating whether the intersections occur at nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        index (int):</span>
<span class="sd">            Index of the current mesh face. If `index` is negative, the function assumes the segment intersects</span>
<span class="sd">            the boundary edges of the mesh.</span>
<span class="sd">        segment (RiverSegment):</span>
<span class="sd">            A `RiverSegment` object containing the previous and current points of the segment, as well as the</span>
<span class="sd">            minimum relative distance along the segment where the last intersection occurred.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray, np.ndarray]:</span>
<span class="sd">            - b (np.ndarray):</span>
<span class="sd">                Relative distances along the segment `bpj1-bpj` where the intersections occur.</span>
<span class="sd">            - edges (np.ndarray):</span>
<span class="sd">                Indices of the edges that are intersected by the segment.</span>
<span class="sd">            - nodes (np.ndarray):</span>
<span class="sd">                Flags indicating whether the intersections occur at nodes. A value of `-1` indicates no</span>
<span class="sd">                intersection at a node, while other values correspond to node indices.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:</span>
<span class="sd">            If the input data is invalid or inconsistent.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - If `index` is negative, the function assumes the segment intersects the boundary edges of the mesh.</span>
<span class="sd">        - The function uses the `get_slices_core` helper function to calculate the intersections.</span>
<span class="sd">        - Intersections at nodes are flagged in the `nodes` array, with the corresponding node indices.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_edge_nrs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
    <span class="n">edge_relative_dist</span><span class="p">,</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_edge_intersections</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">is_intersected_at_node</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">edge_relative_dist</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="n">is_intersected_at_node</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span>
        <span class="n">edges</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span>
    <span class="p">]</span>
    <span class="n">is_intersected_at_node</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_node</span><span class="p">[</span>
        <span class="n">edges</span><span class="p">[</span><span class="n">edge_relative_dist</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">segment_relative_dist</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">is_intersected_at_node</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.get_face_by_index" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.get_face_by_index" class="toclink">
            <code class="highlight language-python"><span class="n">get_face_by_index</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">as_polygon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Polygon</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.get_face_by_index" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the coordinates of the index-th mesh face as an (N, 2) array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The face index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_polygon</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whither to return the face as a shapely polygon or not. Default is False</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="shapely.geometry.Polygon">Polygon</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray:
Array of shape (n_nodes, 2) with x, y coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_face_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">as_polygon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">Polygon</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the coordinates of the index-th mesh face as an (N, 2) array.</span>

<span class="sd">    Args:</span>
<span class="sd">        index:</span>
<span class="sd">            The face index.</span>
<span class="sd">        as_polygon:</span>
<span class="sd">            whither to return the face as a shapely polygon or not. Default is False</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray:</span>
<span class="sd">            Array of shape (n_nodes, 2) with x, y coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_face_coords</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_face_coords</span><span class="p">[</span><span class="n">index</span> <span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
    <span class="n">face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">as_polygon</span><span class="p">:</span>
        <span class="n">face</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">face</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.locate_point" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.locate_point" class="toclink">
            <code class="highlight language-python"><span class="n">locate_point</span><span class="p">(</span><span class="n">point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">face_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.locate_point" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Locate a point in the mesh faces.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>point</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.Point">Point</span> | <span title="numpy.ndarray">ndarray</span> | <span title="list">list</span> | <span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The point to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>face_index</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the mesh face.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>indexes</code></td>            <td>
                  <code><span title="int">int</span> | <span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index if the face that the point is located in, or a list of indexes if the point is on the edge of
multiple faces.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">locate_point</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Point</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">face_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Locate a point in the mesh faces.</span>

<span class="sd">    Args:</span>
<span class="sd">        point:</span>
<span class="sd">            The point to check.</span>
<span class="sd">        face_index:</span>
<span class="sd">            The index of the mesh face.</span>

<span class="sd">    Returns:</span>
<span class="sd">        indexes (int|list[int]):</span>
<span class="sd">            index if the face that the point is located in, or a list of indexes if the point is on the edge of</span>
<span class="sd">            multiple faces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Point</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">point</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;point must be a Point object, a list, a tuple, or an np.ndarray of coordinates&quot;</span>
        <span class="p">)</span>

    <span class="n">index_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">face_index</span><span class="p">:</span>
        <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_by_index</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="n">face_polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">face_polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ind</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># create a closed line string from the face coordinates</span>
            <span class="n">closed_line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">face</span><span class="p">,</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
            <span class="k">if</span> <span class="n">closed_line</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
                <span class="n">index_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">index_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.MeshData.resolve_next_face_from_edges" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.resolve_next_face_from_edges" class="toclink">
            <code class="highlight language-python"><span class="n">resolve_next_face_from_edges</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">Edges</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.MeshData.resolve_next_face_from_edges" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Helper to resolve the next face index when traversing between two edges at a node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The node index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Edges (&lt;code&gt;dfastbe.bank_erosion.mesh.data_models.Edges&lt;/code&gt;)" href="#dfastbe.bank_erosion.mesh.data_models.Edges">Edges</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edges connecting the node, containing left and right edge indices.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Step index for verbose output.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>next_face_index</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The next face index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_next_face_from_edges</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">:</span> <span class="n">Edges</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to resolve the next face index when traversing between two edges at a node.</span>

<span class="sd">    Args:</span>
<span class="sd">        node (int): The node index.</span>
<span class="sd">        edges (Edges):</span>
<span class="sd">            The edges connecting the node, containing left and right edge indices.</span>
<span class="sd">        verbose_index (int, optional):</span>
<span class="sd">            Step index for verbose output.</span>

<span class="sd">    Returns:</span>
<span class="sd">        next_face_index (int):</span>
<span class="sd">            The next face index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">right_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span> <span class="ow">and</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
        <span class="n">fn1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">fe1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="ow">and</span> <span class="n">verbose_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: those edges are shared by two faces: </span><span class="si">{</span><span class="n">left_faces</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: face </span><span class="si">{</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> has nodes: </span><span class="si">{</span><span class="n">fn1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: face </span><span class="si">{</span><span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> has edges: </span><span class="si">{</span><span class="n">fe1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># nodes of the face should be listed in clockwise order</span>
        <span class="c1"># edges[i] is the edge connecting node[i-1] with node[i]</span>
        <span class="c1"># the latter is guaranteed by batch.derive_topology_arrays</span>
        <span class="k">if</span> <span class="n">fe1</span><span class="p">[</span><span class="n">fn1</span> <span class="o">==</span> <span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">right_faces</span><span class="p">:</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">left_faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Shouldn&#39;t come here .... left edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot; and right edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2"> don&#39;t share any face&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">next_face_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.data_models.RiverSegment" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment" class="toclink">
            <code>RiverSegment</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Represents a segment of a river line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>min_relative_distance</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The relative distance along the previous segment where the last intersection occurred. Used to filter
intersections along the current segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_point</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1D array of shape (2,) containing the x, y coordinates of the current point of the line segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>previous_point</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1D array of shape (2,) containing the x, y coordinates of the previous point of the line segment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RiverSegment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a segment of a river line.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_relative_distance (float):</span>
<span class="sd">            The relative distance along the previous segment where the last intersection occurred. Used to filter</span>
<span class="sd">            intersections along the current segment.</span>
<span class="sd">        current_point (np.ndarray):</span>
<span class="sd">            A 1D array of shape (2,) containing the x, y coordinates of the current point of the line segment.</span>
<span class="sd">        previous_point (np.ndarray):</span>
<span class="sd">            A 1D array of shape (2,) containing the x, y coordinates of the previous point of the line segment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">min_relative_distance</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">current_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">previous_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">distances</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_length_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the segment has zero length.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_point</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the angle of the segment in radians.&quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">theta</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_first_intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the first crossing from a set of edges and their associated distances.</span>

<span class="sd">        line segment crosses the edge list multiple times</span>
<span class="sd">            - moving out of a cell at a corner node</span>
<span class="sd">            - moving into and out of the mesh from outside</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the minimum distance from the distances array</span>
        <span class="n">min_distance_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.mesh.data_models.RiverSegment.theta" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.theta" class="toclink">
            <code class="highlight language-python"><span class="n">theta</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.theta" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate the angle of the segment in radians.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.RiverSegment.is_length_zero" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.is_length_zero" class="toclink">
            <code class="highlight language-python"><span class="n">is_length_zero</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.is_length_zero" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the segment has zero length.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_length_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the segment has zero length.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_point</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.data_models.RiverSegment.select_first_intersection" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.select_first_intersection" class="toclink">
            <code class="highlight language-python"><span class="n">select_first_intersection</span><span class="p">()</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.data_models.RiverSegment.select_first_intersection" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Select the first crossing from a set of edges and their associated distances.</p>
<p>line segment crosses the edge list multiple times
    - moving out of a cell at a corner node
    - moving into and out of the mesh from outside</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/data_models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select_first_intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the first crossing from a set of edges and their associated distances.</span>

<span class="sd">    line segment crosses the edge list multiple times</span>
<span class="sd">        - moving out of a cell at a corner node</span>
<span class="sd">        - moving into and out of the mesh from outside</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the minimum distance from the distances array</span>
    <span class="n">min_distance_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">min_distance_indices</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="mesh-processing"><a class="toclink" href="#mesh-processing">Mesh Processing</a><a class="headerlink" href="#mesh-processing" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.mesh.processor" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor" class="toclink">
            <code>dfastbe.bank_erosion.mesh.processor</code>


</a><a href="#dfastbe.bank_erosion.mesh.processor" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>module for processing mesh-related operations.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.processor.IntersectionState" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState" class="toclink">
            <code>IntersectionState</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IntersectionState</span><span class="p">:</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">face_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">point_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_face_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">vertex_index</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">int</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the intersection results with given shape.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_bank_point</span><span class="p">,</span> <span class="n">shape_length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finalize a segment</span>

<span class="sd">        Enlarge arrays if needed, set coordinates and index, and increment ind.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">shape_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">shape_length</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c1"># last coordinate reached, so enlarge arrays</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_length</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_length</span><span class="p">,))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_bank_point</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_mesh_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_status</span><span class="p">:</span> <span class="n">Status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to print mesh transition information for debugging.&quot;&quot;&quot;</span>
        <span class="n">index_str</span> <span class="o">=</span> <span class="s2">&quot;outside&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">index_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;edge between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">log_status</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">index_str</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_main_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_status</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">log_status</span><span class="o">.</span><span class="n">transition_type</span> <span class="o">=</span> <span class="s2">&quot;node&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_mesh_transition</span><span class="p">(</span><span class="n">log_status</span><span class="p">)</span>

        <span class="n">face_indexes</span> <span class="o">=</span> <span class="n">log_status</span><span class="o">.</span><span class="n">face_index</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">face_indexes</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">face_indexes</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">face_indexes</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">face_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span> <span class="o">=</span> <span class="n">face_indexes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_index_and_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper to update mesh index and log transitions for intersect_line_mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">face_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_main_attributes</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">status</span><span class="o">.</span><span class="n">transition_type</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span>
        <span class="n">status</span><span class="o">.</span><span class="n">transition_index</span> <span class="o">=</span> <span class="n">edge</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">:</span>
                <span class="n">other_face</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="n">status</span><span class="o">.</span><span class="n">face_index</span> <span class="o">=</span> <span class="n">other_face</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_mesh_transition</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">other_face</span>
                <span class="k">return</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Shouldn&#39;t come here .... index </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="si">}</span><span class="s2"> differs from both faces &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> associated with slicing edge </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.IntersectionState.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Initialize the intersection results with given shape.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the intersection results with given shape.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.IntersectionState.update" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update" class="toclink">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">current_bank_point</span><span class="p">,</span> <span class="n">shape_length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Finalize a segment</p>
<p>Enlarge arrays if needed, set coordinates and index, and increment ind.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_bank_point</span><span class="p">,</span> <span class="n">shape_length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finalize a segment</span>

<span class="sd">    Enlarge arrays if needed, set coordinates and index, and increment ind.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">shape_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">shape_length</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c1"># last coordinate reached, so enlarge arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_length</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="n">enlarge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_length</span><span class="p">,))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_bank_point</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_index</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.IntersectionState.update_index_and_log" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update_index_and_log" class="toclink">
            <code class="highlight language-python"><span class="n">update_index_and_log</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.IntersectionState.update_index_and_log" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Helper to update mesh index and log transitions for intersect_line_mesh.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_index_and_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper to update mesh index and log transitions for intersect_line_mesh.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">face_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_main_attributes</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">status</span><span class="o">.</span><span class="n">transition_type</span> <span class="o">=</span> <span class="s2">&quot;edge&quot;</span>
    <span class="n">status</span><span class="o">.</span><span class="n">transition_index</span> <span class="o">=</span> <span class="n">edge</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">faces</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">face</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">:</span>
            <span class="n">other_face</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">status</span><span class="o">.</span><span class="n">face_index</span> <span class="o">=</span> <span class="n">other_face</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_mesh_transition</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">other_face</span>
            <span class="k">return</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Shouldn&#39;t come here .... index </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_face_index</span><span class="si">}</span><span class="s2"> differs from both faces &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> associated with slicing edge </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.processor.MeshProcessor" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor" class="toclink">
            <code>MeshProcessor</code>


</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to process bank lines and intersect them with a mesh.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MeshProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to process bank lines and intersect them with a mesh.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">river_data</span><span class="p">:</span> <span class="n">ErosionRiverData</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for MeshProcessor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span> <span class="o">=</span> <span class="n">river_data</span><span class="o">.</span><span class="n">bank_lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span> <span class="o">=</span> <span class="n">mesh_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">river_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">MeshWrapper</span><span class="p">(</span><span class="n">mesh_data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_fairway_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">river_axis</span><span class="p">:</span> <span class="n">LineGeometry</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FairwayData</span><span class="p">:</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_fairway&quot;</span><span class="p">)</span>
        <span class="c1"># intersect fairway and mesh</span>
        <span class="n">fairway_intersection_coords</span><span class="p">,</span> <span class="n">fairway_face_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span><span class="o">.</span><span class="n">intersect_with_coords</span><span class="p">(</span><span class="n">river_axis</span><span class="o">.</span><span class="n">as_array</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">fairway_intersection_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">fairway_intersection_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">line_geom</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">river_axis</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">line_geom</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span>
                <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/fairway_face_indices.shp&quot;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;iface&quot;</span><span class="p">:</span> <span class="n">fairway_face_indices</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">FairwayData</span><span class="p">(</span><span class="n">fairway_face_indices</span><span class="p">,</span> <span class="n">fairway_intersection_coords</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bank_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BankData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Intersect bank lines with a mesh and return bank data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BankData object containing bank line coordinates, face indices, and other bank-related data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_bank_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">)</span>

        <span class="n">bank_line_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bank_face_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bank_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bank_lines</span><span class="p">):</span>
            <span class="n">line_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_nodes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">bank_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_coords</span><span class="p">)})</span>

            <span class="n">coords_along_bank</span><span class="p">,</span> <span class="n">face_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span><span class="o">.</span><span class="n">intersect_with_coords</span><span class="p">(</span><span class="n">line_coords</span><span class="p">)</span>
            <span class="n">bank_line_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords_along_bank</span><span class="p">)</span>
            <span class="n">bank_face_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_indices</span><span class="p">)</span>

        <span class="n">bank_order</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_lines_to_stations</span><span class="p">(</span><span class="n">bank_line_coords</span><span class="p">,</span> <span class="n">bank_face_indices</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BankData</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">SingleBank</span><span class="p">,</span>
            <span class="n">bank_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">,</span>
            <span class="n">n_bank_lines</span><span class="o">=</span><span class="n">n_bank_lines</span><span class="p">,</span>
            <span class="n">bank_order</span><span class="o">=</span><span class="n">bank_order</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_link_lines_to_stations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank_line_coords</span><span class="p">,</span> <span class="n">bank_face_indices</span><span class="p">):</span>
        <span class="c1"># linking bank lines to chainage</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_banks&quot;</span><span class="p">)</span>
        <span class="n">river_center_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="n">n_bank_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">)</span>

        <span class="n">bank_chainage_midpoints</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_bank_lines</span>
        <span class="n">is_right_bank</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_bank_lines</span>
        <span class="k">for</span> <span class="n">bank_index</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bank_line_coords</span><span class="p">):</span>
            <span class="n">segment_mid_points</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">((</span><span class="n">coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">chainage_mid_points</span> <span class="o">=</span> <span class="n">segment_mid_points</span><span class="o">.</span><span class="n">intersect_with_line</span><span class="p">(</span>
                <span class="n">river_center_line</span>
            <span class="p">)</span>

            <span class="c1"># check if the bank line is defined from low chainage to high chainage</span>
            <span class="k">if</span> <span class="n">chainage_mid_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">chainage_mid_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># if not, flip the bank line and all associated data</span>
                <span class="n">chainage_mid_points</span> <span class="o">=</span> <span class="n">chainage_mid_points</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">bank_line_coords</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">bank_line_coords</span><span class="p">[</span><span class="n">bank_index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">bank_face_indices</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">bank_face_indices</span><span class="p">[</span><span class="n">bank_index</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">bank_chainage_midpoints</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">chainage_mid_points</span>

            <span class="c1"># check if the bank line is a left or right bank</span>
            <span class="c1"># when looking from low-to-high chainage</span>
            <span class="n">is_right_bank</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">on_right_side</span><span class="p">(</span>
                <span class="n">coords</span><span class="p">,</span> <span class="n">river_center_line</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">is_right_bank</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]:</span>
                <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;right_side_bank&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">bank_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;left_side_bank&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">bank_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">})</span>

        <span class="n">bank_order</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="s2">&quot;right&quot;</span> <span class="k">if</span> <span class="n">val</span> <span class="k">else</span> <span class="s2">&quot;left&quot;</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">is_right_bank</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;is_right_bank&#39;</span><span class="p">:</span> <span class="n">is_right_bank</span><span class="p">,</span>
            <span class="s1">&#39;bank_line_coords&#39;</span><span class="p">:</span> <span class="n">bank_line_coords</span><span class="p">,</span>
            <span class="s1">&#39;bank_face_indices&#39;</span><span class="p">:</span> <span class="n">bank_face_indices</span><span class="p">,</span>
            <span class="s1">&#39;bank_chainage_midpoints&#39;</span><span class="p">:</span> <span class="n">bank_chainage_midpoints</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">bank_order</span><span class="p">,</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.MeshProcessor.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">river_data</span><span class="p">:</span> <span class="n">ErosionRiverData</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Constructor for MeshProcessor.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">river_data</span><span class="p">:</span> <span class="n">ErosionRiverData</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor for MeshProcessor.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span> <span class="o">=</span> <span class="n">river_data</span><span class="o">.</span><span class="n">bank_lines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span> <span class="o">=</span> <span class="n">mesh_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">river_data</span> <span class="o">=</span> <span class="n">river_data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span> <span class="o">=</span> <span class="n">MeshWrapper</span><span class="p">(</span><span class="n">mesh_data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.MeshProcessor.get_bank_data" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.get_bank_data" class="toclink">
            <code class="highlight language-python"><span class="n">get_bank_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">BankData</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshProcessor.get_bank_data" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Intersect bank lines with a mesh and return bank data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="BankData (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.BankData&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.BankData">BankData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>BankData object containing bank line coordinates, face indices, and other bank-related data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_bank_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BankData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Intersect bank lines with a mesh and return bank data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BankData object containing bank line coordinates, face indices, and other bank-related data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_bank_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">)</span>

    <span class="n">bank_line_coords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bank_face_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bank_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bank_lines</span><span class="p">):</span>
        <span class="n">line_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="o">.</span><span class="n">geometry</span><span class="p">[</span><span class="n">bank_index</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_nodes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ib&quot;</span><span class="p">:</span> <span class="n">bank_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_coords</span><span class="p">)})</span>

        <span class="n">coords_along_bank</span><span class="p">,</span> <span class="n">face_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapper</span><span class="o">.</span><span class="n">intersect_with_coords</span><span class="p">(</span><span class="n">line_coords</span><span class="p">)</span>
        <span class="n">bank_line_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords_along_bank</span><span class="p">)</span>
        <span class="n">bank_face_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_indices</span><span class="p">)</span>

    <span class="n">bank_order</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_link_lines_to_stations</span><span class="p">(</span><span class="n">bank_line_coords</span><span class="p">,</span> <span class="n">bank_face_indices</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">BankData</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">SingleBank</span><span class="p">,</span>
        <span class="n">bank_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span><span class="p">,</span>
        <span class="n">n_bank_lines</span><span class="o">=</span><span class="n">n_bank_lines</span><span class="p">,</span>
        <span class="n">bank_order</span><span class="o">=</span><span class="n">bank_order</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.mesh.processor.MeshWrapper" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper" class="toclink">
            <code>MeshWrapper</code>


</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>A class for processing mesh-related operations.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MeshWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class for processing mesh-related operations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">:</span> <span class="n">MeshData</span><span class="p">,</span> <span class="n">d_thresh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span> <span class="o">=</span> <span class="n">mesh_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d_thresh</span> <span class="o">=</span> <span class="n">d_thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_target_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy_coords</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span> <span class="o">=</span> <span class="n">xy_coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span> <span class="o">=</span> <span class="n">IntersectionState</span><span class="p">(</span><span class="n">xy_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_first_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_bank_point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># get the point on the mesh face that is closest to the first bank point</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">x_face_coords</span> <span class="o">-</span> <span class="n">current_bank_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">y_face_coords</span> <span class="o">-</span> <span class="n">current_bank_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">closest_cell_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="o">~</span><span class="p">(</span>
                <span class="p">(</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">|</span> <span class="p">(</span><span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">|</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">|</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">index</span><span class="p">,</span> <span class="n">vindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_starting_face</span><span class="p">(</span><span class="n">closest_cell_ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">vertex_index</span> <span class="o">=</span> <span class="n">vindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_bank_point</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_starting_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_indexes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the starting face for a bank line segment.</span>

<span class="sd">        This function determines the face index and vertex indices of the mesh</span>
<span class="sd">        that the first point of a bank line segment is associated with.</span>

<span class="sd">        Args:</span>
<span class="sd">            face_indexes (np.ndarray): Array of possible cell indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting outside mesh&quot;</span><span class="p">)</span>

        <span class="n">edges_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">locate_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">face_indexes</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edges_indexes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># A single index was returned</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">edges_indexes</span>
            <span class="n">vindex</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># A list of indices is expected</span>
            <span class="k">if</span> <span class="n">edges_indexes</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;starting on edge of </span><span class="si">{</span><span class="n">edges_indexes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">edges_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vindex</span> <span class="o">=</span> <span class="n">edges_indexes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;starting outside mesh&quot;</span><span class="p">)</span>
                <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">vindex</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">vindex</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_slice_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">prev_b</span><span class="p">,</span> <span class="n">bpj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prev_b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: -- no further slices along this segment --&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: -- no slices along this segment --&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">bpj</span><span class="p">)</span>
            <span class="n">polygon_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">get_face_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">,</span> <span class="n">as_polygon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">polygon_k</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pnt</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">: ERROR: point actually not contained within </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span><span class="si">}</span><span class="s2">!&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_node_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the transition at a node when a segment ends or continues.&quot;&quot;&quot;</span>
        <span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: moving via node </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> on edges </span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># figure out where we will be heading afterwards ...</span>
        <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="c1"># segment passes through node and enter non-neighbouring cell ...</span>
            <span class="c1"># direction of current segment from bpj1 to bpj</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">theta</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">RTOL</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">ATOL</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="c1"># catch case of last segment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: last point ends in a node&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">)</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># this segment ends in the node, so check next segment ...</span>
                <span class="c1"># direction of next segment from bpj to bp[j+1]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">finished</span><span class="p">:</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">resolve_next_face_by_direction</span><span class="p">(</span>
                <span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">index</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">next_face_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_slice_by_node_or_edge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span>
    <span class="p">):</span>
        <span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if we slice at a node ...</span>
            <span class="n">finished</span><span class="p">,</span> <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_node_transition</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># ending at slice point, so ending on an edge ...</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: ending on edge </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="c1"># figure out where we will be heading afterwards ...</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># catch case of last segment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: last point ends on an edge&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">)</span>
                <span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_point</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_coords</span><span class="p">[</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_next_face_on_edge</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">next_point</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">finished</span><span class="p">,</span> <span class="n">next_face_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_bank_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">):</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">index_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_ambiguous_edge_transition</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_src</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">vertex_index</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>

            <span class="k">elif</span> <span class="n">segment</span><span class="o">.</span><span class="n">is_length_zero</span><span class="p">():</span>
                <span class="c1"># segment has zero length</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">segment</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">find_segment_intersections</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">current_face_index</span><span class="p">,</span>
                        <span class="n">segment</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># rest of segment associated with same face</span>
                <span class="n">shape_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span> <span class="o">*</span> <span class="n">SHAPE_MULTIPLIER</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">,</span> <span class="n">shape_length</span><span class="o">=</span><span class="n">shape_length</span>
                <span class="p">)</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">segment</span><span class="o">.</span><span class="n">select_first_intersection</span><span class="p">()</span>

            <span class="c1"># slice location identified ...   (number of edges should be 1)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edge</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span>
            <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">finished</span><span class="p">,</span> <span class="n">face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slice_by_node_or_edge</span><span class="p">(</span>
                <span class="n">segment</span><span class="p">,</span>
                <span class="n">node</span><span class="p">,</span>
                <span class="n">edge</span><span class="p">,</span>
                <span class="n">faces</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">finished</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">status</span> <span class="o">=</span> <span class="n">Status</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s2">&quot;transition_index&quot;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span>
                <span class="s2">&quot;face_index&quot;</span><span class="p">:</span> <span class="n">face_index</span><span class="p">,</span>
                <span class="s2">&quot;prev_b&quot;</span><span class="p">:</span> <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update_index_and_log</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
            <span class="n">segment_x</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span>
                    <span class="o">+</span> <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span>
                    <span class="o">*</span> <span class="p">(</span><span class="n">segment</span><span class="o">.</span><span class="n">current_point</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">previous_point</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">shape_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span> <span class="o">*</span> <span class="n">SHAPE_MULTIPLIER</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">segment_x</span><span class="p">,</span> <span class="n">shape_length</span><span class="o">=</span><span class="n">shape_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">segment</span><span class="o">.</span><span class="n">min_relative_distance</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_ambiguous_edge_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">vindex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve ambiguous edge transitions when a line segment is on the edge of multiple mesh faces.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">index_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vindex</span><span class="p">:</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">edges1</span><span class="p">,</span> <span class="n">nodes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">find_segment_intersections</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">b1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edges</span><span class="p">,</span> <span class="n">edges1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodes1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">index_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">index_src</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">edges1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">segment</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">id_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>
        <span class="n">index_src</span> <span class="o">=</span> <span class="n">index_src</span><span class="p">[</span><span class="n">id_edges</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">index_src</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_next_face_by_direction</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to resolve the next face index based on the direction theta at a node.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: moving in direction theta = </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">find_edges</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the left is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the right is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edges</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: continue along edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: continue between edges </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; on the left and </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2"> on the right&quot;</span>
                <span class="p">)</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">resolve_next_face_from_edges</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">verbose_index</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">next_face_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">determine_next_face_on_edge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">next_point</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the next face to continue along an edge based on the segment direction.&quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
            <span class="n">next_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">next_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: moving in direction theta = </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">theta_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">calculate_edge_angle</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="o">==</span> <span class="n">theta_edge</span> <span class="ow">or</span> <span class="n">theta</span> <span class="o">==</span> <span class="o">-</span><span class="n">theta_edge</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: continue along edge </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">faces</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check whether the (extended) segment slices any edge of faces[0]</span>
            <span class="n">fe1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">reversed_segment</span> <span class="o">=</span> <span class="n">RiverSegment</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="n">previous_point</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">,</span>
                <span class="n">current_point</span><span class="o">=</span><span class="n">next_point</span><span class="p">,</span>
                <span class="n">min_relative_distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">calculate_edge_intersections</span><span class="p">(</span>
                <span class="n">fe1</span><span class="p">,</span>
                <span class="n">reversed_segment</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># yes, a slice (typically 1, but could be 2 if it slices at a node</span>
            <span class="c1"># but that doesn&#39;t matter) ... so, we continue towards faces[0]</span>
            <span class="c1"># if there are no slices for faces[0], we continue towards faces[1]</span>
            <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">next_face_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">intersect_with_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Intersects a coords with an unstructured mesh and returns the intersection coordinates and mesh face indices.</span>

<span class="sd">        This function determines where a given line (e.g., a bank line) intersects the faces of an unstructured mesh.</span>
<span class="sd">        It calculates the intersection points and identifies the mesh faces corresponding to each segment of the line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[np.ndarray, np.ndarray]:</span>
<span class="sd">                A tuple containing:</span>
<span class="sd">                - `coords` (np.ndarray):</span>
<span class="sd">                    A 2D array of shape (M, 2) containing the x, y coordinates of the intersection points.</span>
<span class="sd">                - `idx` (np.ndarray):</span>
<span class="sd">                    A 1D array of shape (M-1,) containing the indices of the mesh faces corresponding to each segment</span>
<span class="sd">                    of the intersected line.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception:</span>
<span class="sd">                If the line starts outside the mesh and cannot be associated with any mesh face, or if the line crosses</span>
<span class="sd">                ambiguous regions (e.g., edges shared by multiple faces).</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The function uses Shapely geometry operations to determine whether points are inside polygons or on edges.</span>
<span class="sd">            - The function handles cases where the line starts outside the mesh, crosses multiple edges, or ends on a node.</span>
<span class="sd">            - Tiny segments shorter than `d_thresh` are removed from the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_target_object</span><span class="p">(</span><span class="n">given_coords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">point_index</span><span class="p">,</span> <span class="n">current_bank_point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">given_coords</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Current location: </span><span class="si">{</span><span class="n">current_bank_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">current_bank_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">point_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_first_point</span><span class="p">(</span><span class="n">current_bank_point</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="n">RiverSegment</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">point_index</span><span class="p">,</span>
                    <span class="n">min_relative_distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">current_point</span><span class="o">=</span><span class="n">current_bank_point</span><span class="p">,</span>
                    <span class="n">previous_point</span><span class="o">=</span><span class="n">given_coords</span><span class="p">[</span><span class="n">point_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_bank_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>

        <span class="c1"># clip to actual length (idx refers to segments, so we can ignore the last value)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># remove tiny segments</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">),</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_thresh</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

        <span class="c1"># since index refers to segments, don&#39;t return the first one</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.MeshWrapper.determine_next_face_on_edge" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.determine_next_face_on_edge" class="toclink">
            <code class="highlight language-python"><span class="n">determine_next_face_on_edge</span><span class="p">(</span><span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">next_point</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.determine_next_face_on_edge" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Determine the next face to continue along an edge based on the segment direction.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">determine_next_face_on_edge</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">:</span> <span class="n">RiverSegment</span><span class="p">,</span> <span class="n">next_point</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">edge</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the next face to continue along an edge based on the segment direction.&quot;&quot;&quot;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
        <span class="n">next_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">next_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: moving in direction theta = </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">theta_edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">calculate_edge_angle</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">theta</span> <span class="o">==</span> <span class="n">theta_edge</span> <span class="ow">or</span> <span class="n">theta</span> <span class="o">==</span> <span class="o">-</span><span class="n">theta_edge</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">: continue along edge </span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">faces</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check whether the (extended) segment slices any edge of faces[0]</span>
        <span class="n">fe1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">reversed_segment</span> <span class="o">=</span> <span class="n">RiverSegment</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">previous_point</span><span class="o">=</span><span class="n">segment</span><span class="o">.</span><span class="n">current_point</span><span class="p">,</span>
            <span class="n">current_point</span><span class="o">=</span><span class="n">next_point</span><span class="p">,</span>
            <span class="n">min_relative_distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">calculate_edge_intersections</span><span class="p">(</span>
            <span class="n">fe1</span><span class="p">,</span>
            <span class="n">reversed_segment</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># yes, a slice (typically 1, but could be 2 if it slices at a node</span>
        <span class="c1"># but that doesn&#39;t matter) ... so, we continue towards faces[0]</span>
        <span class="c1"># if there are no slices for faces[0], we continue towards faces[1]</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">next_face_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.MeshWrapper.intersect_with_coords" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.intersect_with_coords" class="toclink">
            <code class="highlight language-python"><span class="n">intersect_with_coords</span><span class="p">(</span><span class="n">given_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.intersect_with_coords" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Intersects a coords with an unstructured mesh and returns the intersection coordinates and mesh face indices.</p>
<p>This function determines where a given line (e.g., a bank line) intersects the faces of an unstructured mesh.
It calculates the intersection points and identifies the mesh faces corresponding to each segment of the line.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray]:
A tuple containing:
- <code>coords</code> (np.ndarray):
    A 2D array of shape (M, 2) containing the x, y coordinates of the intersection points.
- <code>idx</code> (np.ndarray):
    A 1D array of shape (M-1,) containing the indices of the mesh faces corresponding to each segment
    of the intersected line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the line starts outside the mesh and cannot be associated with any mesh face, or if the line crosses
ambiguous regions (e.g., edges shared by multiple faces).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function uses Shapely geometry operations to determine whether points are inside polygons or on edges.</li>
<li>The function handles cases where the line starts outside the mesh, crosses multiple edges, or ends on a node.</li>
<li>Tiny segments shorter than <code>d_thresh</code> are removed from the output.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">intersect_with_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Intersects a coords with an unstructured mesh and returns the intersection coordinates and mesh face indices.</span>

<span class="sd">    This function determines where a given line (e.g., a bank line) intersects the faces of an unstructured mesh.</span>
<span class="sd">    It calculates the intersection points and identifies the mesh faces corresponding to each segment of the line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - `coords` (np.ndarray):</span>
<span class="sd">                A 2D array of shape (M, 2) containing the x, y coordinates of the intersection points.</span>
<span class="sd">            - `idx` (np.ndarray):</span>
<span class="sd">                A 1D array of shape (M-1,) containing the indices of the mesh faces corresponding to each segment</span>
<span class="sd">                of the intersected line.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception:</span>
<span class="sd">            If the line starts outside the mesh and cannot be associated with any mesh face, or if the line crosses</span>
<span class="sd">            ambiguous regions (e.g., edges shared by multiple faces).</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function uses Shapely geometry operations to determine whether points are inside polygons or on edges.</span>
<span class="sd">        - The function handles cases where the line starts outside the mesh, crosses multiple edges, or ends on a node.</span>
<span class="sd">        - Tiny segments shorter than `d_thresh` are removed from the output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_read_target_object</span><span class="p">(</span><span class="n">given_coords</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">point_index</span><span class="p">,</span> <span class="n">current_bank_point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">given_coords</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Current location: </span><span class="si">{</span><span class="n">current_bank_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">current_bank_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">point_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_first_point</span><span class="p">(</span><span class="n">current_bank_point</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segment</span> <span class="o">=</span> <span class="n">RiverSegment</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">point_index</span><span class="p">,</span>
                <span class="n">min_relative_distance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">current_point</span><span class="o">=</span><span class="n">current_bank_point</span><span class="p">,</span>
                <span class="n">previous_point</span><span class="o">=</span><span class="n">given_coords</span><span class="p">[</span><span class="n">point_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process_bank_segment</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>

    <span class="c1"># clip to actual length (idx refers to segments, so we can ignore the last value)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">point_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># remove tiny segments</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;bool&quot;</span><span class="p">),</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_thresh</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span><span class="p">[</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

    <span class="c1"># since index refers to segments, don&#39;t return the first one</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection_state</span><span class="o">.</span><span class="n">face_indexes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.mesh.processor.MeshWrapper.resolve_next_face_by_direction" class="doc doc-heading"><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.resolve_next_face_by_direction" class="toclink">
            <code class="highlight language-python"><span class="n">resolve_next_face_by_direction</span><span class="p">(</span><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.mesh.processor.MeshWrapper.resolve_next_face_by_direction" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Helper to resolve the next face index based on the direction theta at a node.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/mesh/processor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_next_face_by_direction</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper to resolve the next face index based on the direction theta at a node.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: moving in direction theta = </span><span class="si">{</span><span class="n">theta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">find_edges</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">verbose_index</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the left is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: the edge to the right is edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">edges</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: continue along edge </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">edge_face_connectivity</span><span class="p">[</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verbose_index</span><span class="si">}</span><span class="s2">: continue between edges </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; on the left and </span><span class="si">{</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2"> on the right&quot;</span>
            <span class="p">)</span>
        <span class="n">next_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_data</span><span class="o">.</span><span class="n">resolve_next_face_from_edges</span><span class="p">(</span>
            <span class="n">node</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">verbose_index</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">next_face_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><p>For more details, see <a href="mesh_processor.html">Bank Erosion Mesh Processor</a>.</p>
<h3 id="debugging-utilities"><a class="toclink" href="#debugging-utilities">Debugging Utilities</a><a class="headerlink" href="#debugging-utilities" title="Permanent link">#</a></h3>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.debugger" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger" class="toclink">
            <code>dfastbe.bank_erosion.debugger</code>


</a><a href="#dfastbe.bank_erosion.debugger" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>Bank Erosion Debugger.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.debugger.Debugger" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger" class="toclink">
            <code>Debugger</code>


</a><a href="#dfastbe.bank_erosion.debugger.Debugger" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to handle debugging and output of bank erosion calculations.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Debugger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle debugging and output of bank erosion calculations.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Debugger constructor.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">last_discharge_level</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
        <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the last discharge level to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
            <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
            <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
            <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
            <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
            <span class="s2">&quot;bank_fairway_dist&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
            <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_eq</span><span class="p">,</span>
            <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_eq</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.EQ.B</span><span class="si">{</span><span class="n">bank_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">middle_levels</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
        <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
        <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
        <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the middle levels to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
            <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">bank_velocity</span><span class="p">,</span>
            <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
            <span class="s2">&quot;zw&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_level</span><span class="p">,</span>
            <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
            <span class="s2">&quot;tauc&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span>
            <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">num_ship</span><span class="p">,</span>
            <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
            <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">num_waves_per_ship</span><span class="p">,</span>
            <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
            <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
            <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
            <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_reed</span><span class="p">,</span>
            <span class="s2">&quot;dist_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
            <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
            <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
            <span class="s2">&quot;chez&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">chezy</span><span class="p">,</span>
            <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_tot</span><span class="p">,</span>
            <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_shipping</span><span class="p">,</span>
            <span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_flow</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.Q</span><span class="si">{</span><span class="n">q_level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.B</span><span class="si">{</span><span class="n">bank_ind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_write_data</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="n">GeoSeries</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the data to a shapefile and CSV file.&quot;&quot;&quot;</span>
        <span class="n">csv_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.csv&quot;</span>
        <span class="n">shp_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">.shp&quot;</span>
        <span class="n">_write_shp</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">shp_path</span><span class="p">)</span>
        <span class="n">_write_csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">csv_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.__init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="toclink">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.__init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Debugger constructor.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debugger constructor.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">crs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="toclink">
            <code class="highlight language-python"><span class="n">last_discharge_level</span><span class="p">(</span><span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span> <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.last_discharge_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Write the last discharge level to a shapefile and CSV file.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">last_discharge_level</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
    <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
    <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the last discharge level to a shapefile and CSV file.&quot;&quot;&quot;</span>
    <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
        <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_index</span><span class="p">],</span>
        <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
        <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
        <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
        <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
        <span class="s2">&quot;bank_fairway_dist&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
        <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
        <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_eq</span><span class="p">,</span>
        <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_eq</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.EQ.B</span><span class="si">{</span><span class="n">bank_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="doc doc-heading"><a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="toclink">
            <code class="highlight language-python"><span class="n">middle_levels</span><span class="p">(</span><span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span> <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span> <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span> <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span> <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">)</span></code>

</a><a href="#dfastbe.bank_erosion.debugger.Debugger.middle_levels" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Write the middle levels to a shapefile and CSV file.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/debugger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">middle_levels</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bank_ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">q_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span>
    <span class="n">fairway_data</span><span class="p">:</span> <span class="n">FairwayData</span><span class="p">,</span>
    <span class="n">erosion_inputs</span><span class="p">:</span> <span class="n">SingleErosion</span><span class="p">,</span>
    <span class="n">single_parameters</span><span class="p">:</span> <span class="n">SingleParameters</span><span class="p">,</span>
    <span class="n">single_calculation</span><span class="p">:</span> <span class="n">SingleCalculation</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write the middle levels to a shapefile and CSV file.&quot;&quot;&quot;</span>
    <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chainage&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">bank_coords_mind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;iface_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;iface_bank&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span><span class="p">,</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">bank_velocity</span><span class="p">,</span>
        <span class="s2">&quot;bank_height&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
        <span class="s2">&quot;segment_length&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span><span class="p">,</span>
        <span class="s2">&quot;zw&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_level</span><span class="p">,</span>
        <span class="s2">&quot;zw0&quot;</span><span class="p">:</span> <span class="n">fairway_data</span><span class="o">.</span><span class="n">fairway_initial_water_levels</span><span class="p">[</span><span class="n">bank_ind</span><span class="p">],</span>
        <span class="s2">&quot;tauc&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span>
        <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">num_ship</span><span class="p">,</span>
        <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_velocity</span><span class="p">,</span>
        <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">num_waves_per_ship</span><span class="p">,</span>
        <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_type</span><span class="p">,</span>
        <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">ship_draught</span><span class="p">,</span>
        <span class="s2">&quot;mu_slp&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_slope</span><span class="p">,</span>
        <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">single_parameters</span><span class="o">.</span><span class="n">mu_reed</span><span class="p">,</span>
        <span class="s2">&quot;dist_fw&quot;</span><span class="p">:</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">fairway_distances</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_reduction_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_0</span><span class="p">,</span>
        <span class="s2">&quot;fairway_wave_disappear_distance&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">wave_fairway_distance_1</span><span class="p">,</span>
        <span class="s2">&quot;water_depth_fairway&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">water_depth</span><span class="p">,</span>
        <span class="s2">&quot;chez&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">chezy</span><span class="p">,</span>
        <span class="s2">&quot;dike_height&quot;</span><span class="p">:</span> <span class="n">erosion_inputs</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_tot</span><span class="p">,</span>
        <span class="s2">&quot;erosion_volume&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance_shipping&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_shipping</span><span class="p">,</span>
        <span class="s2">&quot;erosion_distance_flow&quot;</span><span class="p">:</span> <span class="n">single_calculation</span><span class="o">.</span><span class="n">erosion_distance_flow</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">/debug.Q</span><span class="si">{</span><span class="n">q_level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.B</span><span class="si">{</span><span class="n">bank_ind</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">bank_coords_geo</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">bank_coords_geo</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><p>For more details, see <a href="debugger.html">Bank Erosion Debugger</a>.</p>
<h3 id="data-models"><a class="toclink" href="#data-models">Data Models</a><a class="headerlink" href="#data-models" title="Permanent link">#</a></h3>
<p>The Bank Erosion module uses several data models to represent inputs, calculation parameters, and results:</p>
<h4 id="calculation-data-models"><a class="toclink" href="#calculation-data-models">Calculation Data Models</a><a class="headerlink" href="#calculation-data-models" title="Permanent link">#</a></h4>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.data_models.calculation" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation" class="toclink">
            <code>dfastbe.bank_erosion.data_models.calculation</code>


</a><a href="#dfastbe.bank_erosion.data_models.calculation" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">

        <p>Erosion-related data structures.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.BankData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData" class="toclink">
            <code>BankData</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseBank (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.BaseBank&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.BaseBank">BaseBank</a>[<a class="autorefs autorefs-internal" title="SingleBank (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.SingleBank&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.SingleBank">SingleBank</a>]</code></p>


        <p>Class to hold bank-related data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>is_right_bank</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List indicating if the bank is right or not.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_chainage_midpoints</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>River chainage for the midpoints of each segment of the bank line</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_line_coords</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinates of the bank lines.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_face_indices</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices of the faces associated with the banks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_lines</code>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>GeoDataFrame containing the bank lines.</p>
              </div>
            </td>
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bank_lines</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bank lines.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_line_size</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of each individual bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fairway_distances</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance of each bank line point to the closest fairway point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fairway_face_indices</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The face index of the closest fairway point for each bank line point.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BankData</span><span class="p">(</span><span class="n">BaseBank</span><span class="p">[</span><span class="n">SingleBank</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold bank-related data.</span>

<span class="sd">    args:</span>
<span class="sd">        is_right_bank (List[bool]):</span>
<span class="sd">            List indicating if the bank is right or not.</span>
<span class="sd">        bank_chainage_midpoints (List[np.ndarray]):</span>
<span class="sd">            River chainage for the midpoints of each segment of the bank line</span>
<span class="sd">        bank_line_coords (List[np.ndarray]):</span>
<span class="sd">            Coordinates of the bank lines.</span>
<span class="sd">        bank_face_indices (List[np.ndarray]):</span>
<span class="sd">            Indices of the faces associated with the banks.</span>
<span class="sd">        bank_lines (GeoDataFrame):</span>
<span class="sd">            GeoDataFrame containing the bank lines.</span>
<span class="sd">        n_bank_lines (int):</span>
<span class="sd">            Number of bank lines.</span>
<span class="sd">        bank_line_size (List[np.ndarray]):</span>
<span class="sd">            Size of each individual bank line.</span>
<span class="sd">        fairway_distances (List[np.ndarray]):</span>
<span class="sd">            The distance of each bank line point to the closest fairway point.</span>
<span class="sd">        fairway_face_indices (List[np.ndarray]):</span>
<span class="sd">            The face index of the closest fairway point for each bank line point.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bank_lines</span><span class="p">:</span> <span class="n">GeoDataFrame</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">GeoDataFrame</span><span class="p">)</span>
    <span class="n">n_bank_lines</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_column_arrays</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">bank_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;SingleBank&quot;</span><span class="p">],</span>
        <span class="n">bank_lines</span><span class="p">:</span> <span class="n">GeoDataFrame</span><span class="p">,</span>
        <span class="n">n_bank_lines</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">bank_order</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BankData&quot;</span><span class="p">:</span>
        <span class="c1"># Only include fields that belong to the bank-specific data</span>
        <span class="n">base_fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span><span class="p">}</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">BaseBank</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">base_fields</span><span class="p">},</span> <span class="n">bank_cls</span><span class="p">,</span> <span class="n">bank_order</span><span class="o">=</span><span class="n">bank_order</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
            <span class="n">bank_lines</span><span class="o">=</span><span class="n">bank_lines</span><span class="p">,</span>
            <span class="n">n_bank_lines</span><span class="o">=</span><span class="n">n_bank_lines</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bank_line_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the coordinates of the bank lines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_right_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bank direction.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">is_right_bank</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bank_chainage_midpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the chainage midpoints of the bank lines.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_stations_per_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of stations per bank.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">length</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bank height.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.BankData.bank_chainage_midpoints" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_chainage_midpoints" class="toclink">
            <code class="highlight language-python"><span class="n">bank_chainage_midpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_chainage_midpoints" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the chainage midpoints of the bank lines.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.BankData.bank_line_coords" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_line_coords" class="toclink">
            <code class="highlight language-python"><span class="n">bank_line_coords</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.bank_line_coords" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the coordinates of the bank lines.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.BankData.height" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.height" class="toclink">
            <code class="highlight language-python"><span class="n">height</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.height" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the bank height.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.BankData.is_right_bank" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.is_right_bank" class="toclink">
            <code class="highlight language-python"><span class="n">is_right_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.is_right_bank" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the bank direction.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.BankData.num_stations_per_bank" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.num_stations_per_bank" class="toclink">
            <code class="highlight language-python"><span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BankData.num_stations_per_bank" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the number of stations per bank.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.BaseBank" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank" class="toclink">
            <code>BaseBank</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="dfastbe.bank_erosion.data_models.calculation.GenericType">GenericType</span>]</code></p>







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseBank</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">GenericType</span><span class="p">]):</span>
    <span class="n">left</span><span class="p">:</span> <span class="n">GenericType</span>
    <span class="n">right</span><span class="p">:</span> <span class="n">GenericType</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenericType</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bank_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
        <span class="k">elif</span> <span class="n">bank_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bank_index must be 0 (left) or 1 (right)&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_column_arrays</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BaseBank[GenericType]&quot;</span><span class="p">],</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">bank_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">GenericType</span><span class="p">],</span>
        <span class="n">bank_order</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BaseBank[GenericType]&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">bank_order</span><span class="p">)</span> <span class="o">!=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bank_order must be a permutation of (&#39;left&#39;, &#39;right&#39;)&quot;</span><span class="p">)</span>

        <span class="n">id_val</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="c1"># Extract the first and second array for each parameter (excluding id)</span>
        <span class="n">first_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">second_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 2-column array for key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;, got shape </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">split</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bank_order</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
            <span class="n">first_args</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">second_args</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span>

        <span class="n">left</span> <span class="o">=</span> <span class="n">bank_cls</span><span class="p">(</span><span class="o">**</span><span class="n">first_args</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">bank_cls</span><span class="p">(</span><span class="o">**</span><span class="n">second_args</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">id_val</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">GenericType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over the banks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.calculation.BaseBank.__iter__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank.__iter__" class="toclink">
            <code class="highlight language-python"><span class="fm">__iter__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">GenericType</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.BaseBank.__iter__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Iterate over the banks.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">GenericType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Iterate over the banks.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.DischargeLevels" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels" class="toclink">
            <code>DischargeLevels</code>


</a><a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DischargeLevels</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SingleDischargeLevel</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleDischargeLevel</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level_calc</span><span class="p">:</span> <span class="n">SingleDischargeLevel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level_calc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_max_hfw_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">hfw_max</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">total_erosion_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">level</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">erosion_volume_tot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bank_side</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">bank_side</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bank_side</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bank_side</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bank_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">bank_side</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">bank_side</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bank_side must be &#39;left&#39;, &#39;right&#39;, or a list of these.&quot;</span><span class="p">)</span>

        <span class="n">total</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_accumulate_attribute_side</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">bank_side</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">total</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_accumulate_attribute_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bank_side</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">):</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">bank_side</span><span class="p">)</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">bank</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attribute_name</span><span class="si">}</span><span class="s2"> not found in </span><span class="si">{</span><span class="n">bank_side</span><span class="si">}</span><span class="s2"> bank of level with id=</span><span class="si">{</span><span class="n">level</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">attr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">attr</span>
        <span class="k">return</span> <span class="n">total</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_attr_both_sides_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the attributes of the levels for both left and right bank.&quot;&quot;&quot;</span>
        <span class="n">sides</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">side</span><span class="p">)</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]]</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">side</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">side</span> <span class="ow">in</span> <span class="n">sides</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">attr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_attr_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the attributes of the levels for both left and right bank.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">))]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_water_level_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WaterLevelData</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">WaterLevelData</span><span class="p">(</span>
            <span class="n">hfw_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hfw_max</span><span class="p">,</span>
            <span class="n">water_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;water_level&quot;</span><span class="p">),</span>
            <span class="n">ship_wave_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;ship_wave_max&quot;</span><span class="p">),</span>
            <span class="n">ship_wave_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;ship_wave_min&quot;</span><span class="p">),</span>
            <span class="n">velocity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;bank_velocity&quot;</span><span class="p">),</span>
            <span class="n">chezy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;chezy&quot;</span><span class="p">),</span>
            <span class="n">vol_per_discharge</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_attr_level</span><span class="p">(</span><span class="s2">&quot;volume_per_discharge&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.calculation.DischargeLevels.get_attr_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels.get_attr_level" class="toclink">
            <code class="highlight language-python"><span class="n">get_attr_level</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.DischargeLevels.get_attr_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the attributes of the levels for both left and right bank.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_attr_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the attributes of the levels for both left and right bank.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_attr_both_sides_level</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">))]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.ErosionInputs" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs" class="toclink">
            <code>ErosionInputs</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseBank (&lt;code&gt;dfastbe.bank_erosion.data_models.calculation.BaseBank&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.calculation.BaseBank">BaseBank</a>[<span title="dfastbe.bank_erosion.data_models.calculation.SingleErosion">SingleErosion</span>]</code></p>


        <p>Class to hold erosion inputs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>shipping_data</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data on all the vessels that travel through the river.</p>
              </div>
            </td>
            <td>
                  <code><span title="dict">dict</span>()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wave_fairway_distance_0</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold fairway distance 0 for wave attenuation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wave_fairway_distance_1</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold fairway distance 1 for wave attenuation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_protection_level</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bank protection level.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tauc</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Critical bank shear stress values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_type</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer representation of the bank type. Represents an index into the taucls_str array.</p>
              </div>
            </td>
            <td>
                  <code>(lambda: <span title="numpy.array">array</span>([]))()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taucls</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Critical bank shear stress values for different bank types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>taucls_str</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representation for different bank types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ErosionInputs</span><span class="p">(</span><span class="n">BaseBank</span><span class="p">[</span><span class="n">SingleErosion</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold erosion inputs.</span>

<span class="sd">    args:</span>
<span class="sd">        shipping_data (Dict[str, np.ndarray]):</span>
<span class="sd">            Data on all the vessels that travel through the river.</span>
<span class="sd">        wave_fairway_distance_0 (List[np.ndarray]):</span>
<span class="sd">            Threshold fairway distance 0 for wave attenuation.</span>
<span class="sd">        wave_fairway_distance_1 (List[np.ndarray]):</span>
<span class="sd">            Threshold fairway distance 1 for wave attenuation.</span>
<span class="sd">        bank_protection_level (List[np.ndarray]):</span>
<span class="sd">            Bank protection level.</span>
<span class="sd">        tauc (List[np.ndarray]):</span>
<span class="sd">            Critical bank shear stress values.</span>
<span class="sd">        bank_type (List[np.ndarray]):</span>
<span class="sd">            Integer representation of the bank type. Represents an index into the taucls_str array.</span>
<span class="sd">        taucls (np.ndarray):</span>
<span class="sd">            Critical bank shear stress values for different bank types.</span>
<span class="sd">        taucls_str (Tuple[str]):</span>
<span class="sd">            String representation for different bank types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shipping_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">bank_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">taucls</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e20</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>
    <span class="n">taucls_str</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;protected&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vegetation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;good clay&quot;</span><span class="p">,</span>
        <span class="s2">&quot;moderate/bad clay&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sand&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_column_arrays</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">bank_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;SingleErosion&quot;</span><span class="p">],</span> <span class="n">shipping_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
        <span class="n">bank_type</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">bank_order</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ErosionInputs&quot;</span><span class="p">:</span>
        <span class="c1"># Only include fields that belong to the bank-specific data</span>
        <span class="n">base_fields</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;id&quot;</span><span class="p">}</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">BaseBank</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="o">**</span><span class="n">base_fields</span><span class="p">},</span> <span class="n">bank_cls</span><span class="p">,</span> <span class="n">bank_order</span><span class="o">=</span><span class="n">bank_order</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">left</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
            <span class="n">shipping_data</span><span class="o">=</span><span class="n">shipping_data</span><span class="p">,</span>
            <span class="n">bank_type</span><span class="o">=</span><span class="n">bank_type</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bank_protection_level</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the bank protection level.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">bank_protection_level</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tauc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the critical bank shear stress values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">tauc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">tauc</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.ErosionInputs.bank_protection_level" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.bank_protection_level" class="toclink">
            <code class="highlight language-python"><span class="n">bank_protection_level</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.bank_protection_level" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the bank protection level.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="dfastbe.bank_erosion.data_models.calculation.ErosionInputs.tauc" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.tauc" class="toclink">
            <code class="highlight language-python"><span class="n">tauc</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionInputs.tauc" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get the critical bank shear stress values.</p>
    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.ErosionResults" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionResults" class="toclink">
            <code>ErosionResults</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.ErosionResults" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to hold erosion results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>eq_erosion_dist</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Erosion distance at equilibrium for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_erosion_dist</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total erosion distance for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flow_erosion_dist</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total erosion distance caused by flow for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_erosion_dist</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total erosion distance caused by ship waves for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eq_eroded_vol</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eroded volume at equilibrium for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_eroded_vol</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total eroded volume for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>erosion_time</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time over which erosion is calculated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>avg_erosion_rate</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average erosion rate data.</p>
              </div>
            </td>
            <td>
                  <code>(lambda: <span title="numpy.empty">empty</span>(0))()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eq_eroded_vol_per_km</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Equilibrium eroded volume calculated per kilometer bin.</p>
              </div>
            </td>
            <td>
                  <code>(lambda: <span title="numpy.empty">empty</span>(0))()</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_eroded_vol_per_km</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total eroded volume calculated per kilometer bin.</p>
              </div>
            </td>
            <td>
                  <code>(lambda: <span title="numpy.empty">empty</span>(0))()</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <ul>
<li>
<p>You can create an instance of the ErosionResults class as follows:
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.data_models.calculation</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErosionResults</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="n">ErosionResults</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">eq_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">total_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">total_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">erosion_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">avg_erosion_rate</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>
<span class="o">...</span>     <span class="n">eq_eroded_vol_per_km</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]),</span>
<span class="o">...</span>     <span class="n">total_eroded_vol_per_km</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]),</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">erosion_results</span><span class="p">)</span>
<span class="n">ErosionResults</span><span class="p">(</span><span class="n">eq_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])],</span> <span class="n">total_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])],</span> <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])],</span> <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])],</span> <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])],</span> <span class="n">total_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])],</span> <span class="n">erosion_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">avg_erosion_rate</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span> <span class="n">eq_eroded_vol_per_km</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]),</span> <span class="n">total_eroded_vol_per_km</span><span class="o">=</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]))</span>
</code></pre></div></p>
</li>
<li>
<p>The <code>avg_erosion_rate</code>, <code>eq_eroded_vol_per_km</code>, and <code>total_eroded_vol_per_km</code> attributes are optional and
can be set to empty arrays if not needed.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.data_models.calculation</span><span class="w"> </span><span class="kn">import</span> <span class="n">ErosionResults</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">erosion_results</span> <span class="o">=</span> <span class="n">ErosionResults</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">eq_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">total_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">total_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])],</span>
<span class="o">...</span>     <span class="n">erosion_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="o">...</span> <span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">erosion_results</span><span class="p">)</span>
<span class="n">ErosionResults</span><span class="p">(</span><span class="n">eq_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])],</span> <span class="n">total_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])],</span> <span class="n">flow_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])],</span> <span class="n">ship_erosion_dist</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])],</span> <span class="n">eq_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">])],</span> <span class="n">total_eroded_vol</span><span class="o">=</span><span class="p">[</span><span class="n">array</span><span class="p">([</span><span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">])],</span> <span class="n">erosion_time</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">avg_erosion_rate</span><span class="o">=</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">),</span> <span class="n">eq_eroded_vol_per_km</span><span class="o">=</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">),</span> <span class="n">total_eroded_vol_per_km</span><span class="o">=</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float64</span><span class="p">))</span>
</code></pre></div>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ErosionResults</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold erosion results.</span>

<span class="sd">    args:</span>
<span class="sd">        eq_erosion_dist (List[np.ndarray]):</span>
<span class="sd">            Erosion distance at equilibrium for each bank line.</span>
<span class="sd">        total_erosion_dist (List[np.ndarray]):</span>
<span class="sd">            Total erosion distance for each bank line.</span>
<span class="sd">        flow_erosion_dist (List[np.ndarray]):</span>
<span class="sd">            Total erosion distance caused by flow for each bank line.</span>
<span class="sd">        ship_erosion_dist (List[np.ndarray]):</span>
<span class="sd">            Total erosion distance caused by ship waves for each bank line.</span>
<span class="sd">        eq_eroded_vol (List[np.ndarray]):</span>
<span class="sd">            Eroded volume at equilibrium for each bank line.</span>
<span class="sd">        total_eroded_vol (List[np.ndarray]):</span>
<span class="sd">            Total eroded volume for each bank line.</span>
<span class="sd">        erosion_time (int):</span>
<span class="sd">            Time over which erosion is calculated.</span>
<span class="sd">        avg_erosion_rate (np.ndarray):</span>
<span class="sd">            Average erosion rate data.</span>
<span class="sd">        eq_eroded_vol_per_km (np.ndarray):</span>
<span class="sd">            Equilibrium eroded volume calculated per kilometer bin.</span>
<span class="sd">        total_eroded_vol_per_km (np.ndarray):</span>
<span class="sd">            Total eroded volume calculated per kilometer bin.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - You can create an instance of the ErosionResults class as follows:</span>
<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; from dfastbe.bank_erosion.data_models.calculation import ErosionResults</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; erosion_results = ErosionResults(</span>
<span class="sd">        ...     eq_erosion_dist=[np.array([0.1, 0.2])],</span>
<span class="sd">        ...     total_erosion_dist=[np.array([0.3, 0.4])],</span>
<span class="sd">        ...     flow_erosion_dist=[np.array([0.5, 0.6])],</span>
<span class="sd">        ...     ship_erosion_dist=[np.array([0.7, 0.8])],</span>
<span class="sd">        ...     eq_eroded_vol=[np.array([1.1, 1.2])],</span>
<span class="sd">        ...     total_eroded_vol=[np.array([1.3, 1.4])],</span>
<span class="sd">        ...     erosion_time=10,</span>
<span class="sd">        ...     avg_erosion_rate=np.array([0.1, 0.2]),</span>
<span class="sd">        ...     eq_eroded_vol_per_km=np.array([0.3, 0.4]),</span>
<span class="sd">        ...     total_eroded_vol_per_km=np.array([0.5, 0.6]),</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(erosion_results)</span>
<span class="sd">        ErosionResults(eq_erosion_dist=[array([0.1, 0.2])], total_erosion_dist=[array([0.3, 0.4])], flow_erosion_dist=[array([0.5, 0.6])], ship_erosion_dist=[array([0.7, 0.8])], eq_eroded_vol=[array([1.1, 1.2])], total_eroded_vol=[array([1.3, 1.4])], erosion_time=10, avg_erosion_rate=array([0.1, 0.2]), eq_eroded_vol_per_km=array([0.3, 0.4]), total_eroded_vol_per_km=array([0.5, 0.6]))</span>

<span class="sd">        ```</span>

<span class="sd">        - The `avg_erosion_rate`, `eq_eroded_vol_per_km`, and `total_eroded_vol_per_km` attributes are optional and</span>
<span class="sd">        can be set to empty arrays if not needed.</span>

<span class="sd">        ```python</span>
<span class="sd">        &gt;&gt;&gt; from dfastbe.bank_erosion.data_models.calculation import ErosionResults</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; erosion_results = ErosionResults(</span>
<span class="sd">        ...     eq_erosion_dist=[np.array([0.1, 0.2])],</span>
<span class="sd">        ...     total_erosion_dist=[np.array([0.3, 0.4])],</span>
<span class="sd">        ...     flow_erosion_dist=[np.array([0.5, 0.6])],</span>
<span class="sd">        ...     ship_erosion_dist=[np.array([0.7, 0.8])],</span>
<span class="sd">        ...     eq_eroded_vol=[np.array([1.1, 1.2])],</span>
<span class="sd">        ...     total_eroded_vol=[np.array([1.3, 1.4])],</span>
<span class="sd">        ...     erosion_time=10,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(erosion_results)</span>
<span class="sd">        ErosionResults(eq_erosion_dist=[array([0.1, 0.2])], total_erosion_dist=[array([0.3, 0.4])], flow_erosion_dist=[array([0.5, 0.6])], ship_erosion_dist=[array([0.7, 0.8])], eq_eroded_vol=[array([1.1, 1.2])], total_eroded_vol=[array([1.3, 1.4])], erosion_time=10, avg_erosion_rate=array([], dtype=float64), eq_eroded_vol_per_km=array([], dtype=float64), total_eroded_vol_per_km=array([], dtype=float64))</span>

<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">eq_erosion_dist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">total_erosion_dist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">flow_erosion_dist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">ship_erosion_dist</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">eq_eroded_vol</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">total_eroded_vol</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">erosion_time</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">avg_erosion_rate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">eq_eroded_vol_per_km</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">total_eroded_vol_per_km</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.FairwayData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.FairwayData" class="toclink">
            <code>FairwayData</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.FairwayData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to hold fairway-related data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fairway_face_indices</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh face indices matching to the fairway points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>intersection_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x, y coordinates of the intersection points of the fairway with the simulation mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fairway_initial_water_levels</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference water level at the fairway</p>
              </div>
            </td>
            <td>
                  <code><span title="list">list</span>()</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FairwayData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold fairway-related data.</span>

<span class="sd">    args:</span>
<span class="sd">        fairway_face_indices (np.ndarray):</span>
<span class="sd">            Mesh face indices matching to the fairway points.</span>
<span class="sd">        intersection_coords (np.ndarray):</span>
<span class="sd">            The x, y coordinates of the intersection points of the fairway with the simulation mesh.</span>
<span class="sd">        fairway_initial_water_levels (List[np.ndarray]):</span>
<span class="sd">            Reference water level at the fairway</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fairway_face_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">intersection_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">fairway_initial_water_levels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.SingleBank" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank" class="toclink">
            <code>SingleBank</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SingleBank</span><span class="p">:</span>
    <span class="n">is_right_bank</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">bank_line_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">bank_face_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">bank_line_size</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">fairway_distances</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">fairway_face_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>
    <span class="n">bank_chainage_midpoints</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>

    <span class="n">segment_length</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dy</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># bank height is calculated at the first discharge level only.</span>
    <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post-initialization to ensure bank_line_coords is a list of numpy arrays.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_length</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_segment_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the length of each segment in the bank line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[np.ndarray]: Length of each segment in the bank line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_dx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the distance between each bank line point.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[np.ndarray]: Distance to the closest fairway point for each bank line point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_dy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the distance between each bank line point.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[np.ndarray]: Distance to the closest fairway point for each bank line point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_line_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mid_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_geo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoSeries</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Band line midpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            as_geo_series (bool):</span>
<span class="sd">                bool indicating if the output should be a GeoSeries or not.</span>
<span class="sd">            crs (str):</span>
<span class="sd">                coordinate reference system.</span>
<span class="sd">        Returns:</span>
<span class="sd">            the midpoints of the bank line coordinates as a GeoSeries or numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bank_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank_line_coords</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">as_geo_series</span><span class="p">:</span>
            <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">bank_coords_mind</span><span class="p">]</span>
            <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bank_coords_mind</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bank_coords_mind</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.calculation.SingleBank.__post_init__" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.__post_init__" class="toclink">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.__post_init__" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Post-initialization to ensure bank_line_coords is a list of numpy arrays.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-initialization to ensure bank_line_coords is a list of numpy arrays.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">segment_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segment_length</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dx</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.calculation.SingleBank.get_mid_points" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.get_mid_points" class="toclink">
            <code class="highlight language-python"><span class="n">get_mid_points</span><span class="p">(</span><span class="n">as_geo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoSeries</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.SingleBank.get_mid_points" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Band line midpoints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>as_geo_series</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool indicating if the output should be a GeoSeries or not.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crs</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>coordinate reference system.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    the midpoints of the bank line coordinates as a GeoSeries or numpy array.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mid_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_geo_series</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">GeoSeries</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Band line midpoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        as_geo_series (bool):</span>
<span class="sd">            bool indicating if the output should be a GeoSeries or not.</span>
<span class="sd">        crs (str):</span>
<span class="sd">            coordinate reference system.</span>
<span class="sd">    Returns:</span>
<span class="sd">        the midpoints of the bank line coordinates as a GeoSeries or numpy array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bank_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank_line_coords</span>
    <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="p">(</span><span class="n">bank_coords</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bank_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">as_geo_series</span><span class="p">:</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">bank_coords_mind</span><span class="p">]</span>
        <span class="n">bank_coords_mind</span> <span class="o">=</span> <span class="n">GeoSeries</span><span class="p">(</span><span class="n">bank_coords_mind</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bank_coords_mind</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.calculation.WaterLevelData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.calculation.WaterLevelData" class="toclink">
            <code>WaterLevelData</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.calculation.WaterLevelData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Class to hold water level data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hfw_max</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum water depth along the fairway.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>water_level</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Water level data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_wave_max</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum bank height subject to ship waves [m]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ship_wave_min</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum bank height subject to ship waves [m]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>velocity</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flow velocity magnitude along the bank [m/s]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bank_height</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bank height data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chezy</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Chezy coefficient data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vol_per_discharge</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Eroded volume per discharge level for each bank line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/calculation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">WaterLevelData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to hold water level data.</span>

<span class="sd">    args:</span>
<span class="sd">        hfw_max (float): Maximum water depth along the fairway.</span>
<span class="sd">        water_level (List[List[np.ndarray]]): Water level data.</span>
<span class="sd">        ship_wave_max (List[List[np.ndarray]]): Maximum bank height subject to ship waves [m]</span>
<span class="sd">        ship_wave_min (List[List[np.ndarray]]): Minimum bank height subject to ship waves [m]</span>
<span class="sd">        velocity (List[List[np.ndarray]]): Flow velocity magnitude along the bank [m/s]</span>
<span class="sd">        bank_height (List[np.ndarray]): Bank height data.</span>
<span class="sd">        chezy (List[List[np.ndarray]]): Chezy coefficient data.</span>
<span class="sd">        vol_per_discharge (List[List[np.ndarray]]):</span>
<span class="sd">            Eroded volume per discharge level for each bank line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hfw_max</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">water_level</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
    <span class="n">ship_wave_max</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
    <span class="n">ship_wave_min</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
    <span class="n">velocity</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
    <span class="n">chezy</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
    <span class="n">vol_per_discharge</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><p>For more details, see <a href="data_models/calculation.html">Bank Erosion Calculation Data Models</a>.</p>
<h4 id="input-data-models"><a class="toclink" href="#input-data-models">Input Data Models</a><a class="headerlink" href="#input-data-models" title="Permanent link">#</a></h4>


<div class="doc doc-object doc-module">



<h2 id="dfastbe.bank_erosion.data_models.inputs" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs" class="toclink">
            <code>dfastbe.bank_erosion.data_models.inputs</code>


</a><a href="#dfastbe.bank_erosion.data_models.inputs" class="headerlink" title="Permanent link">#</a></h2>

    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.inputs.BankLinesResultsError" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.BankLinesResultsError" class="toclink">
            <code>BankLinesResultsError</code>


</a><a href="#dfastbe.bank_erosion.data_models.inputs.BankLinesResultsError" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Custom exception for BankLine results errors.</p>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BankLinesResultsError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom exception for BankLine results errors.&quot;&quot;&quot;</span>

    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.inputs.ErosionRiverData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData" class="toclink">
            <code>ErosionRiverData</code>


</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseRiverData (&lt;code&gt;dfastbe.io.data_models.BaseRiverData&lt;/code&gt;)" href="../io.html#dfastbe.io.data_models.BaseRiverData">BaseRiverData</a></code></p>







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErosionRiverData</span><span class="p">(</span><span class="n">BaseRiverData</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bank_line_dir</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_output_dir</span><span class="p">(</span><span class="s2">&quot;erosion&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">debug</span>
        <span class="c1"># set plotting flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_flags</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_plotting_flags</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">root_dir</span><span class="p">)</span>
        <span class="c1"># get filter settings for bank levels and flow velocities along banks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zb_dx</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_float</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;BedFilterDist&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vel_dx</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_float</span><span class="p">(</span>
            <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;VelFilterDist&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;get_levels&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_discharge_levels</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;NLevel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_intervals</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_float</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;OutputInterval&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank_lines</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">read_bank_lines</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">river_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_river_axis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">erosion_time</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;TErosion&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">simulation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErosionSimulationData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulation Data.&quot;&quot;&quot;</span>
        <span class="n">ref_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;RefLevel&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># read simulation data (get_sim_data)</span>
        <span class="n">sim_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_sim_file</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;read_simdata&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">sim_file</span><span class="p">})</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">ErosionSimulationData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sim_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simulation_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_bank_output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="n">bank_output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;BankDir&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dir_out&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="n">bank_output_dir</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bank_output_dir</span><span class="p">):</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;overwrite_dir&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="n">bank_output_dir</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">bank_output_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">bank_output_dir</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_bank_line_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="n">bank_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="s2">&quot;General&quot;</span><span class="p">,</span> <span class="s2">&quot;BankDir&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;bank_dir_in&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="n">bank_dir</span><span class="p">})</span>
        <span class="n">bank_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bank_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bank_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;missing_dir&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="n">bank_dir</span><span class="p">})</span>
            <span class="k">raise</span> <span class="n">BankLinesResultsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Required bank line directory:</span><span class="si">{</span><span class="n">bank_dir</span><span class="si">}</span><span class="s2"> does not exist. please use the banklines command to run the &quot;</span>
                <span class="s2">&quot;bankline detection tool first it.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bank_dir</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_river_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LineString</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the river axis from the analysis settings.&quot;&quot;&quot;</span>
        <span class="n">river_axis_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_str</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;RiverAxis&quot;</span><span class="p">)</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;read_river_axis&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">river_axis_file</span><span class="p">})</span>
        <span class="n">river_axis</span> <span class="o">=</span> <span class="n">XYCModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">river_axis_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">river_axis</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_river_axis_by_center_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LineGeometry</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the river axis by the center line.</span>

<span class="sd">        Intersect the river center line with the river axis to map the stations from the first to the latter</span>
<span class="sd">        then clip the river axis by the first and last station of the centerline.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_axis</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="c1"># optional sorting --&gt; see 04_Waal_D3D example</span>
        <span class="c1"># check: sum all distances and determine maximum distance ...</span>
        <span class="c1"># if maximum &gt; alpha * sum then perform sort</span>
        <span class="c1"># Waal OK: 0.0082 ratio max/sum, Waal NotOK: 0.13 - Waal: 2500 points,</span>
        <span class="c1"># so even when OK still some 21 times more than 1/2500 = 0.0004</span>
        <span class="n">dist2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">dist2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">dist2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.03</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The river axis needs sorting!!&quot;</span><span class="p">)</span>

        <span class="c1"># map km to axis points, further using axis</span>
        <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_axis&quot;</span><span class="p">)</span>
        <span class="n">river_center_line_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">intersect_with_line</span><span class="p">(</span><span class="n">river_center_line_arr</span><span class="p">)</span>

        <span class="c1"># clip river axis to reach of interest (get the closest point to the first and last station)</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="p">((</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
            <span class="p">((</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">i2</span><span class="p">:</span>
            <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># reverse river axis</span>
            <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
        <span class="n">river_axis</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stations&quot;</span><span class="p">:</span> <span class="n">river_axis_km</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">river_axis</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.process_river_axis_by_center_line" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.process_river_axis_by_center_line" class="toclink">
            <code class="highlight language-python"><span class="n">process_river_axis_by_center_line</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">LineGeometry</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.process_river_axis_by_center_line" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Process the river axis by the center line.</p>
<p>Intersect the river center line with the river axis to map the stations from the first to the latter
then clip the river axis by the first and last station of the centerline.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_river_axis_by_center_line</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LineGeometry</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process the river axis by the center line.</span>

<span class="sd">    Intersect the river center line with the river axis to map the stations from the first to the latter</span>
<span class="sd">    then clip the river axis by the first and last station of the centerline.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">river_axis</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
    <span class="c1"># optional sorting --&gt; see 04_Waal_D3D example</span>
    <span class="c1"># check: sum all distances and determine maximum distance ...</span>
    <span class="c1"># if maximum &gt; alpha * sum then perform sort</span>
    <span class="c1"># Waal OK: 0.0082 ratio max/sum, Waal NotOK: 0.13 - Waal: 2500 points,</span>
    <span class="c1"># so even when OK still some 21 times more than 1/2500 = 0.0004</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">dist2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">dist2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.03</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The river axis needs sorting!!&quot;</span><span class="p">)</span>

    <span class="c1"># map km to axis points, further using axis</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;chainage_to_axis&quot;</span><span class="p">)</span>
    <span class="n">river_center_line_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">river_center_line</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
    <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis</span><span class="o">.</span><span class="n">intersect_with_line</span><span class="p">(</span><span class="n">river_center_line_arr</span><span class="p">)</span>

    <span class="c1"># clip river axis to reach of interest (get the closest point to the first and last station)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
        <span class="p">((</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span>
        <span class="p">((</span><span class="n">river_center_line_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">river_axis_numpy</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">i1</span> <span class="o">&lt;</span> <span class="n">i2</span><span class="p">:</span>
        <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i1</span> <span class="p">:</span> <span class="n">i2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># reverse river axis</span>
        <span class="n">river_axis_km</span> <span class="o">=</span> <span class="n">river_axis_km</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">river_axis_numpy</span> <span class="o">=</span> <span class="n">river_axis_numpy</span><span class="p">[</span><span class="n">i2</span> <span class="p">:</span> <span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">river_axis</span> <span class="o">=</span> <span class="n">LineGeometry</span><span class="p">(</span><span class="n">river_axis_numpy</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="n">river_axis</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stations&quot;</span><span class="p">:</span> <span class="n">river_axis_km</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">river_axis</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.simulation_data" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.simulation_data" class="toclink">
            <code class="highlight language-python"><span class="n">simulation_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ErosionSimulationData</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionRiverData.simulation_data" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Simulation Data.</p>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">simulation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ErosionSimulationData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulation Data.&quot;&quot;&quot;</span>
    <span class="n">ref_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="s2">&quot;RefLevel&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># read simulation data (get_sim_data)</span>
    <span class="n">sim_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="o">.</span><span class="n">get_sim_file</span><span class="p">(</span><span class="s2">&quot;Erosion&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref_level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;read_simdata&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">sim_file</span><span class="p">})</span>
    <span class="n">log_text</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
    <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">ErosionSimulationData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sim_file</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simulation_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData" class="toclink">
            <code>ErosionSimulationData</code>


</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseSimulationData (&lt;code&gt;dfastbe.io.data_models.BaseSimulationData&lt;/code&gt;)" href="../io.html#dfastbe.io.data_models.BaseSimulationData">BaseSimulationData</a></code></p>







              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ErosionSimulationData</span><span class="p">(</span><span class="n">BaseSimulationData</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_mesh_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshData</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Derive secondary topology arrays from the face-node connectivity of the mesh.</span>

<span class="sd">        This function computes the edge-node, edge-face, and face-edge connectivity arrays,</span>
<span class="sd">        as well as the boundary edges of the mesh, based on the face-node connectivity provided</span>
<span class="sd">        in the simulation data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MeshData: a dataclass containing the following attributes:</span>
<span class="sd">                - `x_face_coords`: x-coordinates of face nodes</span>
<span class="sd">                - `y_face_coords`: y-coordinates of face nodes</span>
<span class="sd">                - `x_edge_coords`: x-coordinates of edge nodes</span>
<span class="sd">                - `y_edge_coords`: y-coordinates of edge nodes</span>
<span class="sd">                - `face_node`: the node indices for each of the mesh faces.</span>
<span class="sd">                - `n_nodes`: number of nodes per face</span>
<span class="sd">                - `edge_node`: the node indices for each of the mesh edges.</span>
<span class="sd">                - `edge_face_connectivity`: the face indices for each of the mesh edge</span>
<span class="sd">                - `face_edge_connectivity`: the edge indices for each of the mesh face</span>
<span class="sd">                - `boundary_edge_nrs`: indices of boundary edges</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError:</span>
<span class="sd">                If required keys (e.g., `face_node`, `nnodes`, `x_node`, `y_node`) are missing from the `sim` object.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The function identifies unique edges by sorting and comparing node indices.</span>
<span class="sd">            - Boundary edges are identified as edges that belong to only one face.</span>
<span class="sd">            - The function assumes that the mesh is well-formed, with consistent face-node connectivity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get a sorted list of edge node connections (shared edges occur twice)</span>
        <span class="c1"># face_nr contains the face index to which the edge belongs</span>
        <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_edges</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span>
        <span class="n">edge_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_edges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">face_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_edges</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">face_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_faces</span><span class="p">):</span>
            <span class="n">num_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">face_i</span><span class="p">]</span>  <span class="c1"># note: nEdges = nNodes</span>
            <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_edges</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">edge_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">num_edges</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">]</span>
                <span class="n">face_nr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_i</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">edge_node</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">edge_node</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">edge_node</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>
        <span class="n">i12</span> <span class="o">=</span> <span class="n">i2</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
        <span class="n">edge_node</span> <span class="o">=</span> <span class="n">edge_node</span><span class="p">[</span><span class="n">i12</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">face_nr</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">i12</span><span class="p">]</span>

        <span class="c1"># detect which edges are equal to the previous edge, and get a list of all unique edges</span>
        <span class="n">numpy_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">])</span>
        <span class="n">equal_to_previous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">(</span><span class="o">~</span><span class="n">numpy_true</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge_node</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">unique_edge</span> <span class="o">=</span> <span class="o">~</span><span class="n">equal_to_previous</span>
        <span class="n">n_unique_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unique_edge</span><span class="p">)</span>
        <span class="c1"># reduce the edge node connections to only the unique edges</span>
        <span class="n">edge_node</span> <span class="o">=</span> <span class="n">edge_node</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># number the edges</span>
        <span class="n">edge_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">edge_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_unique_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">edge_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr</span><span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">equal_to_previous</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">equal_to_previous</span><span class="p">[:</span><span class="mi">1</span><span class="p">]))</span>
        <span class="p">]</span>

        <span class="c1"># if two consecutive edges are unique, the first one occurs only once and represents a boundary edge</span>
        <span class="n">is_boundary_edge</span> <span class="o">=</span> <span class="n">unique_edge</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">unique_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">numpy_true</span><span class="p">))</span>
        <span class="n">boundary_edge_nrs</span> <span class="o">=</span> <span class="n">edge_nr</span><span class="p">[</span><span class="n">is_boundary_edge</span><span class="p">]</span>

        <span class="c1"># go back to the original face order</span>
        <span class="n">edge_nr_in_face_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">edge_nr_in_face_order</span><span class="p">[</span><span class="n">i12</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr</span>
        <span class="c1"># create the face edge connectivity array</span>
        <span class="n">face_edge_connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">face_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_faces</span><span class="p">):</span>
            <span class="n">num_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">face_i</span><span class="p">]</span>  <span class="c1"># note: num_edges = n_nodes</span>
            <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_edges</span><span class="p">):</span>
                <span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr_in_face_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># determine the edge face connectivity</span>
        <span class="n">edge_face</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_unique_edges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">edge_face</span><span class="p">[</span><span class="n">edge_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">]</span>
        <span class="n">edge_face</span><span class="p">[</span><span class="n">edge_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">]</span>

        <span class="n">x_face_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">)</span>
        <span class="n">y_face_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">)</span>
        <span class="n">x_edge_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_node</span><span class="p">[</span><span class="n">edge_node</span><span class="p">]</span>
        <span class="n">y_edge_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_node</span><span class="p">[</span><span class="n">edge_node</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">MeshData</span><span class="p">(</span>
            <span class="n">x_face_coords</span><span class="o">=</span><span class="n">x_face_coords</span><span class="p">,</span>
            <span class="n">y_face_coords</span><span class="o">=</span><span class="n">y_face_coords</span><span class="p">,</span>
            <span class="n">x_edge_coords</span><span class="o">=</span><span class="n">x_edge_coords</span><span class="p">,</span>
            <span class="n">y_edge_coords</span><span class="o">=</span><span class="n">y_edge_coords</span><span class="p">,</span>
            <span class="n">face_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">,</span>
            <span class="n">n_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span>
            <span class="n">edge_node</span><span class="o">=</span><span class="n">edge_node</span><span class="p">,</span>
            <span class="n">edge_face_connectivity</span><span class="o">=</span><span class="n">edge_face</span><span class="p">,</span>
            <span class="n">face_edge_connectivity</span><span class="o">=</span><span class="n">face_edge_connectivity</span><span class="p">,</span>
            <span class="n">boundary_edge_nrs</span><span class="o">=</span><span class="n">boundary_edge_nrs</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_masked_indexing</span><span class="p">(</span>
        <span class="n">x0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index one array by another transferring the mask.</span>

<span class="sd">        Args:</span>
<span class="sd">            x0 : np.ndarray</span>
<span class="sd">                A linear array.</span>
<span class="sd">            idx : np.ma.masked_array</span>
<span class="sd">                An index array with possibly masked indices.</span>

<span class="sd">        returns:</span>
<span class="sd">            x1: np.ma.masked_array</span>
<span class="sd">                An array with same shape as idx, with mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idx_safe</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">idx_safe</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">x0</span><span class="p">[</span><span class="n">idx_safe</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">x1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_bank_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="s2">&quot;SingleBank&quot;</span><span class="p">,</span> <span class="n">vel_dx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">moving_avg</span>

        <span class="n">bank_face_indices</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span>
        <span class="n">vel_bank</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">velocity_x_face</span><span class="p">[</span><span class="n">bank_face_indices</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">dx</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_y_face</span><span class="p">[</span><span class="n">bank_face_indices</span><span class="p">]</span> <span class="o">*</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">dy</span>
            <span class="p">)</span>
            <span class="o">/</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">segment_length</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">vel_dx</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vel_bank</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span><span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span> <span class="n">vel_bank</span><span class="p">,</span> <span class="n">vel_dx</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vel_bank</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_bank_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">single_bank</span><span class="p">:</span> <span class="n">SingleBank</span><span class="p">,</span> <span class="n">zb_dx</span><span class="p">):</span>
        <span class="c1"># bank height = maximum bed elevation per cell</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">moving_avg</span>

        <span class="n">bank_index</span> <span class="o">=</span> <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_face_indices</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bed_elevation_location</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
            <span class="n">zb_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bed_elevation_values</span>
            <span class="n">zb_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="n">zb_nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">bank_index</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">zb_bank</span> <span class="o">=</span> <span class="n">zb_all</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zb_dx</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">zb_bank</span> <span class="o">=</span> <span class="n">moving_avg</span><span class="p">(</span>
                    <span class="n">single_bank</span><span class="o">.</span><span class="n">bank_chainage_midpoints</span><span class="p">,</span>
                    <span class="n">zb_bank</span><span class="p">,</span>
                    <span class="n">zb_dx</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># don&#39;t know ... need to check neighbouring cells ...</span>
            <span class="n">zb_bank</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">zb_bank</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_fairway_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fairway_face_indices</span><span class="p">):</span>
        <span class="c1"># get fairway face indices</span>
        <span class="c1"># fairway_face_indices = fairway_face_indices</span>

        <span class="c1"># get water depth along the fair-way</span>
        <span class="n">water_depth_fairway</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_depth_face</span><span class="p">[</span><span class="n">fairway_face_indices</span><span class="p">]</span>
        <span class="n">water_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">water_level_face</span><span class="p">[</span><span class="n">fairway_face_indices</span><span class="p">]</span>
        <span class="n">chez_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chezy_face</span><span class="p">[</span><span class="n">fairway_face_indices</span><span class="p">]</span>
        <span class="n">chezy</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">chez_face</span> <span class="o">+</span> <span class="n">chez_face</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;water_depth&quot;</span><span class="p">:</span> <span class="n">water_depth_fairway</span><span class="p">,</span>
            <span class="s2">&quot;water_level&quot;</span><span class="p">:</span> <span class="n">water_level</span><span class="p">,</span>
            <span class="s2">&quot;chezy&quot;</span><span class="p">:</span> <span class="n">chezy</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.apply_masked_indexing" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.apply_masked_indexing" class="toclink">
            <code class="highlight language-python"><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="n">x0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.apply_masked_indexing" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Index one array by another transferring the mask.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x0</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray
A linear array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ma.masked_array
An index array with possibly masked indices.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>x1</code></td>            <td>
                  <code><span title="numpy.ma.masked_array">masked_array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ma.masked_array
An array with same shape as idx, with mask.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_masked_indexing</span><span class="p">(</span>
    <span class="n">x0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index one array by another transferring the mask.</span>

<span class="sd">    Args:</span>
<span class="sd">        x0 : np.ndarray</span>
<span class="sd">            A linear array.</span>
<span class="sd">        idx : np.ma.masked_array</span>
<span class="sd">            An index array with possibly masked indices.</span>

<span class="sd">    returns:</span>
<span class="sd">        x1: np.ma.masked_array</span>
<span class="sd">            An array with same shape as idx, with mask.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx_safe</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">idx_safe</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">idx</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="n">x0</span><span class="p">[</span><span class="n">idx_safe</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">x1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.compute_mesh_topology" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.compute_mesh_topology" class="toclink">
            <code class="highlight language-python"><span class="n">compute_mesh_topology</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshData</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ErosionSimulationData.compute_mesh_topology" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Derive secondary topology arrays from the face-node connectivity of the mesh.</p>
<p>This function computes the edge-node, edge-face, and face-edge connectivity arrays,
as well as the boundary edges of the mesh, based on the face-node connectivity provided
in the simulation data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MeshData</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MeshData (&lt;code&gt;dfastbe.bank_erosion.mesh.data_models.MeshData&lt;/code&gt;)" href="#dfastbe.bank_erosion.mesh.data_models.MeshData">MeshData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dataclass containing the following attributes:
- <code>x_face_coords</code>: x-coordinates of face nodes
- <code>y_face_coords</code>: y-coordinates of face nodes
- <code>x_edge_coords</code>: x-coordinates of edge nodes
- <code>y_edge_coords</code>: y-coordinates of edge nodes
- <code>face_node</code>: the node indices for each of the mesh faces.
- <code>n_nodes</code>: number of nodes per face
- <code>edge_node</code>: the node indices for each of the mesh edges.
- <code>edge_face_connectivity</code>: the face indices for each of the mesh edge
- <code>face_edge_connectivity</code>: the edge indices for each of the mesh face
- <code>boundary_edge_nrs</code>: indices of boundary edges</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required keys (e.g., <code>face_node</code>, <code>nnodes</code>, <code>x_node</code>, <code>y_node</code>) are missing from the <code>sim</code> object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>The function identifies unique edges by sorting and comparing node indices.</li>
<li>Boundary edges are identified as edges that belong to only one face.</li>
<li>The function assumes that the mesh is well-formed, with consistent face-node connectivity.</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_mesh_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MeshData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Derive secondary topology arrays from the face-node connectivity of the mesh.</span>

<span class="sd">    This function computes the edge-node, edge-face, and face-edge connectivity arrays,</span>
<span class="sd">    as well as the boundary edges of the mesh, based on the face-node connectivity provided</span>
<span class="sd">    in the simulation data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MeshData: a dataclass containing the following attributes:</span>
<span class="sd">            - `x_face_coords`: x-coordinates of face nodes</span>
<span class="sd">            - `y_face_coords`: y-coordinates of face nodes</span>
<span class="sd">            - `x_edge_coords`: x-coordinates of edge nodes</span>
<span class="sd">            - `y_edge_coords`: y-coordinates of edge nodes</span>
<span class="sd">            - `face_node`: the node indices for each of the mesh faces.</span>
<span class="sd">            - `n_nodes`: number of nodes per face</span>
<span class="sd">            - `edge_node`: the node indices for each of the mesh edges.</span>
<span class="sd">            - `edge_face_connectivity`: the face indices for each of the mesh edge</span>
<span class="sd">            - `face_edge_connectivity`: the edge indices for each of the mesh face</span>
<span class="sd">            - `boundary_edge_nrs`: indices of boundary edges</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError:</span>
<span class="sd">            If required keys (e.g., `face_node`, `nnodes`, `x_node`, `y_node`) are missing from the `sim` object.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - The function identifies unique edges by sorting and comparing node indices.</span>
<span class="sd">        - Boundary edges are identified as edges that belong to only one face.</span>
<span class="sd">        - The function assumes that the mesh is well-formed, with consistent face-node connectivity.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get a sorted list of edge node connections (shared edges occur twice)</span>
    <span class="c1"># face_nr contains the face index to which the edge belongs</span>
    <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_edges</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span>
    <span class="n">edge_node</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_edges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">face_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_edges</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">face_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_faces</span><span class="p">):</span>
        <span class="n">num_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">face_i</span><span class="p">]</span>  <span class="c1"># note: nEdges = nNodes</span>
        <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_edges</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">edge_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">num_edges</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">edge_node</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">]</span>
            <span class="n">face_nr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_i</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">edge_node</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">edge_node</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">edge_node</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;stable&quot;</span><span class="p">)</span>
    <span class="n">i12</span> <span class="o">=</span> <span class="n">i2</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
    <span class="n">edge_node</span> <span class="o">=</span> <span class="n">edge_node</span><span class="p">[</span><span class="n">i12</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">face_nr</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">i12</span><span class="p">]</span>

    <span class="c1"># detect which edges are equal to the previous edge, and get a list of all unique edges</span>
    <span class="n">numpy_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">])</span>
    <span class="n">equal_to_previous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="o">~</span><span class="n">numpy_true</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">edge_node</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">unique_edge</span> <span class="o">=</span> <span class="o">~</span><span class="n">equal_to_previous</span>
    <span class="n">n_unique_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unique_edge</span><span class="p">)</span>
    <span class="c1"># reduce the edge node connections to only the unique edges</span>
    <span class="n">edge_node</span> <span class="o">=</span> <span class="n">edge_node</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># number the edges</span>
    <span class="n">edge_nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">edge_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_unique_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">edge_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr</span><span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">equal_to_previous</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">equal_to_previous</span><span class="p">[:</span><span class="mi">1</span><span class="p">]))</span>
    <span class="p">]</span>

    <span class="c1"># if two consecutive edges are unique, the first one occurs only once and represents a boundary edge</span>
    <span class="n">is_boundary_edge</span> <span class="o">=</span> <span class="n">unique_edge</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">unique_edge</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">numpy_true</span><span class="p">))</span>
    <span class="n">boundary_edge_nrs</span> <span class="o">=</span> <span class="n">edge_nr</span><span class="p">[</span><span class="n">is_boundary_edge</span><span class="p">]</span>

    <span class="c1"># go back to the original face order</span>
    <span class="n">edge_nr_in_face_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_edges</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">edge_nr_in_face_order</span><span class="p">[</span><span class="n">i12</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr</span>
    <span class="c1"># create the face edge connectivity array</span>
    <span class="n">face_edge_connectivity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">face_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_faces</span><span class="p">):</span>
        <span class="n">num_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">[</span><span class="n">face_i</span><span class="p">]</span>  <span class="c1"># note: num_edges = n_nodes</span>
        <span class="k">for</span> <span class="n">edge_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_edges</span><span class="p">):</span>
            <span class="n">face_edge_connectivity</span><span class="p">[</span><span class="n">face_i</span><span class="p">,</span> <span class="n">edge_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_nr_in_face_order</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># determine the edge face connectivity</span>
    <span class="n">edge_face</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_unique_edges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">edge_face</span><span class="p">[</span><span class="n">edge_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">unique_edge</span><span class="p">]</span>
    <span class="n">edge_face</span><span class="p">[</span><span class="n">edge_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_nr</span><span class="p">[</span><span class="n">equal_to_previous</span><span class="p">]</span>

    <span class="n">x_face_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">)</span>
    <span class="n">y_face_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_masked_indexing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">)</span>
    <span class="n">x_edge_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_node</span><span class="p">[</span><span class="n">edge_node</span><span class="p">]</span>
    <span class="n">y_edge_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_node</span><span class="p">[</span><span class="n">edge_node</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">MeshData</span><span class="p">(</span>
        <span class="n">x_face_coords</span><span class="o">=</span><span class="n">x_face_coords</span><span class="p">,</span>
        <span class="n">y_face_coords</span><span class="o">=</span><span class="n">y_face_coords</span><span class="p">,</span>
        <span class="n">x_edge_coords</span><span class="o">=</span><span class="n">x_edge_coords</span><span class="p">,</span>
        <span class="n">y_edge_coords</span><span class="o">=</span><span class="n">y_edge_coords</span><span class="p">,</span>
        <span class="n">face_node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">face_node</span><span class="p">,</span>
        <span class="n">n_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span>
        <span class="n">edge_node</span><span class="o">=</span><span class="n">edge_node</span><span class="p">,</span>
        <span class="n">edge_face_connectivity</span><span class="o">=</span><span class="n">edge_face</span><span class="p">,</span>
        <span class="n">face_edge_connectivity</span><span class="o">=</span><span class="n">face_edge_connectivity</span><span class="p">,</span>
        <span class="n">boundary_edge_nrs</span><span class="o">=</span><span class="n">boundary_edge_nrs</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="dfastbe.bank_erosion.data_models.inputs.ShipsParameters" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters" class="toclink">
            <code>ShipsParameters</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters" class="headerlink" title="Permanent link">#</a></h3>


    <div class="doc doc-contents ">


        <p>Data for ships going through the fairway for bank erosion simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_file</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ConfigFile (&lt;code&gt;dfastbe.io.config.ConfigFile&lt;/code&gt;)" href="../io.html#dfastbe.io.config.ConfigFile">ConfigFile</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration file containing parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>velocity</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ship velocities for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of ships for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_waves</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of waves per ship for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>draught</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Draught of ships for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>type</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of ships for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slope</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slope values for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reed</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reed values for each bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ShipsParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data for ships going through the fairway for bank erosion simulation.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (ConfigFile):</span>
<span class="sd">            Configuration file containing parameters.</span>
<span class="sd">        velocity (List[np.ndarray]):</span>
<span class="sd">            Ship velocities for each bank.</span>
<span class="sd">        number (List[np.ndarray]):</span>
<span class="sd">            Number of ships for each bank.</span>
<span class="sd">        num_waves (List[np.ndarray]):</span>
<span class="sd">            Number of waves per ship for each bank.</span>
<span class="sd">        draught (List[np.ndarray]):</span>
<span class="sd">            Draught of ships for each bank.</span>
<span class="sd">        type (List[np.ndarray]):</span>
<span class="sd">            Type of ships for each bank.</span>
<span class="sd">        slope (List[np.ndarray]):</span>
<span class="sd">            Slope values for each bank.</span>
<span class="sd">        reed (List[np.ndarray]):</span>
<span class="sd">            Reed values for each bank.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span>
    <span class="n">velocity</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">number</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">num_waves</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">draught</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">slope</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="n">reed</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>

    <span class="n">REED_DAMPING_COEFFICIENT</span> <span class="o">=</span> <span class="mf">8.5e-4</span>
    <span class="n">REED_DAMPING_EXPONENT</span> <span class="o">=</span> <span class="mf">0.8</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ship_data</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ShipsParameters&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ship parameters from the configuration file.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_stations_per_bank (List[int]):</span>
<span class="sd">                The number of stations per bank.</span>
<span class="sd">            config_file (ConfigFile):</span>
<span class="sd">                Configuration file containing parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ShipsParameters: An instance of ShipsParameters with parameters read from the config file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">param_defs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_initial_parameter_definitions</span><span class="p">()</span>
        <span class="n">param_resolved</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_parameters</span><span class="p">(</span>
            <span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">param_defs</span>
        <span class="p">)</span>

        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;vship&quot;</span><span class="p">],</span>
            <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nship&quot;</span><span class="p">],</span>
            <span class="s2">&quot;num_waves&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nwave&quot;</span><span class="p">],</span>
            <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;draught&quot;</span><span class="p">],</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;shiptype&quot;</span><span class="p">],</span>
            <span class="s2">&quot;slope&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span>
            <span class="s2">&quot;reed&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="o">**</span><span class="n">param_dict</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_parameters</span><span class="p">(</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">param_defs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameters</span><span class="p">],</span>
        <span class="n">level_i_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve a list of Parameters with values from the configuration file.&quot;&quot;&quot;</span>
        <span class="n">param_resolved</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_defs</span><span class="p">:</span>
            <span class="n">param_resolved</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_file</span><span class="o">.</span><span class="n">get_parameter</span><span class="p">(</span>
                <span class="s2">&quot;Erosion&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="si">}{</span><span class="n">level_i_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">num_stations_per_bank</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                <span class="n">valid</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span>
                <span class="n">onefile</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">onefile</span><span class="p">,</span>
                <span class="n">positive</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">positive</span><span class="p">,</span>
                <span class="n">ext</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">ext</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">param_resolved</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_initial_parameter_definitions</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameters</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameter definitions for discharge parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[namedtuple]: List of parameter definitions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;VShip&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;NShip&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;NWave&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Draught&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;ShipType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Slope&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;slp&quot;</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Reed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;rdd&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_discharge_parameter_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Parameters</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get parameter definitions for discharge parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[namedtuple]: List of parameter definitions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;VShip&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;NShip&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;NWave&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Draught&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">draught</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;ShipType&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Slope&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slope</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;slp&quot;</span><span class="p">),</span>
            <span class="n">Parameters</span><span class="p">(</span><span class="s2">&quot;Reed&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reed</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;rdd&quot;</span><span class="p">),</span>
        <span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_ship_derived_parameters</span><span class="p">(</span>
        <span class="n">slope_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">reed_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate derived parameters from slope and reed values.</span>

<span class="sd">        Args:</span>
<span class="sd">            slope_values (List[np.ndarray]): Slope values for each bank.</span>
<span class="sd">            reed_values (List[np.ndarray]): Reed values for each bank.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[np.ndarray], List[np.ndarray]]: Calculated mu_slope and mu_reed values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_slope</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mu_reed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ps</span><span class="p">,</span> <span class="n">pr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">slope_values</span><span class="p">,</span> <span class="n">reed_values</span><span class="p">):</span>
            <span class="c1"># Calculate mu_slope (inverse of slope for non-zero values)</span>
            <span class="n">mus</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">mus</span><span class="p">[</span><span class="n">mus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">mus</span><span class="p">[</span><span class="n">mus</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">mu_slope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mus</span><span class="p">)</span>

            <span class="c1"># Calculate mu_reed (empirical damping coefficient)</span>
            <span class="n">mu_reed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ShipsParameters</span><span class="o">.</span><span class="n">REED_DAMPING_COEFFICIENT</span>
                <span class="o">*</span> <span class="n">pr</span><span class="o">**</span><span class="n">ShipsParameters</span><span class="o">.</span><span class="n">REED_DAMPING_EXPONENT</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">mu_slope</span><span class="p">,</span> <span class="n">mu_reed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read_discharge_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleLevelParameters</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read Discharge level parameters.</span>

<span class="sd">        Read all discharge-specific input arrays for level_i.</span>

<span class="sd">        Args:</span>
<span class="sd">            level_i (int):</span>
<span class="sd">                The index of the discharge level.</span>
<span class="sd">            num_stations_per_bank (List[int]):</span>
<span class="sd">                The number of stations per bank.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SingleLevelParameters: The discharge level parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_discharge_parameter_definitions</span><span class="p">()</span>
        <span class="n">param_resolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">param_defs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">mu_slope</span><span class="p">,</span> <span class="n">mu_reed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ship_derived_parameters</span><span class="p">(</span>
            <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">SingleLevelParameters</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">level_i</span><span class="p">,</span>
                <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;vship&quot;</span><span class="p">],</span>
                <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nship&quot;</span><span class="p">],</span>
                <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nwave&quot;</span><span class="p">],</span>
                <span class="s2">&quot;ship_draught&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;draught&quot;</span><span class="p">],</span>
                <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;shiptype&quot;</span><span class="p">],</span>
                <span class="s2">&quot;par_slope&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span>
                <span class="s2">&quot;par_reed&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">],</span>
                <span class="s2">&quot;mu_slope&quot;</span><span class="p">:</span> <span class="n">mu_slope</span><span class="p">,</span>
                <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">mu_reed</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">SingleParameters</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ShipsParameters.get_ship_data" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.get_ship_data" class="toclink">
            <code class="highlight language-python"><span class="n">get_ship_data</span><span class="p">(</span><span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShipsParameters</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.get_ship_data" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Get ship parameters from the configuration file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_stations_per_bank</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of stations per bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_file</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ConfigFile (&lt;code&gt;dfastbe.io.config.ConfigFile&lt;/code&gt;)" href="../io.html#dfastbe.io.config.ConfigFile">ConfigFile</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration file containing parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ShipsParameters</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="ShipsParameters (&lt;code&gt;dfastbe.bank_erosion.data_models.inputs.ShipsParameters&lt;/code&gt;)" href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters">ShipsParameters</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of ShipsParameters with parameters read from the config file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_ship_data</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">ConfigFile</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ShipsParameters&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get ship parameters from the configuration file.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_stations_per_bank (List[int]):</span>
<span class="sd">            The number of stations per bank.</span>
<span class="sd">        config_file (ConfigFile):</span>
<span class="sd">            Configuration file containing parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ShipsParameters: An instance of ShipsParameters with parameters read from the config file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">param_defs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_initial_parameter_definitions</span><span class="p">()</span>
    <span class="n">param_resolved</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_parameters</span><span class="p">(</span>
        <span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">param_defs</span>
    <span class="p">)</span>

    <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;velocity&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;vship&quot;</span><span class="p">],</span>
        <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nship&quot;</span><span class="p">],</span>
        <span class="s2">&quot;num_waves&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nwave&quot;</span><span class="p">],</span>
        <span class="s2">&quot;draught&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;draught&quot;</span><span class="p">],</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;shiptype&quot;</span><span class="p">],</span>
        <span class="s2">&quot;slope&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span>
        <span class="s2">&quot;reed&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="o">**</span><span class="n">param_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="dfastbe.bank_erosion.data_models.inputs.ShipsParameters.read_discharge_parameters" class="doc doc-heading"><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.read_discharge_parameters" class="toclink">
            <code class="highlight language-python"><span class="n">read_discharge_parameters</span><span class="p">(</span><span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SingleLevelParameters</span></code>

</a><a href="#dfastbe.bank_erosion.data_models.inputs.ShipsParameters.read_discharge_parameters" class="headerlink" title="Permanent link">#</a></h4>


    <div class="doc doc-contents ">

        <p>Read Discharge level parameters.</p>
<p>Read all discharge-specific input arrays for level_i.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>level_i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the discharge level.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_stations_per_bank</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of stations per bank.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SingleLevelParameters</code></td>            <td>
                  <code><span title="dfastbe.bank_erosion.data_models.calculation.SingleLevelParameters">SingleLevelParameters</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discharge level parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/dfastbe/bank_erosion/data_models/inputs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_discharge_parameters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">level_i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">num_stations_per_bank</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SingleLevelParameters</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read Discharge level parameters.</span>

<span class="sd">    Read all discharge-specific input arrays for level_i.</span>

<span class="sd">    Args:</span>
<span class="sd">        level_i (int):</span>
<span class="sd">            The index of the discharge level.</span>
<span class="sd">        num_stations_per_bank (List[int]):</span>
<span class="sd">            The number of stations per bank.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SingleLevelParameters: The discharge level parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">param_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_discharge_parameter_definitions</span><span class="p">()</span>
    <span class="n">param_resolved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_file</span><span class="p">,</span> <span class="n">num_stations_per_bank</span><span class="p">,</span> <span class="n">param_defs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">level_i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">mu_slope</span><span class="p">,</span> <span class="n">mu_reed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_ship_derived_parameters</span><span class="p">(</span>
        <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">SingleLevelParameters</span><span class="o">.</span><span class="n">from_column_arrays</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">level_i</span><span class="p">,</span>
            <span class="s2">&quot;ship_velocity&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;vship&quot;</span><span class="p">],</span>
            <span class="s2">&quot;num_ship&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nship&quot;</span><span class="p">],</span>
            <span class="s2">&quot;num_waves_per_ship&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;nwave&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ship_draught&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;draught&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ship_type&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;shiptype&quot;</span><span class="p">],</span>
            <span class="s2">&quot;par_slope&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;slope&quot;</span><span class="p">],</span>
            <span class="s2">&quot;par_reed&quot;</span><span class="p">:</span> <span class="n">param_resolved</span><span class="p">[</span><span class="s2">&quot;reed&quot;</span><span class="p">],</span>
            <span class="s2">&quot;mu_slope&quot;</span><span class="p">:</span> <span class="n">mu_slope</span><span class="p">,</span>
            <span class="s2">&quot;mu_reed&quot;</span><span class="p">:</span> <span class="n">mu_reed</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">SingleParameters</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><p>For more details, see <a href="data_models/inputs.html">Bank Erosion Input Data Models</a>.</p>
<h2 id="workflow"><a class="toclink" href="#workflow">Workflow</a><a class="headerlink" href="#workflow" title="Permanent link">#</a></h2>
<p>The typical workflow for bank erosion calculation is:</p>
<ol>
<li>Initialize the Erosion object with a configuration file</li>
<li>Call the <code>run</code> method to start the erosion calculation process</li>
<li>The <code>run</code> method orchestrates the entire process:</li>
<li>Processes the river axis</li>
<li>Gets fairway data</li>
<li>Calculates bank-fairway distance</li>
<li>Prepares initial conditions</li>
<li>Processes discharge levels</li>
<li>Computes erosion per level</li>
<li>Post-processes results</li>
<li>Writes output files</li>
<li>Generates plots</li>
</ol>
<h2 id="usage-example"><a class="toclink" href="#usage-example">Usage Example</a><a class="headerlink" href="#usage-example" title="Permanent link">#</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.io.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigFile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dfastbe.bank_erosion.bank_erosion</span><span class="w"> </span><span class="kn">import</span> <span class="n">Erosion</span>

<span class="c1"># Load configuration file</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigFile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;config.cfg&quot;</span><span class="p">)</span>

<span class="c1"># Initialize Erosion object</span>
<span class="n">erosion</span> <span class="o">=</span> <span class="n">Erosion</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

<span class="c1"># Run erosion calculation</span>
<span class="n">erosion</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>
<p>For more details on the specific methods and classes, refer to the API reference below.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../bank_lines/data_models.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Bank Lines Data Models">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Bank Lines Data Models
              </div>
            </div>
          </a>
        
        
          
          <a href="erosion_calculation.html" class="md-footer__link md-footer__link--next" aria-label="Next: Erosion Calculation Process">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Erosion Calculation Process
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
    
  </body>
</html>